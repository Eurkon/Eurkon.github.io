<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Hive SQL 大全</title><meta name="author" content="Eurkon,eurkon@foxmail.com"><meta name="copyright" content="Eurkon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="前言本文基本涵盖了 Hive 日常使用的所有 SQL，因为 SQL 太多，所以将 SQL 进行了如下分类：  DDL 语句（数据定义语句）：  对数据库的操作：包含创建、修改数据库。 对数据表的操作：分为内部表及外部表，分区表和分桶表。   DQL 语句（数据查询语句）：  单表查询、关联查询。 Hive 函数：包含聚合函数，条件函数，日期函数，字符串函数等。 行转列及列转行：lateral vi"><meta property="og:type" content="article"><meta property="og:title" content="Hive SQL 大全"><meta property="og:url" content="https://blog.eurkon.com/post/7891b2e6.html"><meta property="og:site_name" content="Eurkon"><meta property="og:description" content="前言本文基本涵盖了 Hive 日常使用的所有 SQL，因为 SQL 太多，所以将 SQL 进行了如下分类：  DDL 语句（数据定义语句）：  对数据库的操作：包含创建、修改数据库。 对数据表的操作：分为内部表及外部表，分区表和分桶表。   DQL 语句（数据查询语句）：  单表查询、关联查询。 Hive 函数：包含聚合函数，条件函数，日期函数，字符串函数等。 行转列及列转行：lateral vi"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.eurkon.com/images/cover/hive.jpg"><meta property="article:published_time" content="2021-04-07T01:00:00.000Z"><meta property="article:modified_time" content="2021-04-07T01:00:00.000Z"><meta property="article:author" content="Eurkon"><meta property="article:tag" content="大数据"><meta property="article:tag" content="Hive"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.eurkon.com/images/cover/hive.jpg"><link rel="shortcut icon" href="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/favicon.jpg"><link rel="canonical" href="https://blog.eurkon.com/post/7891b2e6.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="rClKrjtCYPsDaynvUNmfe2YGPxb7ehnuwEF9aMdG7no"><meta name="msvalidate.01" content="F299EA4E7AD0E2B28FDF4E0EA94879BA"><meta name="baidu-site-verification" content="code-GmAI2TORJk"><meta name="360-site-verification" content="ac410c1012e6f0acc65b5c0805c91f01"><meta name="yandex-verification" content="ac410c1012e6f0acc65b5c0805c91f01"><meta name="bytedance-verification-code" content="D4gz9gUv9Wh0pS4d20uQ"><meta name="sogou_site_verification" content="uYYKpHOGXl"><link rel="stylesheet" href="/css/index.css?v=5.1.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>(() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ca4902422e728abe0603d52ce2e7757a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')</script><script>!function(a){"use strict";!function(t){var e=window,s=document,c=a,i="".concat("https:"===s.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),n=s.createElement("script"),r=s.getElementsByTagName("script")[0];n.type="text/javascript",n.setAttribute("charset","UTF-8"),n.async=!0,n.src=i,n.id="LA_COLLECT",c.d=n;var o=function(){e.LA.ids.push(c)};e.LA?e.LA.ids&&o():(e.LA=a,e.LA.ids=[],o()),r.parentNode.insertBefore(n,r)}()}({id:"Je3G46ggxUPbVh1P",ck:"Je3G46ggxUPbVh1P"})</script><script>!function(e,t,n,i){var r=t.createElement("script"),s=t.getElementsByTagName("script")[0];r.type="text/javascript",r.crossorigin=!0,r.onload=function(){(new e.LingQue.Monitor).init({id:"Je3HZw0g4jpQRh3f"})},s.parentNode.insertBefore(r,s),r.src="https://sdk.51.la/perf/js-sdk-perf.min.js"}(window,document)</script><script>const GLOBAL_CONFIG = {
  root: '/',
  emoji: {"categories":{"面试系列":"📝","魔改教程":"🎨","生活随笔":"💬","学习笔记":"📚","分享转载":"🌐","作品案例":"🖥️"},"tags":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":250,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#1677B3","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Hive SQL 大全",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-04-07 09:00:00"}</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/Swiper/8.0.6/swiper-bundle.min.css"><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/Swiper/8.0.6/swiper-bundle.min.js"></script><script src="https://npm.elemecdn.com/echarts/dist/echarts.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/map/js/china.js"></script><script src="https://npm.elemecdn.com/echarts-wordcloud/dist/echarts-wordcloud.js"></script><script src="https://npm.elemecdn.com/echarts-liquidfill/dist/echarts-liquidfill.js"></script><script src="/js/Lately.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Eurkon" type="application/atom+xml"><link rel="alternate" href="/rss.xml" title="Eurkon" type="application/rss+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><i class="fa fas fa-spinner fa-spin load-spinner"></i></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').style.transition = 'opacity 1s';
    document.getElementById('loading-box').style.opacity = '0';
    setTimeout(function () { document.getElementById('loading-box').classList.add("loaded") }, 1000)
    document.body.classList.remove("hidden-y")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').style.transition = '';
    document.getElementById('loading-box').style.opacity = '1'; 
    document.getElementById('loading-box').classList.remove("loaded")
    document.body.classList.add("hidden-y")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}

setTimeout(function () { preloader.endLoading() }, 3000)
document.getElementById('loading-box').addEventListener('click', () => { preloader.endLoading() })</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg" onerror='onerror=null,src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/loading.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-shapes"></i> <span>全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>所有标签</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();" rel="external nofollow noreferrer"><i class="fa-fw fas fa-random"></i> <span>随便看看</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-chart-bar"></i> <span>统计</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw fas fa-chart-area"></i> <span>文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-line"></i> <span>博客统计</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-link"></i> <span>导航</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-blog"></i> <span>友链订阅</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-user-friends"></i> <span>友情链接</span></a></li><li><a class="site-page child" href="/stars/"><i class="fa-fw fas fa-star"></i> <span>网站收藏</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-laptop"></i> <span>博客</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i> <span>关于本站</span></a></li><li><a class="site-page child" href="/notice/"><i class="fa-fw fas fa-bullhorn"></i> <span>网站公告</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i> <span>留言信箱</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-cloud-upload-alt"></i> <span>博客更新</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/images/cover/hive.jpg)"><nav id="nav"><div id="nav-group"><span id="blog-info"><a class="site-page" href="/" title="Eurkon"><span class="site-name">Eurkon</span><i class="fas fa-home"></i></a></span><a class="nav-page-title" title="回到顶部" onclick="btf.scrollToDest(0,500)"><span class="site-name" id="page-title">Hive SQL 大全</span></a><div id="menus"><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>文章列表</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-shapes"></i> <span>全部分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>所有标签</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();" rel="external nofollow noreferrer"><i class="fa-fw fas fa-random"></i> <span>随便看看</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-chart-bar"></i> <span>统计</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw fas fa-chart-area"></i> <span>文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-line"></i> <span>博客统计</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-link"></i> <span>导航</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-blog"></i> <span>友链订阅</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-user-friends"></i> <span>友情链接</span></a></li><li><a class="site-page child" href="/stars/"><i class="fa-fw fas fa-star"></i> <span>网站收藏</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-laptop"></i> <span>博客</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i> <span>关于本站</span></a></li><li><a class="site-page child" href="/notice/"><i class="fa-fw fas fa-bullhorn"></i> <span>网站公告</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i> <span>留言信箱</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-cloud-upload-alt"></i> <span>博客更新</span></a></li></ul></div></div></div><div id="hotkey"><div id="search-button"><span class="site-page social-icon search" href="javascript:void(0);" title="搜索"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div id="comment-button"><a class="site-page" href="#post-comment" title="前往评论"><i class="fas fa-comments fa-fw"></i></a></div><div id="setting-button" onclick="eurkon.switchRightSide()"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="设置"><i class="fas fa-screwdriver-wrench fa-fw"></i></a></div><div id="top-button"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="回到顶部" onclick="btf.scrollToDest(0,500)"><span class="scroll-percent"></span><i class="fas fa-arrow-up fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-cover"><img class="cover" id="post-cover-img" src="/images/cover/hive.jpg" alt="cover"></div><div id="post-info"><div id="post-meta"><div class="meta-firstline"><span class="post-meta-categories"><i class="fas fa-shapes fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">📚学习笔记</a></span><span class="post-meta-tags"><span class="post-meta-separator">|</span><i class="fas fa-tags fa-fw post-meta-icon"></i><a class="post-meta-tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="post-meta-separator">•</span><a class="post-meta-tags" href="/tags/Hive/">Hive</a></span></div><h1 class="post-title">Hive SQL 大全</h1><div class="meta-secondline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-07T01:00:00.000Z" title="发表于 2021-04-07 09:00:00">2021-04-07</time></span><span class="post-meta-separator">|</span><span class="post-meta-date"><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-07T01:00:00.000Z" title="更新于 2021-04-07 09:00:00">2021-04-07</time></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">17,124</span><span class="post-meta-separator">|</span></span><span class="post-meta-min2read"><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>83分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/7891b2e6.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div><div id="post"><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文基本涵盖了 Hive 日常使用的所有 SQL，因为 SQL 太多，所以将 SQL 进行了如下分类：</p><ol><li><p><a href="#Hive-的-DDL-语法">DDL 语句</a>（数据定义语句）：</p><ol><li><a href="#对数据库的操作">对数据库的操作</a>：包含创建、修改数据库。</li><li><a href="#对数据表的操作">对数据表的操作</a>：分为内部表及外部表，分区表和分桶表。</li></ol></li><li><p><a href="#Hive-的-DQL-语法">DQL 语句</a>（数据查询语句）：</p><ol><li><a href="#单表查询、关联查询">单表查询、关联查询</a>。</li><li><a href="#Hive-函数">Hive 函数</a>：包含聚合函数，条件函数，日期函数，字符串函数等。</li><li><a href="#行转列及列转行">行转列及列转行</a>：lateral view 与 explode 以及 reflect。</li><li><a href="#窗口函数与分析函数">窗口函数与分析函数</a>。</li><li><a href="#其他一些窗口函数">其他一些窗口函数</a>。</li></ol></li></ol><h2 id="Hive-的-DDL-语法"><a href="#Hive-的-DDL-语法" class="headerlink" title="Hive 的 DDL 语法"></a>Hive 的 DDL 语法</h2><h3 id="对数据库的操作"><a href="#对数据库的操作" class="headerlink" title="对数据库的操作"></a>对数据库的操作</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> myhive;</span><br><span class="line"><span class="comment"># 说明：hive 的表存放位置模式是由 hive-site.xml 当中的一个属性指定的：hive.metastore.warehouse.dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库并指定 HDFS 存储位置 :</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> myhive2 location <span class="string">&#x27;/myhive2&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p><h4 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> myhive2 <span class="keyword">set</span> dbproperties(<span class="string">&#x27;createtime&#x27;</span>=<span class="string">&#x27;20210329&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>说明：</strong>可以使用 <code>alter database</code> 命令来修改数据库的一些属性。但是数据库的元数据信息是不可更改的，包括数据库的名称以及数据库所在的位置</p><h4 id="查看数据库信息"><a href="#查看数据库信息" class="headerlink" title="查看数据库信息"></a>查看数据库信息</h4><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据库基本信息</span></span><br><span class="line">hive (myhive)&gt; desc database myhive2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据库更多详细信息</span></span><br><span class="line">hive (myhive)&gt; desc database extended myhive2;</span><br></pre></td></tr></table></figure><p></p><h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除一个空数据库，如果数据库下面有数据表，那么就会报错</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> myhive2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除数据库，包含数据库下面的表一起删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> myhive <span class="keyword">cascade</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="对数据表的操作"><a href="#对数据表的操作" class="headerlink" title="对数据表的操作"></a>对数据表的操作</h3><h4 id="对管理表（内部表）的操作"><a href="#对管理表（内部表）的操作" class="headerlink" title="对管理表（内部表）的操作"></a>对管理表（内部表）的操作</h4><h5 id="建内部表"><a href="#建内部表" class="headerlink" title="建内部表"></a>建内部表</h5><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive (myhive)&gt; use myhive; -- 使用 myhive 数据库</span><br><span class="line">hive (myhive)&gt; create table stu(id int,name string);</span><br><span class="line">hive (myhive)&gt; insert into stu values (1,&quot;zhangsan&quot;);</span><br><span class="line">hive (myhive)&gt; insert into stu values (1,&quot;zhangsan&quot;), (2,&quot;lisi&quot;); -- 一次插入多条数据</span><br><span class="line">hive (myhive)&gt; select * from stu;</span><br></pre></td></tr></table></figure><p></p><h5 id="Hive-建表时候的字段类型"><a href="#Hive-建表时候的字段类型" class="headerlink" title="Hive 建表时候的字段类型:"></a>Hive 建表时候的字段类型:</h5><p><strong>原始类型</strong></p><div class="table-container"><table><thead><tr><th>类型</th><th>描述</th><th>字面量示例</th></tr></thead><tbody><tr><td>BOOLEAN</td><td>true/false</td><td>TRUE</td></tr><tr><td>TINYINT</td><td>1 字节的有符号整数，-128~127</td><td>1Y</td></tr><tr><td>SMALLINT</td><td>2 个字节的有符号整数，-32768~32767</td><td>1S</td></tr><tr><td>INT</td><td>4 个字节的带符号整数</td><td>1</td></tr><tr><td>BIGINT</td><td>8 字节带符号整数</td><td>1L</td></tr><tr><td>FLOAT</td><td>4 字节单精度浮点数</td><td>1.0</td></tr><tr><td>DOUBLE</td><td>8 字节双精度浮点数</td><td>1.0</td></tr><tr><td>DEICIMAL</td><td>任意精度的带符号小数</td><td>1.0</td></tr><tr><td>STRING</td><td>字符串，变长</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>VARCHAR</td><td>变长字符串</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>CHAR</td><td>固定长度字符串</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>BINARY</td><td>字节数组</td><td>无法表示</td></tr><tr><td>TIMESTAMP</td><td>时间戳，毫秒值精度</td><td>162327493795</td></tr><tr><td>DATE</td><td>日期</td><td>‘2021-03-29&#39;</td></tr><tr><td>INTERVAL</td><td>时间频率间隔</td><td>&nbsp;</td></tr></tbody></table></div><p><strong>复杂类型</strong></p><div class="table-container"><table><thead><tr><th>类型</th><th>描述</th><th>字面量示例</th></tr></thead><tbody><tr><td>ARRAY</td><td>有序的同类型的集合</td><td>array(1, 2)</td></tr><tr><td>MAP</td><td>key-value，key 必须为原始类型，value 可以任意类型</td><td>map(&#39;a&#39;, 1, &#39;b&#39;, 2)</td></tr><tr><td>STRUCT</td><td>字段集合，类型可以不同</td><td>struct(&#39;1&#39;, 1, 1.0), named_struct(&#39;col1&#39;, &#39;1&#39;, &#39;col2&#39;, 1, &#39;clo3&#39;, 1.0)</td></tr><tr><td>UNION</td><td>在有限取值范围内的一个值</td><td>create_union(1, &#39;a&#39;, 63)</td></tr></tbody></table></div><p>对 decimal 类型简单解释下：</p><p>用法：<code>decimal(11, 2)</code> 代表最多有 11 位数字，其中后 2 位是小数，整数部分是 9 位；如果整数部分超过 9 位，则这个字段就会变成 <code>NULL</code>；如果小数部分不足 2 位，则后面用 0 补齐两位，如果小数部分超过两位，则超出部分四舍五入。</p><p>也可直接写 <code>decimal</code>，后面不指定位数，默认是 <code>decimal(10, 0)</code>，整数 10 位，没有小数。</p><h5 id="创建表并指定字段之间的分隔符"><a href="#创建表并指定字段之间的分隔符" class="headerlink" title="创建表并指定字段之间的分隔符"></a>创建表并指定字段之间的分隔符</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> stu2(<span class="keyword">id</span> <span class="built_in">int</span> ,<span class="keyword">name</span> <span class="keyword">string</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> <span class="keyword">stored</span> <span class="keyword">as</span> textfile location <span class="string">&#x27;/user/stu2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># row format delimited fields terminated by &#x27;\t&#x27; 指定字段分隔符，默认分隔符为 &#x27;\001&#x27;</span></span><br><span class="line"><span class="comment"># stored as 指定存储格式</span></span><br><span class="line"><span class="comment"># location 指定存储位置</span></span><br></pre></td></tr></table></figure><p></p><h5 id="根据查询结果创建表"><a href="#根据查询结果创建表" class="headerlink" title="根据查询结果创建表"></a>根据查询结果创建表</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu3 <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> stu2;</span><br></pre></td></tr></table></figure><p></p><h5 id="根据已经存在的表结构创建表"><a href="#根据已经存在的表结构创建表" class="headerlink" title="根据已经存在的表结构创建表"></a>根据已经存在的表结构创建表</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu4 <span class="keyword">like</span> stu2;</span><br></pre></td></tr></table></figure><p></p><h5 id="查询表的结构"><a href="#查询表的结构" class="headerlink" title="查询表的结构"></a>查询表的结构</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只查询表内字段及属性</span></span><br><span class="line">desc stu2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细查询</span></span><br><span class="line">desc formatted stu2;</span><br></pre></td></tr></table></figure><p></p><h5 id="查询创建表的语句"><a href="#查询创建表的语句" class="headerlink" title="查询创建表的语句"></a>查询创建表的语句</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> stu2;</span><br></pre></td></tr></table></figure><p></p><h4 id="对外部表操作"><a href="#对外部表操作" class="headerlink" title="对外部表操作"></a>对外部表操作</h4><p>外部表因为是指定其他的 HDFS 路径的数据加载到表当中来，所以 Hive 表会认为自己不完全独占这份数据，所以删除 Hive 表的时候，数据仍然存放在 HDFS 当中，不会删掉，只会删除表的元数据。</p><h5 id="构建外部表"><a href="#构建外部表" class="headerlink" title="构建外部表"></a>构建外部表</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> student (s_id <span class="keyword">string</span>,s_name <span class="keyword">string</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="从本地文件系统向表中加载数据"><a href="#从本地文件系统向表中加载数据" class="headerlink" title="从本地文件系统向表中加载数据"></a>从本地文件系统向表中加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 追加操作</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/student.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 覆盖操作</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/student.csv&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> student;</span><br></pre></td></tr></table></figure><p></p><h5 id="从-HDFS-文件系统向表中加载数据"><a href="#从-HDFS-文件系统向表中加载数据" class="headerlink" title="从 HDFS 文件系统向表中加载数据"></a>从 HDFS 文件系统向表中加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">&#x27;/hivedatas/techer.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> techer;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据到指定分区</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">&#x27;/hivedatas/techer.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> techer <span class="keyword">partition</span>(cur_date=<span class="number">20201210</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>、</p><ol><li>使用 <code>load data local</code> 表示从本地文件系统加载，文件会拷贝到 HDFS 上。</li><li>使用 <code>load data</code> 表示从 HDFS 文件系统加载，文件会直接移动到 Hive 相关目录下，注意不是拷贝过去，因为 Hive 认为 HDFS 文件已经有 3 副本了，没必要再次拷贝了。</li><li>如果表是分区表，<code>load</code> 时不指定分区会报错。</li><li>如果加载相同文件名的文件，会被自动重命名。</li></ol><h4 id="对分区表的操作"><a href="#对分区表的操作" class="headerlink" title="对分区表的操作"></a>对分区表的操作</h4><h5 id="创建分区表的语法"><a href="#创建分区表的语法" class="headerlink" title="创建分区表的语法"></a>创建分区表的语法</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(s_id <span class="keyword">string</span>, s_score <span class="built_in">int</span>) partitioned <span class="keyword">by</span> (<span class="keyword">month</span> <span class="keyword">string</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="创建一个表带多个分区"><a href="#创建一个表带多个分区" class="headerlink" title="创建一个表带多个分区"></a>创建一个表带多个分区</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score2 (s_id <span class="keyword">string</span>, s_score <span class="built_in">int</span>) partitioned <span class="keyword">by</span> (<span class="keyword">year</span> <span class="keyword">string</span>,<span class="keyword">month</span> <span class="keyword">string</span>,<span class="keyword">day</span> <span class="keyword">string</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong> Hive 表创建的时候可以用 <code>location</code> 指定一个文件或者文件夹，当指定文件夹时，Hive 会加载文件夹下的所有文件，当表中无分区时，这个文件夹下不能再有文件夹，否则报错。</p><p>当表是分区表时，比如 <code>partitioned by (day string)</code>，则这个文件夹下的每一个文件夹就是一个分区，且文件夹名为 <code>day=20201123</code> 这种格式，然后使用：<code>msck repair table score;</code> 修复表结构，成功之后即可看到数据已经全部加载到表当中去了</p><h5 id="加载数据到一个分区的表中"><a href="#加载数据到一个分区的表中" class="headerlink" title="加载数据到一个分区的表中"></a>加载数据到一个分区的表中</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span> (<span class="keyword">month</span>=<span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="加载数据到一个多分区的表中去"><a href="#加载数据到一个多分区的表中去" class="headerlink" title="加载数据到一个多分区的表中去"></a>加载数据到一个多分区的表中去</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> score2 <span class="keyword">partition</span>(<span class="keyword">year</span>=<span class="string">&#x27;2018&#x27;</span>,<span class="keyword">month</span>=<span class="string">&#x27;06&#x27;</span>,<span class="keyword">day</span>=<span class="string">&#x27;01&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">partitions</span> score;</span><br></pre></td></tr></table></figure><p></p><h5 id="添加一个分区"><a href="#添加一个分区" class="headerlink" title="添加一个分区"></a>添加一个分区</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="keyword">month</span>=<span class="string">&#x27;201805&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="同时添加多个分区"><a href="#同时添加多个分区" class="headerlink" title="同时添加多个分区"></a>同时添加多个分区</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="keyword">month</span>=<span class="string">&#x27;201804&#x27;</span>) <span class="keyword">partition</span>(<span class="keyword">month</span> = <span class="string">&#x27;201803&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>添加分区之后就可以在 HDFS 文件系统当中看到表下面多了一个文件夹。</p><h5 id="删除分区"><a href="#删除分区" class="headerlink" title="删除分区"></a>删除分区</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">drop</span> <span class="keyword">partition</span>(<span class="keyword">month</span> = <span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h4 id="对分桶表操作"><a href="#对分桶表操作" class="headerlink" title="对分桶表操作"></a>对分桶表操作</h4><p>将数据按照指定的字段进行分成多个桶中去，就是按照分桶字段进行哈希划分到多个文件当中去 分区就是分文件夹，分桶就是分文件。</p><p>分桶优点：</p><ul><li>提高 join 查询效率</li><li>提高抽样效率</li></ul><h5 id="开启-Hive-的捅表功能"><a href="#开启-Hive-的捅表功能" class="headerlink" title="开启 Hive 的捅表功能"></a>开启 Hive 的捅表功能</h5><p><code>set hive.enforce.bucketing=true;</code></p><h5 id="设置-Reduce-的个数"><a href="#设置-Reduce-的个数" class="headerlink" title="设置 Reduce 的个数"></a>设置 Reduce 的个数</h5><p><code>set mapreduce.job.reduces=3;</code></p><h5 id="创建桶表"><a href="#创建桶表" class="headerlink" title="创建桶表"></a>创建桶表</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course (c_id <span class="keyword">string</span>,c_name <span class="keyword">string</span>) clustered <span class="keyword">by</span>(c_id) <span class="keyword">into</span> <span class="number">3</span> buckets;</span><br></pre></td></tr></table></figure><p></p><p>桶表的数据加载：由于桶表的数据加载通过 <code>hdfs dfs -put</code> 文件或者通过 <code>load data</code> 均不可以，只能通过 <code>insert overwrite</code> 进行加载。</p><p>所以把文件加载到桶表中，需要先创建普通表，并通过 <code>insert overwrite</code> 的方式将普通表的数据通过查询的方式加载到桶表当中去。</p><h5 id="通过-insert-overwrite-给桶表中加载数据"><a href="#通过-insert-overwrite-给桶表中加载数据" class="headerlink" title="通过 insert overwrite 给桶表中加载数据"></a>通过 insert overwrite 给桶表中加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> course <span class="keyword">select</span> * <span class="keyword">from</span> course_common cluster <span class="keyword">by</span>(c_id); <span class="comment">-- 最后指定桶字段</span></span><br></pre></td></tr></table></figure><p></p><h4 id="修改表和删除表"><a href="#修改表和删除表" class="headerlink" title="修改表和删除表"></a>修改表和删除表</h4><h5 id="修改表名称"><a href="#修改表名称" class="headerlink" title="修改表名称"></a>修改表名称</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> old_table_name <span class="keyword">rename</span> <span class="keyword">to</span> new_table_name;</span><br></pre></td></tr></table></figure><p></p><h5 id="增加-修改列信息"><a href="#增加-修改列信息" class="headerlink" title="增加/修改列信息"></a>增加/修改列信息</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询表结构</span></span><br><span class="line">desc score5;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score5 <span class="keyword">add</span> <span class="keyword">columns</span> (mycol <span class="keyword">string</span>, mysco <span class="keyword">string</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score5 <span class="keyword">change</span> <span class="keyword">column</span> mysco mysconew <span class="built_in">int</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="删除表操作"><a href="#删除表操作" class="headerlink" title="删除表操作"></a>删除表操作</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> score5;</span><br></pre></td></tr></table></figure><p></p><h5 id="清空表操作"><a href="#清空表操作" class="headerlink" title="清空表操作"></a>清空表操作</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> score6;</span><br><span class="line"><span class="comment"># 只能清空管理表，也就是内部表；清空外部表，会产生错误</span></span><br></pre></td></tr></table></figure><p></p><p><strong>注意：truncate 和 drop：</strong></p><p>如果 HDFS 开启了回收站，<code>drop</code> 删除的表数据是可以从回收站恢复的，表结构恢复不了，需要自己重新创建；<code>truncate</code> 清空的表是不进回收站的，所以无法恢复 <code>truncate</code> 清空的表 所以 <code>truncate</code> 一定慎用，一旦清空将无力回天。</p><h4 id="向-Hive-表中加载数据"><a href="#向-Hive-表中加载数据" class="headerlink" title="向 Hive 表中加载数据"></a>向 Hive 表中加载数据</h4><h5 id="直接向分区表中插入数据"><a href="#直接向分区表中插入数据" class="headerlink" title="直接向分区表中插入数据"></a>直接向分区表中插入数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span>(<span class="keyword">month</span> =<span class="string">&#x27;201807&#x27;</span>) <span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>,<span class="string">&#x27;002&#x27;</span>,<span class="string">&#x27;100&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="通过-load-方式加载数据"><a href="#通过-load-方式加载数据" class="headerlink" title="通过 load 方式加载数据"></a>通过 load 方式加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span>(<span class="keyword">month</span>=<span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure><p></p><h5 id="通过查询方式加载数据"><a href="#通过查询方式加载数据" class="headerlink" title="通过查询方式加载数据"></a>通过查询方式加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> score2 <span class="keyword">partition</span>(<span class="keyword">month</span> = <span class="string">&#x27;201806&#x27;</span>) <span class="keyword">select</span> s_id,c_id,s_score <span class="keyword">from</span> score1;</span><br></pre></td></tr></table></figure><p></p><h5 id="查询语句中创建表并加载数据"><a href="#查询语句中创建表并加载数据" class="headerlink" title="查询语句中创建表并加载数据"></a>查询语句中创建表并加载数据</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score2 <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> score1;</span><br></pre></td></tr></table></figure><p></p><h5 id="在创建表是通过-location-指定加载数据的路径"><a href="#在创建表是通过-location-指定加载数据的路径" class="headerlink" title="在创建表是通过 location 指定加载数据的路径"></a>在创建表是通过 location 指定加载数据的路径</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> score6 (s_id <span class="keyword">string</span>,c_id <span class="keyword">string</span>,s_score <span class="built_in">int</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> location <span class="string">&#x27;/myscore&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="export-导出与-import-导入-Hive-表数据（内部表操作）"><a href="#export-导出与-import-导入-Hive-表数据（内部表操作）" class="headerlink" title="export 导出与 import 导入 Hive 表数据（内部表操作）"></a>export 导出与 import 导入 Hive 表数据（内部表操作）</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> techer2 <span class="keyword">like</span> techer; <span class="comment">--依据已有表结构创建表</span></span><br><span class="line"></span><br><span class="line">export table techer to &#x27;/export/techer&#x27;;</span><br><span class="line"></span><br><span class="line">import table techer2 from &#x27;/export/techer&#x27;;</span><br></pre></td></tr></table></figure><p></p><h4 id="Hive-表中数据导出"><a href="#Hive-表中数据导出" class="headerlink" title="Hive 表中数据导出"></a>Hive 表中数据导出</h4><h5 id="insert-导出"><a href="#insert-导出" class="headerlink" title="insert 导出"></a>insert 导出</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将查询的结果导出到本地</span></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="keyword">select</span> * <span class="keyword">from</span> score;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查询的结果格式化导出到本地</span></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span> <span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查询的结果导出到 HDFS 上（没有 local）</span></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">directory</span> <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span> <span class="keyword">select</span> * <span class="keyword">from</span> score;</span><br></pre></td></tr></table></figure><p></p><h5 id="Hadoop-命令导出到本地"><a href="#Hadoop-命令导出到本地" class="headerlink" title="Hadoop 命令导出到本地"></a>Hadoop 命令导出到本地</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs -get /export/servers/exporthive/000000_0 /export/servers/exporthive/local.txt;</span><br></pre></td></tr></table></figure><p></p><h5 id="hive-shell-命令导出"><a href="#hive-shell-命令导出" class="headerlink" title="hive shell 命令导出"></a>hive shell 命令导出</h5><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本语法：hive -f/-e 执行语句或者脚本 &gt; file</span></span><br><span class="line"></span><br><span class="line">hive -e &quot;select * from myhive.score;&quot; &gt; /export/servers/exporthive/score.txt</span><br><span class="line"></span><br><span class="line">hive -f export.sh &gt; /export/servers/exporthive/score.txt</span><br></pre></td></tr></table></figure><p></p><h5 id="export-导出到-HDFS-上"><a href="#export-导出到-HDFS-上" class="headerlink" title="export 导出到 HDFS 上"></a>export 导出到 HDFS 上</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export table score to &#x27;/export/exporthive/score&#x27;;</span><br></pre></td></tr></table></figure><p></p><h2 id="Hive-的-DQL-语法"><a href="#Hive-的-DQL-语法" class="headerlink" title="Hive 的 DQL 语法"></a>Hive 的 DQL 语法</h2><h3 id="单表查询、关联查询"><a href="#单表查询、关联查询" class="headerlink" title="单表查询、关联查询"></a>单表查询、关联查询</h3><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">ALL</span> | <span class="keyword">DISTINCT</span>] select_expr, select_expr, ... </span><br><span class="line"><span class="keyword">FROM</span> table_reference</span><br><span class="line">[<span class="keyword">WHERE</span> where_condition] </span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> col_list [<span class="keyword">HAVING</span> condition]] </span><br><span class="line">[CLUSTER <span class="keyword">BY</span> col_list | [<span class="keyword">DISTRIBUTE</span> <span class="keyword">BY</span> col_list] [<span class="keyword">SORT</span> <span class="keyword">BY</span>| <span class="keyword">ORDER</span> <span class="keyword">BY</span> col_list]] </span><br><span class="line">[<span class="keyword">LIMIT</span> <span class="built_in">number</span>]</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong></p><ol><li><code>order by</code> 会对输入做全局排序，因此只有一个 reducer，会导致当输入规模较大时，需要较长的计算时间。</li><li><code>sort by</code> 不是全局排序，其在数据进入 reducer 前完成排序。因此，如果用 <code>sort by</code> 进行排序，并且设置 <code>mapred.reduce.tasks&gt;1</code>，则 <code>sort by</code> 只保证每个 reducer 的输出有序，不保证全局有序。</li><li><code>distribute by(字段)</code> 根据指定的字段将数据分到不同的 reducer，且分发算法是 hash 散列。</li><li><code>cluster by(字段)</code> 除了具有 <code>distribute by</code> 的功能外，还会对该字段进行排序。</li></ol><p>因此，如果分桶和 <code>sort</code> 字段是同一个时，此时，<code>cluster by = distribute by + sort by</code>。</p><h4 id="WHERE-语句"><a href="#WHERE-语句" class="headerlink" title="WHERE 语句"></a>WHERE 语句</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">where</span> s_score &lt; <span class="number">60</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>小于某个值是不包含 NULL 的，如上查询结果是把 s_score 为 NULL 的行剔除的。</p><h4 id="GROUP-BY-分组"><a href="#GROUP-BY-分组" class="headerlink" title="GROUP BY 分组"></a>GROUP BY 分组</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s_id ,<span class="keyword">avg</span>(s_score) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> s_id;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组后对数据进行筛选，使用 having</span></span><br><span class="line"><span class="keyword">select</span> s_id ,<span class="keyword">avg</span>(s_score) avgscore <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> s_id <span class="keyword">having</span> avgscore &gt; <span class="number">85</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong></p><p>如果使用 <code>group by</code> 分组，则 <code>select</code> 后面只能写分组的字段或者聚合函数。 <code>where</code> 和 <code>having</code> 区别：</p><ul><li><code>having</code> 是在 <code>group by</code> 分完组之后再对数据进行筛选，所以 <code>having</code> 要筛选的字段只能是分组字段或者聚合函数</li><li><code>where</code> 是从数据表中的字段直接进行的筛选的，所以不能跟在 <code>group by</code> 后面，也不能使用聚合函数</li></ul><h4 id="JOIN-连接"><a href="#JOIN-连接" class="headerlink" title="JOIN 连接"></a>JOIN 连接</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># INNER JOIN 内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> techer t [<span class="keyword">inner</span>] <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id = c.t_id; <span class="comment">-- inner 可省略</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LEFT OUTER JOIN 左外连接：左边所有数据会被返回，右边符合条件的被返回</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> techer t <span class="keyword">left</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id = c.t_id; <span class="comment">-- outer 可省略</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RIGHT OUTER JOIN 右外连接：右边所有数据会被返回，左边符合条件的被返回</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> techer t <span class="keyword">right</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id = c.t_id;</span><br><span class="line"></span><br><span class="line"><span class="comment"># FULL OUTER JOIN 满外(全外)连接: 将会返回所有表中符合条件的所有记录。如果任一表的指定字段没有符合条件的值的话，那么就使用 NULL 值替代。</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> techer t <span class="keyword">FULL</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id = c.t_id;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong></p><ol><li>Hive2 版本已经支持不等值连接，就是 <code>join on</code> 条件后面可以使用大于小于符号了；并且也支持 <code>join on</code> 条件后跟 <code>or</code>（早前版本 <code>on</code> 后只支持 <code>=</code> 和 <code>and</code>，不支持 <code>&gt;</code>、<code>&lt;</code> 和 <code>or</code>）；</li><li>如 Hive 执行引擎使用 MapReduce，一个 <code>join</code> 就会启动一个 job，一条 sql 语句中如有多个 <code>join</code>，则会启动多个 job。</li></ol><p><strong>注意：</strong>表之间用 <code>逗号(,)</code> 连接和 <code>inner join</code> 是一样的。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table_a,table_b <span class="keyword">where</span> table_a.id = table_b.id;</span><br></pre></td></tr></table></figure><p></p><p>它们的执行效率没有区别，只是书写方式不同，用 <code>逗号(,)</code> 是 sql 89 标准，<code>join</code> 是 sql 92 标准。用 <code>逗号(,)</code> 连接后面过滤条件用 <code>where</code> ，用 <code>join</code> 连接后面过滤条件是 <code>on</code>。</p><h4 id="ORDER-BY-排序"><a href="#ORDER-BY-排序" class="headerlink" title="ORDER BY 排序"></a>ORDER BY 排序</h4><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局排序，只会有一个 reduce</span></span><br><span class="line"><span class="comment"># ASC（ascend）: 升序（默认） DESC（descend）: 降序</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student s <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sco <span class="keyword">ON</span> s.s_id = sco.s_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sco.s_score <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong><code>order by</code> 是全局排序，所以最后只有一个 reduce，也就是在一个节点执行，如果数据量太大，就会耗费较长时间。</p><h4 id="SORT-BY-局部排序"><a href="#SORT-BY-局部排序" class="headerlink" title="SORT BY 局部排序"></a>SORT BY 局部排序</h4><p>每个 MapReduce 内部进行排序，对全局结果集来说不是排序。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 reduce 个数</span></span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看设置 reduce 个数</span></span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询成绩按照成绩降序排列</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">sort</span> <span class="keyword">by</span> s_score;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查询结果导入到文件中（按照成绩降序排列）</span></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">&#x27;/export/servers/hivedatas/sort&#x27;</span> <span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">sort</span> <span class="keyword">by</span> s_score;</span><br></pre></td></tr></table></figure><p></p><h4 id="DISTRIBUTE-BY-分区排序"><a href="#DISTRIBUTE-BY-分区排序" class="headerlink" title="DISTRIBUTE BY 分区排序"></a>DISTRIBUTE BY 分区排序</h4><p><code>distribute by</code> 类似 MR 中 partition，进行分区，结合 <code>sort by</code> 使用。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 reduce 的个数，将我们对应的 s_id 划分到对应的 reduce 当中去</span></span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces=<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 distribute by 进行数据的分区</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">distribute</span> <span class="keyword">by</span> s_id <span class="keyword">sort</span> <span class="keyword">by</span> s_score;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>Hive 要求 <code>distribute by</code> 语句要写在 <code>sort by</code> 语句之前。</p><h4 id="CLUSTER-BY-排序"><a href="#CLUSTER-BY-排序" class="headerlink" title="CLUSTER BY 排序"></a>CLUSTER BY 排序</h4><p>当 <code>distribute by</code> 和 <code>sort by</code> 字段相同时，可以使用 <code>cluster by</code> 方式。<code>cluster by</code> 除了具有 <code>distribute by</code> 的功能外还兼具 <code>sort by</code> 的功能。但是排序只能是正序排序，不能指定排序规则为 <code>ASC</code> 或者 <code>DESC</code>。</p><p>以下两种写法等价：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score cluster <span class="keyword">by</span> s_id;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">distribute</span> <span class="keyword">by</span> s_id <span class="keyword">sort</span> <span class="keyword">by</span> s_id;</span><br></pre></td></tr></table></figure><p></p><h3 id="Hive-函数"><a href="#Hive-函数" class="headerlink" title="Hive 函数"></a>Hive 函数</h3><h4 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h4><p>Hive 支持 <code>count()</code>，<code>max()</code>，<code>min()</code>，<code>sum()</code>，<code>avg()</code> 等常用的聚合函数。</p><p><strong>注意：</strong></p><ul><li>聚合操作时要注意 NULL 值；</li><li><code>count(*)</code> 包含 NULL 值，统计所有行数；</li><li><code>count(id)</code> 不包含 NULL 值；</li><li><code>min</code> 求最小值是不包含 NULL，除非所有值都是 NULL；</li><li><code>avg</code> 求平均值也是不包含 NULL。</li></ul><h5 id="非空集合总体变量函数"><a href="#非空集合总体变量函数" class="headerlink" title="非空集合总体变量函数"></a>非空集合总体变量函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：var_pop(col)</span><br><span class="line">返回值：double</span><br><span class="line">说明：统计结果集中 col 非空集合的总体变量（忽略 NULL）</span><br></pre></td></tr></table></figure><p></p><h5 id="非空集合样本变量函数"><a href="#非空集合样本变量函数" class="headerlink" title="非空集合样本变量函数"></a>非空集合样本变量函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：var_samp(col)</span><br><span class="line">返回值：double</span><br><span class="line">说明：统计结果集中 col 非空集合的样本变量（忽略 NULL）</span><br></pre></td></tr></table></figure><p></p><h5 id="总体标准偏离函数"><a href="#总体标准偏离函数" class="headerlink" title="总体标准偏离函数"></a>总体标准偏离函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：stddev_pop(col)</span><br><span class="line">返回值：double</span><br><span class="line">说明：该函数计算总体标准偏离，并返回总体变量的平方根，其返回值与 VAR_POP 函数的平方根相同</span><br></pre></td></tr></table></figure><p></p><h5 id="中位数函数"><a href="#中位数函数" class="headerlink" title="中位数函数"></a>中位数函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：percentile(bigint col, p)</span><br><span class="line">返回值：double</span><br><span class="line">说明：求准确的第 p 个百分位数，p 必须介于 0 和 1 之间，但是 col 字段目前只支持整数，不支持浮点数类型</span><br></pre></td></tr></table></figure><p></p><h4 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h4><p>支持：等值(=)、不等值(!= 或 &lt;&gt;)、小于(&lt;)、小于等于(&lt;=)、大于(&gt;)、大于等于(&gt;=)、空值判断(IS NULL)、非空判断(IS NOT NULL)。</p><h5 id="LIKE-比较"><a href="#LIKE-比较" class="headerlink" title="LIKE 比较"></a>LIKE 比较</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：A LIKE B</span><br><span class="line">操作类型: string</span><br><span class="line">说明：如果字符串 A 或者字符串 B 为 NULL，则返回 NULL；如果字符串 A 符合表达式 B 的正则语法，则为 TRUE；否则为 FALSE。B 中字符(_) 表示任意单个字符，而字符(%) 表示任意数量的字符。</span><br></pre></td></tr></table></figure><p></p><h5 id="RLIKE-操作"><a href="#RLIKE-操作" class="headerlink" title="RLIKE 操作"></a>RLIKE 操作</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：A RLIKE B</span><br><span class="line">操作类型: string</span><br><span class="line">说明：如果字符串 A 或者字符串 B 为 NULL，则返回 NULL；如果字符串 A 符合 Java 正则表达式 B 的正则语法，则为 TRUE；否则为 FALSE。</span><br></pre></td></tr></table></figure><p></p><h5 id="REGEXP-操作"><a href="#REGEXP-操作" class="headerlink" title="REGEXP 操作"></a>REGEXP 操作</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：A REGEXP B</span><br><span class="line">操作类型: string</span><br><span class="line">说明：功能与 RLIKE 相同</span><br><span class="line">示例：<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> tableName <span class="keyword">where</span> <span class="string">&#x27;footbar&#x27;</span> REGEXP <span class="string">&#x27;^f.*r$&#x27;</span>;</span><br><span class="line">结果：1</span><br></pre></td></tr></table></figure><p></p><h4 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h4><p>支持所有数值类型：加(+)、减(-)、乘(*)、除(/)、取余(%)、位与(&amp;)、位或(|)、位异或(^)、位取反(~)。</p><h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p>支持：逻辑与(and)、逻辑或(or)、逻辑非(not)。</p><h4 id="数值运算"><a href="#数值运算" class="headerlink" title="数值运算"></a>数值运算</h4><h5 id="取整函数-round"><a href="#取整函数-round" class="headerlink" title="取整函数 round"></a>取整函数 round</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：round(double a)</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：返回 double 类型的整数值部分（遵循四舍五入）</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">3.1415926</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：3</span><br></pre></td></tr></table></figure><p></p><h5 id="指定精度取整函数-round"><a href="#指定精度取整函数-round" class="headerlink" title="指定精度取整函数 round"></a>指定精度取整函数 round</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：round(double a, int d)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回指定精度 d 的 double 类型</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">3.1415926</span>,<span class="number">4</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：3.1416</span><br></pre></td></tr></table></figure><p></p><h5 id="向下取整函数-floor"><a href="#向下取整函数-floor" class="headerlink" title="向下取整函数 floor"></a>向下取整函数 floor</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：floor(double a)</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：返回等于或者小于该 double 变量的最大的整数</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">floor</span>(<span class="number">3.641</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：3</span><br></pre></td></tr></table></figure><p></p><h5 id="向上取整函数-ceil"><a href="#向上取整函数-ceil" class="headerlink" title="向上取整函数 ceil"></a>向上取整函数 ceil</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：ceil(double a)</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：返回等于或者大于该 double 变量的最小的整数</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">ceil</span>(<span class="number">3.1415926</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：4</span><br></pre></td></tr></table></figure><p></p><h5 id="取随机数函数-rand"><a href="#取随机数函数-rand" class="headerlink" title="取随机数函数 rand"></a>取随机数函数 rand</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：rand(), rand(int seed)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回一个 0 到 1 范围内的随机数。如果指定种子 seed，则会等到一个稳定的随机数序列</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">rand</span>() <span class="keyword">from</span> tableName; <span class="comment">-- 每次执行此语句得到的结果都不同</span></span><br><span class="line">结果：0.5577432776034763</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">rand</span>(<span class="number">100</span>); <span class="comment">-- 只要指定种子，每次执行此语句得到的结果一样的</span></span><br><span class="line">结果：0.7220096548596434</span><br></pre></td></tr></table></figure><p></p><h5 id="自然指数函数-exp"><a href="#自然指数函数-exp" class="headerlink" title="自然指数函数 exp"></a>自然指数函数 exp</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：exp(double a)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回自然对数 e 的 a 次方</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">exp</span>(<span class="number">2</span>);</span><br><span class="line">结果：7.38905609893065</span><br></pre></td></tr></table></figure><p></p><h5 id="以-10-为底对数函数-log10"><a href="#以-10-为底对数函数-log10" class="headerlink" title="以 10 为底对数函数 log10"></a>以 10 为底对数函数 log10</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：log10(double a)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回以 10 为底的 a 的对数</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">log10</span>(<span class="number">100</span>);</span><br><span class="line">结果：2.0</span><br><span class="line">此外还有：以 2 为底对数函数：log2()、对数函数：log()</span><br></pre></td></tr></table></figure><p></p><h5 id="幂运算函数-pow"><a href="#幂运算函数-pow" class="headerlink" title="幂运算函数 pow"></a>幂运算函数 pow</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：pow(double a, double p)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回 a 的 p 次幂</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">pow</span>(<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line">结果：16.0</span><br></pre></td></tr></table></figure><p></p><h5 id="开平方函数-sqrt"><a href="#开平方函数-sqrt" class="headerlink" title="开平方函数 sqrt"></a>开平方函数 sqrt</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：sqrt(double a)</span><br><span class="line">返回值：double</span><br><span class="line">说明：返回 a 的平方根</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">sqrt</span>(<span class="number">16</span>);</span><br><span class="line">结果：4.0</span><br></pre></td></tr></table></figure><p></p><h5 id="二进制函数-bin"><a href="#二进制函数-bin" class="headerlink" title="二进制函数 bin"></a>二进制函数 bin</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：bin(bigint a)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回 a 的二进制代码表示</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">bin</span>(<span class="number">7</span>);</span><br><span class="line">结果：111</span><br><span class="line">十六进制函数：hex()、将十六进制转化为字符串函数：unhex()</span><br><span class="line">进制转换函数：conv(bigint num, int from_base, int to_base) 说明：将数值 num 从 from_base 进制转化到 to_base 进制</span><br></pre></td></tr></table></figure><p></p><p>此外还有很多数学函数：绝对值函数：<code>abs()</code>、正取余函数：<code>pmod()</code>、正弦函数：<code>sin()</code>、反正弦函数：<code>asin()</code>、余弦函数：<code>cos()</code>、反余弦函数：<code>acos()</code>、positive 函数：<code>positive()</code>、negative 函数：<code>negative()</code>。</p><h4 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h4><h5 id="IF-函数"><a href="#IF-函数" class="headerlink" title="IF 函数"></a>IF 函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：if(boolean testCondition, T valueTrue, T valueFalseOrNULL)</span><br><span class="line">返回值：T</span><br><span class="line">说明：当条件 testCondition 为 TRUE 时，返回 valueTrue；否则返回 valueFalseOrNULL</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">1</span>=<span class="number">2</span>, <span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">结果：200</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">1</span>=<span class="number">1</span>, <span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">结果：100</span><br></pre></td></tr></table></figure><p></p><h5 id="非空查找函数-coalesce"><a href="#非空查找函数-coalesce" class="headerlink" title="非空查找函数 coalesce"></a>非空查找函数 coalesce</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：coalesce(T v1, T v2, …)</span><br><span class="line">返回值：T</span><br><span class="line">说明：返回参数中的第一个非空值；如果所有值都为 NULL，那么返回 NULL</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">coalesce</span>(<span class="literal">NULL</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line">结果：100</span><br></pre></td></tr></table></figure><p></p><h5 id="条件判断函数-case-when"><a href="#条件判断函数-case-when" class="headerlink" title="条件判断函数 case when"></a>条件判断函数 case when</h5><p><strong>用法一</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：case when a then b [when c then d]* [else e] end</span><br><span class="line">返回值：T</span><br><span class="line">说明：如果 a 为 TRUE，则返回 b；如果 c 为 TRUE，则返回 d；否则返回 e。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="number">1</span>=<span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;tom&#x27;</span> <span class="keyword">when</span> <span class="number">2</span>=<span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;mary&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;tim&#x27;</span> <span class="keyword">end</span> <span class="keyword">from</span> tableName;</span><br><span class="line">结果：mary</span><br></pre></td></tr></table></figure><p></p><p><strong>用法二</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：case a when b then c [when d then e]* [else f] end</span><br><span class="line">返回值：T</span><br><span class="line">说明：如果 a 等于 b，那么返回 c；如果 a 等于 d，那么返回 e；否则返回 f。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">case</span> <span class="number">100</span> <span class="keyword">when</span> <span class="number">50</span> <span class="keyword">then</span> <span class="string">&#x27;tom&#x27;</span> <span class="keyword">when</span> <span class="number">100</span> <span class="keyword">then</span> <span class="string">&#x27;mary&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;tim&#x27;</span> <span class="keyword">end</span> <span class="keyword">from</span> tableName;</span><br><span class="line">结果：mary</span><br></pre></td></tr></table></figure><p></p><h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><p><strong>注意：</strong>以下 SQL 语句中的 <code>from tableName</code> 可去掉，不影响查询结果</p><h5 id="获取当前-UNIX-时间戳函数-unix-timestamp"><a href="#获取当前-UNIX-时间戳函数-unix-timestamp" class="headerlink" title="获取当前 UNIX 时间戳函数 unix_timestamp"></a>获取当前 UNIX 时间戳函数 unix_timestamp</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：unix_timestamp()</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：获得当前时区的 UNIX 时间戳</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">unix_timestamp</span>() <span class="keyword">from</span> tableName;</span><br><span class="line">结果：1616906976</span><br></pre></td></tr></table></figure><p></p><h5 id="UNIX-时间戳转日期函数-from-unixtime"><a href="#UNIX-时间戳转日期函数-from-unixtime" class="headerlink" title="UNIX 时间戳转日期函数 from_unixtime"></a>UNIX 时间戳转日期函数 from_unixtime</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：from_unixtime(bigint unixtime[, string format])</span><br><span class="line">返回值：string</span><br><span class="line">说明：转化 UNIX 时间戳（从 1970-01-01 00:00:00 UTC 到指定时间的秒数）到当前时区的时间格式</span><br><span class="line">示例：<span class="keyword">select</span> from_unixtime(<span class="number">1616906976</span>, <span class="string">&#x27;yyyyMMdd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：20210328</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转-UNIX-时间戳函数-unix-timestamp"><a href="#日期转-UNIX-时间戳函数-unix-timestamp" class="headerlink" title="日期转 UNIX 时间戳函数 unix_timestamp"></a>日期转 UNIX 时间戳函数 unix_timestamp</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：unix_timestamp(string date)</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：转换格式为 &quot;yyyy-MM-dd HH:mm:ss&quot; 的日期到 UNIX 时间戳。如果转化失败，则返回 NULL。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">unix_timestamp</span>(<span class="string">&#x27;2021-03-08 14:21:15&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：1615184475</span><br></pre></td></tr></table></figure><p></p><h5 id="指定格式日期转-UNIX-时间戳函数-unix-timestamp"><a href="#指定格式日期转-UNIX-时间戳函数-unix-timestamp" class="headerlink" title="指定格式日期转 UNIX 时间戳函数 unix_timestamp"></a>指定格式日期转 UNIX 时间戳函数 unix_timestamp</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：unix_timestamp(string date, string pattern)</span><br><span class="line">返回值：bigint</span><br><span class="line">说明：转换 pattern 格式的日期到 UNIX 时间戳。如果转化失败，则返回 NULL。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">unix_timestamp</span>(<span class="string">&#x27;2021-03-08 14:21:15&#x27;</span>, <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：1615184475</span><br></pre></td></tr></table></figure><p></p><h5 id="日期时间转日期函数-to-date"><a href="#日期时间转日期函数-to-date" class="headerlink" title="日期时间转日期函数 to_date"></a>日期时间转日期函数 to_date</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：to_date(string timestamp)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回日期时间字段中的日期部分。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">to_date</span>(<span class="string">&#x27;2021-03-28 14:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2021-03-28</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转年函数-year"><a href="#日期转年函数-year" class="headerlink" title="日期转年函数 year"></a>日期转年函数 year</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：year(string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的年。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">year</span>(<span class="string">&#x27;2021-03-28 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2021</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">year</span>(<span class="string">&#x27;2021-03-28&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2021</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转月函数-month"><a href="#日期转月函数-month" class="headerlink" title="日期转月函数 month"></a>日期转月函数 month</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：month (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的月份。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">month</span>(<span class="string">&#x27;2020-12-28 12:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：12</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">month</span>(<span class="string">&#x27;2021-03-08&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：8</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转天函数-day"><a href="#日期转天函数-day" class="headerlink" title="日期转天函数 day"></a>日期转天函数 day</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：day (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的天。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">day</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：8</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">day</span>(<span class="string">&#x27;2020-12-24&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：24</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转小时函数-hour"><a href="#日期转小时函数-hour" class="headerlink" title="日期转小时函数 hour"></a>日期转小时函数 hour</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：hour (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的小时。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">hour</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：10</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转分钟函数-minute"><a href="#日期转分钟函数-minute" class="headerlink" title="日期转分钟函数 minute"></a>日期转分钟函数 minute</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：minute (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的分钟。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">minute</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：3</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转秒函数-second"><a href="#日期转秒函数-second" class="headerlink" title="日期转秒函数 second"></a>日期转秒函数 second</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：second (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期中的秒。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">second</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：1</span><br></pre></td></tr></table></figure><p></p><h5 id="日期转周函数-weekofyear"><a href="#日期转周函数-weekofyear" class="headerlink" title="日期转周函数 weekofyear"></a>日期转周函数 weekofyear</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：weekofyear (string date)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回日期在当前的周数。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">weekofyear</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：49</span><br></pre></td></tr></table></figure><p></p><h5 id="日期比较函数-datediff"><a href="#日期比较函数-datediff" class="headerlink" title="日期比较函数 datediff"></a>日期比较函数 datediff</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：datediff(string enddate, string startdate)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回结束日期减去开始日期的天数。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">datediff</span>(<span class="string">&#x27;2020-12-08&#x27;</span>, <span class="string">&#x27;2012-05-09&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：213</span><br></pre></td></tr></table></figure><p></p><h5 id="日期增加函数-date-add"><a href="#日期增加函数-date-add" class="headerlink" title="日期增加函数 date_add"></a>日期增加函数 date_add</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：date_add(string startdate, int days)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回开始日期 startdate 增加 days 天后的日期。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">date_add</span>(<span class="string">&#x27;2020-12-08&#x27;</span>, <span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2020-12-18</span><br></pre></td></tr></table></figure><p></p><h5 id="日期减少函数-date-sub"><a href="#日期减少函数-date-sub" class="headerlink" title="日期减少函数 date_sub"></a>日期减少函数 date_sub</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：date_sub (string startdate, int days)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回开始日期 startdate 减少 days 天后的日期。</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">date_sub</span>(<span class="string">&#x27;2020-12-08&#x27;</span>, <span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2020-11-28</span><br></pre></td></tr></table></figure><p></p><h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><h5 id="字符串长度函数-length"><a href="#字符串长度函数-length" class="headerlink" title="字符串长度函数 length"></a>字符串长度函数 length</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：length(string A)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回字符串 A 的长度</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">length</span>(<span class="string">&#x27;abcdefg&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：7</span><br></pre></td></tr></table></figure><p></p><h5 id="字符串反转函数-reverse"><a href="#字符串反转函数-reverse" class="headerlink" title="字符串反转函数 reverse"></a>字符串反转函数 reverse</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：reverse(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回字符串 A 的反转结果</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">reverse</span>(<span class="string">&#x27;abcdefg&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：gfedcba</span><br></pre></td></tr></table></figure><p></p><h5 id="字符串连接函数-concat"><a href="#字符串连接函数-concat" class="headerlink" title="字符串连接函数 concat"></a>字符串连接函数 concat</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：concat(string A, string B…)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回输入字符串连接后的结果，支持任意个输入字符串</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;gh&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abcdefgh</span><br></pre></td></tr></table></figure><p></p><h5 id="带分隔符字符串连接函数-concat-ws"><a href="#带分隔符字符串连接函数-concat-ws" class="headerlink" title="带分隔符字符串连接函数 concat_ws"></a>带分隔符字符串连接函数 concat_ws</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：concat_ws(string SEP, string A, string B…)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回输入字符串连接后的结果，SEP 表示各个字符串间的分隔符</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">concat_ws</span>(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;gh&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abc,def,gh</span><br></pre></td></tr></table></figure><p></p><h5 id="字符串截取函数-substr-substring"><a href="#字符串截取函数-substr-substring" class="headerlink" title="字符串截取函数 substr, substring"></a>字符串截取函数 substr, substring</h5><p><strong>用法一</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：substr(string A, int <span class="keyword">start</span>), <span class="keyword">substring</span>(<span class="keyword">string</span> A, <span class="built_in">int</span> <span class="keyword">start</span>)</span><br><span class="line">返回值：<span class="keyword">string</span></span><br><span class="line">说明：返回字符串 A 从 <span class="keyword">start</span> 位置到结尾的字符串</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">3</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：cde</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substring</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">3</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：cde</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">-1</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：e</span><br></pre></td></tr></table></figure><p></p><p><strong>用法二</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：substr(string A, int <span class="keyword">start</span>, <span class="built_in">int</span> <span class="keyword">len</span>), <span class="keyword">substring</span>(<span class="keyword">string</span> A, <span class="built_in">int</span> <span class="keyword">start</span>, <span class="built_in">int</span> <span class="keyword">len</span>)</span><br><span class="line">返回值：<span class="keyword">string</span></span><br><span class="line">说明：返回字符串 A 从 <span class="keyword">start</span> 位置开始，长度为 <span class="keyword">len</span> 的字符串</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">3</span>, <span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：cd</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substring</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">3</span>, <span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：cd</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">substring</span>(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">-2</span>, <span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：de</span><br></pre></td></tr></table></figure><p></p><h5 id="字符串转大写函数-upper-ucase"><a href="#字符串转大写函数-upper-ucase" class="headerlink" title="字符串转大写函数 upper, ucase"></a>字符串转大写函数 upper, ucase</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：upper(string A) ucase(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回字符串 A 的大写格式</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">upper</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：ABSED</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">ucase</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：ABSED</span><br></pre></td></tr></table></figure><p></p><h5 id="字符串转小写函数-lower-lcase"><a href="#字符串转小写函数-lower-lcase" class="headerlink" title="字符串转小写函数 lower, lcase"></a>字符串转小写函数 lower, lcase</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：lower(string A), lcase(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回字符串 A 的小写格式</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">lower</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：absed</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">lcase</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：absed</span><br></pre></td></tr></table></figure><p></p><h5 id="去空格函数-trim"><a href="#去空格函数-trim" class="headerlink" title="去空格函数 trim"></a>去空格函数 trim</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：trim(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：去除字符串两边的空格</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abc</span><br></pre></td></tr></table></figure><p></p><h5 id="左边去空格函数-ltrim"><a href="#左边去空格函数-ltrim" class="headerlink" title="左边去空格函数 ltrim"></a>左边去空格函数 ltrim</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：ltrim(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：去除字符串左边的空格</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">ltrim</span>(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abc</span><br></pre></td></tr></table></figure><p></p><h5 id="右边去空格函数-rtrim"><a href="#右边去空格函数-rtrim" class="headerlink" title="右边去空格函数 rtrim"></a>右边去空格函数 rtrim</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：rtrim(string A)</span><br><span class="line">返回值：string</span><br><span class="line">说明：去除字符串右边的空格</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">rtrim</span>(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abc</span><br></pre></td></tr></table></figure><p></p><h5 id="正则表达式替换函数-regexp-replace"><a href="#正则表达式替换函数-regexp-replace" class="headerlink" title="正则表达式替换函数 regexp_replace"></a>正则表达式替换函数 regexp_replace</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：regexp_replace(string A, string B, string C)</span><br><span class="line">返回值：string</span><br><span class="line">说明：将字符串 A 中的符合 Java 正则表达式 B 的部分替换为 C。注意，在有些情况下要使用转义字符，类似 oracle 中的 regexp_replace 函数。</span><br><span class="line">示例：<span class="keyword">select</span> regexp_replace(<span class="string">&#x27;foobar&#x27;</span>, <span class="string">&#x27;oo|ar&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：fb</span><br></pre></td></tr></table></figure><p></p><h5 id="正则表达式解析函数-regexp-extract"><a href="#正则表达式解析函数-regexp-extract" class="headerlink" title="正则表达式解析函数 regexp_extract"></a>正则表达式解析函数 regexp_extract</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：regexp_extract(string subject, string pattern, int index)</span><br><span class="line">返回值：string</span><br><span class="line">说明：将字符串 subject 按照 pattern 正则表达式的规则拆分，返回 index 指定的字符。</span><br><span class="line">示例：<span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">1</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：the</span><br><span class="line">示例：<span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：bar</span><br><span class="line">示例：<span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">0</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：foothebar</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>在有些情况下要使用转义字符，下面的等号要用双竖线转义，这是 Java 正则表达式的规则。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> data_field,</span><br><span class="line">regexp_extract(data_field, <span class="string">&#x27;.*?bgStart\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> aaa,</span><br><span class="line">regexp_extract(data_field, <span class="string">&#x27;.*?contentLoaded_headStart\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> bbb,</span><br><span class="line">regexp_extract(data_field, <span class="string">&#x27;.*?AppLoad2Req\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> ccc </span><br><span class="line"><span class="keyword">from</span> pt_nginx_loginlog_st </span><br><span class="line"><span class="keyword">where</span> pt = <span class="string">&#x27;2021-03-28&#x27;</span> <span class="keyword">limit</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="URL-解析函数-parse-url"><a href="#URL-解析函数-parse-url" class="headerlink" title="URL 解析函数 parse_url"></a>URL 解析函数 parse_url</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：parse_url(string urlString, string partToExtract [, string keyToExtract])</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回 URL 中指定的部分。partToExtract 的有效值为：HOST，PATH，QUERY，REF，PROTOCOL，AUTHORITY，FILE，USERINFO。</span><br><span class="line">示例：<span class="keyword">select</span> parse_url(<span class="string">&#x27;https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#x27;</span>, <span class="string">&#x27;HOST&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：www.tableName.com </span><br><span class="line">示例：<span class="keyword">select</span> parse_url(<span class="string">&#x27;https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;k1&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：v1</span><br></pre></td></tr></table></figure><p></p><h5 id="JSON-解析函数-get-json-object"><a href="#JSON-解析函数-get-json-object" class="headerlink" title="JSON 解析函数 get_json_object"></a>JSON 解析函数 get_json_object</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：get_json_object(string json_string, string path)</span><br><span class="line">返回值：string</span><br><span class="line">说明：解析 JSON 的字符串 json_string，返回 path 指定的内容。如果输入的 JSON 字符串无效，那么返回 NULL。</span><br><span class="line">示例：<span class="keyword">select</span> get_json_object(<span class="string">&#x27;&#123;&quot;store&quot;:&#123;&quot;fruit&quot;:\[&#123;&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;&#125;,&#123;&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;&#125;], &quot;bicycle&quot;:&#123;&quot;price&quot;:19.95,&quot;color&quot;:&quot;red&quot;&#125; &#125;,&quot;email&quot;:&quot;amy@only_for_json_udf_test.net&quot;,&quot;owner&quot;:&quot;amy&quot;&#125;&#x27;</span>, <span class="string">&#x27;$.owner&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：amy</span><br></pre></td></tr></table></figure><p></p><h5 id="空格字符串函数-space"><a href="#空格字符串函数-space" class="headerlink" title="空格字符串函数 space"></a>空格字符串函数 space</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：space(int n)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回长度为 n 的字符串</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">space</span>(<span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">space</span>(<span class="number">10</span>)) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：10</span><br></pre></td></tr></table></figure><p></p><h5 id="重复字符串函数-repeat"><a href="#重复字符串函数-repeat" class="headerlink" title="重复字符串函数 repeat"></a>重复字符串函数 repeat</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：repeat(string str, int n)</span><br><span class="line">返回值：string</span><br><span class="line">说明：返回重复 n 次后的 str 字符串</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">repeat</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">5</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abcabcabcabcabc</span><br></pre></td></tr></table></figure><p></p><h5 id="首字符-ascii-函数"><a href="#首字符-ascii-函数" class="headerlink" title="首字符 ascii 函数"></a>首字符 ascii 函数</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：ascii(string str)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回字符串 str 第一个字符的 ascii 码</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">ascii</span>(<span class="string">&#x27;abcde&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：97</span><br></pre></td></tr></table></figure><p></p><h5 id="左补足函数-lpad"><a href="#左补足函数-lpad" class="headerlink" title="左补足函数 lpad"></a>左补足函数 lpad</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：lpad(string str, int len, string pad)</span><br><span class="line">返回值：string</span><br><span class="line">说明：将 str 进行用 pad 进行左补足到 len 位</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">lpad</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;td&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：tdtdtdtabc</span><br><span class="line">注意：与 GP，ORACLE 不同，pad 不能默认</span><br></pre></td></tr></table></figure><p></p><h5 id="右补足函数-rpad"><a href="#右补足函数-rpad" class="headerlink" title="右补足函数 rpad"></a>右补足函数 rpad</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：rpad(string str, int len, string pad)</span><br><span class="line">返回值：string</span><br><span class="line">说明：将 str 进行用 pad 进行右补足到 len 位</span><br><span class="line">示例：<span class="keyword">select</span> rpad(<span class="string">&#x27;abc&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;td&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：abctdtdtdt</span><br></pre></td></tr></table></figure><p></p><h5 id="分割字符串函数-split"><a href="#分割字符串函数-split" class="headerlink" title="分割字符串函数 split"></a>分割字符串函数 split</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：split(string str, string pat)</span><br><span class="line">返回值：array</span><br><span class="line">说明：按照 pat 字符串分割 str，会返回分割后的字符串数组</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">split</span>(<span class="string">&#x27;abtcdtef&#x27;</span>, <span class="string">&#x27;t&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：[&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;]</span><br></pre></td></tr></table></figure><p></p><h5 id="集合查找函数-find-in-set"><a href="#集合查找函数-find-in-set" class="headerlink" title="集合查找函数 find_in_set"></a>集合查找函数 find_in_set</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：find_in_set(string str, string strList)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回 str 在 strlist 第一次出现的位置，strlist 是用逗号分割的字符串。如果没有找该 str 字符，则返回 0</span><br><span class="line">示例：<span class="keyword">select</span> find_in_set(<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;ef,ab,de&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：2</span><br><span class="line">示例：<span class="keyword">select</span> find_in_set(<span class="string">&#x27;at&#x27;</span>, <span class="string">&#x27;ef,ab,de&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：0</span><br></pre></td></tr></table></figure><p></p><h4 id="复合类型构建操作"><a href="#复合类型构建操作" class="headerlink" title="复合类型构建操作"></a>复合类型构建操作</h4><h5 id="Map-类型构建"><a href="#Map-类型构建" class="headerlink" title="Map 类型构建"></a>Map 类型构建</h5><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：map (key1, value1, key2, value2, …)</span><br><span class="line">说明：根据输入的 key 和 value 对构建 Map 类型</span><br><span class="line">示例：<span class="keyword">Create</span> <span class="keyword">table</span> mapTable <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">map</span>(<span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;200&#x27;</span>, <span class="string">&#x27;mary&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">describe</span> mapTable;</span><br><span class="line">结果：t    map&lt;string ,string&gt;</span><br><span class="line">示例：<span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">结果：&#123;&quot;100&quot;:&quot;tom&quot;,&quot;200&quot;:&quot;mary&quot;&#125;</span><br></pre></td></tr></table></figure><p></p><h5 id="Struct-类型构建"><a href="#Struct-类型构建" class="headerlink" title="Struct 类型构建"></a>Struct 类型构建</h5><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：struct(val1, val2, val3, …)</span><br><span class="line">说明：根据输入的参数构建结构体 Struct 类型</span><br><span class="line">示例：<span class="keyword">create</span> <span class="keyword">table</span> struct_table <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">struct</span>(<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;mary&#x27;</span>, <span class="string">&#x27;tim&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">describe</span> struct_table;</span><br><span class="line">结果：t    struct&lt;col1:string,col2:string,col3:string&gt;</span><br><span class="line">示例：<span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">结果：&#123;&quot;col1&quot;:&quot;tom&quot;,&quot;col2&quot;:&quot;mary&quot;,&quot;col3&quot;:&quot;tim&quot;&#125;</span><br></pre></td></tr></table></figure><p></p><h5 id="Array-类型构建"><a href="#Array-类型构建" class="headerlink" title="Array 类型构建"></a>Array 类型构建</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：array(val1, val2, …)</span><br><span class="line">说明：根据输入的参数构建数组 Array 类型</span><br><span class="line">示例：<span class="keyword">create</span> <span class="keyword">table</span> arr_table <span class="keyword">as</span> <span class="keyword">select</span> <span class="built_in">array</span>(<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;mary&#x27;</span>, <span class="string">&#x27;tim&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">describe</span> tableName;</span><br><span class="line">结果：t    array&lt;string&gt;</span><br><span class="line">示例：<span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">结果：[&quot;tom&quot;,&quot;mary&quot;,&quot;tim&quot;]</span><br></pre></td></tr></table></figure><p></p><h4 id="复杂类型访问操作"><a href="#复杂类型访问操作" class="headerlink" title="复杂类型访问操作"></a>复杂类型访问操作</h4><h5 id="Array-类型访问-A-n"><a href="#Array-类型访问-A-n" class="headerlink" title="Array 类型访问: A[n]"></a>Array 类型访问: A[n]</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：A[n]</span><br><span class="line">操作类型: A 为 array 类型，n 为 int 类型</span><br><span class="line">说明：返回数组 A 中的第 n 个变量值。数组的起始下标为 0。比如，A 是个值为 [&#x27;foo&#x27;, &#x27;bar&#x27;] 的数组类型，那么 A[0] 将返回 &#x27;foo&#x27;，而 A[1] 将返回 &#x27;bar&#x27;</span><br><span class="line">示例：<span class="keyword">create</span> <span class="keyword">table</span> arr_table2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="built_in">array</span>(<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;mary&quot;</span>,<span class="string">&quot;tim&quot;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">select</span> t[<span class="number">0</span>], t[<span class="number">1</span>] <span class="keyword">from</span> arr_table2;</span><br><span class="line">结果：tom    mary    tim</span><br></pre></td></tr></table></figure><p></p><h5 id="Map-类型访问-M-key"><a href="#Map-类型访问-M-key" class="headerlink" title="Map 类型访问: M[key]"></a>Map 类型访问: M[key]</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：M[key]</span><br><span class="line">操作类型: M 为 map 类型，key 为 map 中的 key 值</span><br><span class="line">说明：返回 map 类型 M 中，key 值为指定值的 value 值。比如，M 是值为 &#123;&#x27;f&#x27; -&gt; &#x27;foo&#x27;, &#x27;b&#x27; -&gt; &#x27;bar&#x27;, &#x27;all&#x27; -&gt; &#x27;foobar&#x27;&#125; 的 map 类型，那么 M[&#x27;all&#x27;] 将会返回 &#x27;foobar&#x27;</span><br><span class="line">示例：<span class="keyword">Create</span> <span class="keyword">table</span> map_table2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">map</span>(<span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;200&#x27;</span>, <span class="string">&#x27;mary&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">select</span> t[<span class="string">&#x27;200&#x27;</span>], t[<span class="string">&#x27;100&#x27;</span>] <span class="keyword">from</span> map_table2;</span><br><span class="line">结果：mary    tom</span><br></pre></td></tr></table></figure><p></p><h5 id="Struct-类型访问-S-x"><a href="#Struct-类型访问-S-x" class="headerlink" title="Struct 类型访问 S.x"></a>Struct 类型访问 S.x</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：S.x</span><br><span class="line">操作类型: S 为 struct 类型</span><br><span class="line">说明：返回结构体 S 中的 x 字段。比如，对于结构体 struct foobar &#123;int foo, int bar&#125;，foobar.foo 返回结构体中的 foo 字段</span><br><span class="line">示例：<span class="keyword">create</span> <span class="keyword">table</span> str_table2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">struct</span>(<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;mary&#x27;</span>, <span class="string">&#x27;tim&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">示例：<span class="keyword">describe</span> tableName;</span><br><span class="line">结果：t    struct&lt;col1:string,col2:string,col3:string&gt;</span><br><span class="line">示例：<span class="keyword">select</span> t.col1, t.col3 <span class="keyword">from</span> str_table2;</span><br><span class="line">结果：tom    tim</span><br></pre></td></tr></table></figure><p></p><h4 id="复杂类型长度统计函数"><a href="#复杂类型长度统计函数" class="headerlink" title="复杂类型长度统计函数"></a>复杂类型长度统计函数</h4><h5 id="Map-类型长度函数-size-Map"><a href="#Map-类型长度函数-size-Map" class="headerlink" title="Map 类型长度函数 size(Map)"></a>Map 类型长度函数 size(Map<k .v>)</k></h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：size(Map&lt;k .V&gt;)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回 map 类型的长度</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">size</span>(t) <span class="keyword">from</span> map_table2;</span><br><span class="line">结果：2</span><br></pre></td></tr></table></figure><p></p><h5 id="Array-类型长度函数-size-Array"><a href="#Array-类型长度函数-size-Array" class="headerlink" title="Array 类型长度函数 size(Array)"></a>Array 类型长度函数 size(Array)</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：size(Array&lt;T&gt;)</span><br><span class="line">返回值：int</span><br><span class="line">说明：返回 array 类型的长度</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">size</span>(t) <span class="keyword">from</span> arr_table2;</span><br><span class="line">结果：4</span><br></pre></td></tr></table></figure><p></p><h5 id="类型转换函数：cast"><a href="#类型转换函数：cast" class="headerlink" title="类型转换函数：cast"></a>类型转换函数：cast</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：cast(expr as &lt;type&gt;)</span><br><span class="line">返回值：Expected &quot;=&quot; to follow &quot;type&quot;</span><br><span class="line">说明：返回转换后的数据类型</span><br><span class="line">示例：<span class="keyword">select</span> <span class="keyword">cast</span>(<span class="string">&#x27;1&#x27;</span> <span class="keyword">as</span> <span class="built_in">bigint</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：1</span><br></pre></td></tr></table></figure><p></p><h3 id="行转列及列转行"><a href="#行转列及列转行" class="headerlink" title="行转列及列转行"></a>行转列及列转行</h3><h4 id="使用-explode-函数将-Hive-表中的-Map-和-Array-字段数据进行拆分"><a href="#使用-explode-函数将-Hive-表中的-Map-和-Array-字段数据进行拆分" class="headerlink" title="使用 explode 函数将 Hive 表中的 Map 和 Array 字段数据进行拆分"></a>使用 <code>explode</code> 函数将 Hive 表中的 Map 和 Array 字段数据进行拆分</h4><p><code>lateral view</code> 用于和 <code>split</code>、<code>explode</code> 等 UDTF 一起使用的，能将一行数据拆分成多行数据，在此基础上可以对拆分的数据进行聚合，<code>lateral view</code> 首先为原始表的每行调用 UDTF，UDTF 会把一行拆分成一行或者多行，<code>lateral view</code> 在把结果组合，产生一个支持别名表的虚拟表。</p><p>其中 <code>explode</code> 还可以用于将 Hive 一列中复杂的 array 或者 map 结构拆分成多行。</p><p><strong>需求：</strong></p><p>现在有数据格式如下</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zhangsan    child1,child2,child3,child4    k1:v1,k2:v2</span><br><span class="line">lisi    child5,child6,child7,child8    k3:v3,k4:v4</span><br></pre></td></tr></table></figure><p></p><p>字段之间使用 <code>\t</code> 分割，需求将所有的 child 进行拆开成为一列</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">----------+--+</span></span><br><span class="line">| mychild |</span><br><span class="line">+<span class="comment">----------+--+</span></span><br><span class="line">| child1  |</span><br><span class="line">| child2  |</span><br><span class="line">| child3  |</span><br><span class="line">| child4  |</span><br><span class="line">| child5  |</span><br><span class="line">| child6  |</span><br><span class="line">| child7  |</span><br><span class="line">| child8  |</span><br><span class="line">+<span class="comment">----------+--+</span></span><br></pre></td></tr></table></figure><p></p><p>将 map 的 key 和 value 也进行拆开，成为如下结果</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">-----------+-------------+--+</span></span><br><span class="line">| mymapkey | mymapvalue |</span><br><span class="line">+<span class="comment">-----------+-------------+--+</span></span><br><span class="line">| k1    | v1     |</span><br><span class="line">| k2    | v2     |</span><br><span class="line">| k3    | v3     |</span><br><span class="line">| k4    | v4     |</span><br><span class="line">+<span class="comment">-----------+-------------+--+</span></span><br></pre></td></tr></table></figure><p></p><ol><li><p>创建 hive 数据库</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create database hive_explode;</span><br><span class="line">hive (default)&gt; use hive_explode;</span><br></pre></td></tr></table></figure><p></p></li><li><p>创建 Hive 表，然后使用 <code>explode</code> 拆分 map 和 array</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; create table t3(name string,children array&lt;string&gt;,address Map&lt;string,string&gt;) row format delimited fields terminated by &#x27;\t&#x27; collection items terminated by &#x27;,&#x27; map keys terminated by &#x27;:&#x27; stored as textFile;</span><br></pre></td></tr></table></figure><p></p></li><li><p>加载数据 node03 执行以下命令创建表数据文件</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /export/servers/hivedatas/</span><br><span class="line">cd /export/servers/hivedatas/</span><br><span class="line">vim maparray</span><br></pre></td></tr></table></figure><p></p><p>内容如下:</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zhangsan child1,child2,child3,child4 k1:v1,k2:v2</span><br><span class="line">lisi child5,child6,child7,child8 k3:v3,k4:v4</span><br></pre></td></tr></table></figure><p></p><p>Hive 表当中加载数据</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; load data local inpath &#x27;/export/servers/hivedatas/maparray&#x27; into table t3;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 <code>explode</code> 将 Hive 当中数据拆开</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 array 当中的数据拆分开</span></span><br><span class="line">hive (hive_explode)&gt; SELECT explode(children) AS myChild FROM t3;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 map 当中的数据拆分开</span></span><br><span class="line">hive (hive_explode)&gt; SELECT explode(address) AS (myMapKey, myMapValue) FROM t3;</span><br></pre></td></tr></table></figure><p></p></li></ol><h4 id="使用-explode-拆分-json-字符串"><a href="#使用-explode-拆分-json-字符串" class="headerlink" title="使用 explode 拆分 json 字符串"></a>使用 explode 拆分 json 字符串</h4><p><strong>需求：</strong></p><p>现在有一些数据格式如下：</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:shandong,b:beijing,c:hebei|1,2,3,4,5,6,7,8,9|[&#123;&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:4900,&quot;userCount&quot;:1900,&quot;score&quot;:&quot;9.9&quot;&#125;,&#123;&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:2090,&quot;userCount&quot;:78981,&quot;score&quot;:&quot;9.8&quot;&#125;,&#123;&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:6987,&quot;userCount&quot;:1600,&quot;score&quot;:&quot;9.0&quot;&#125;]</span><br></pre></td></tr></table></figure><p></p><p>其中字段与字段之间的分隔符是 <code>|</code>。</p><p>我们要解析得到所有的 monthSales 对应的值为以下这一列（行转列）</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4900</span><br><span class="line">2090</span><br><span class="line">6987</span><br></pre></td></tr></table></figure><p></p><ol><li><p>创建 Hive 表</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> explode_lateral_view</span><br><span class="line">(<span class="string">`area`</span> <span class="keyword">string</span>,</span><br><span class="line"><span class="string">`goods_id`</span> <span class="keyword">string</span>,</span><br><span class="line"><span class="string">`sale_info`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">&#x27;|&#x27;</span></span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> textfile;</span><br></pre></td></tr></table></figure><p></p></li><li><p>准备数据并加载数据</p><p>准备数据如下</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hivedatas</span><br><span class="line">vim explode_json</span><br><span class="line"></span><br><span class="line">a:shandong,b:beijing,c:hebei|1,2,3,4,5,6,7,8,9|[&#123;&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:4900,&quot;userCount&quot;:1900,&quot;score&quot;:&quot;9.9&quot;&#125;,&#123;&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:2090,&quot;userCount&quot;:78981,&quot;score&quot;:&quot;9.8&quot;&#125;,&#123;&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:6987,&quot;userCount&quot;:1600,&quot;score&quot;:&quot;9.0&quot;&#125;]</span><br></pre></td></tr></table></figure><p></p><p>加载数据到 Hive 表当中去</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; load data local inpath &#x27;/export/servers/hivedatas/explode_json&#x27; overwrite into table explode_lateral_view;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 <code>explode</code> 拆分 Array</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select explode(split(goods_id, &#x27;,&#x27;)) as goods_id from explode_lateral_view;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 <code>explode</code> 拆解 Map</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select explode(split(area, &#x27;,&#x27;)) as area from explode_lateral_view;</span><br></pre></td></tr></table></figure><p></p></li><li><p>拆解 JSON 字段</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select explode(split(regexp_replace(regexp_replace(sale_info, &#x27;\\[\\&#123;&#x27;, &#x27;&#x27;), &#x27;&#125;]&#x27;, &#x27;&#x27;), &#x27;&#125;,\\&#123;&#x27;)) as sale_info from explode_lateral_view;</span><br></pre></td></tr></table></figure><p></p><p>然后我们想用 <code>get_json_object</code> 来获取 key 为 monthSales 的数据：</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select get_json_object(explode(split(regexp_replace(regexp_replace(sale_info, &#x27;\\[\\&#123;&#x27;, &#x27;&#x27;), &#x27;&#125;]&#x27;, &#x27;&#x27;), &#x27;&#125;,\\&#123;&#x27;)), &#x27;$.monthSales&#x27;) as sale_info from explode_lateral_view;</span><br></pre></td></tr></table></figure><p></p><p>然后挂了 <code>FAILED: SemanticException [Error 10081]: UDTF&#39;s are not supported outside the SELECT clause, nor nested in expressions</code></p><p>UDTF <code>explode</code> 不能写在别的函数内</p><p>如果你这么写，想查两个字段，<code>select explode(split(area, &#39;,&#39;)) as area, good_id from explode_lateral_view;</code></p><p>会报错 <code>FAILED: SemanticException 1:40 Only a single expression in the SELECT clause is supported with UDTF&#39;s. Error encountered near token &#39;good_id&#39;</code></p><p>使用 UDTF 的时候，只支持一个字段，这时候就需要 LATERAL VIEW 出场了</p></li></ol><h4 id="配合-LATERAL-VIEW-使用"><a href="#配合-LATERAL-VIEW-使用" class="headerlink" title="配合 LATERAL VIEW 使用"></a>配合 LATERAL VIEW 使用</h4><p>配合 <code>lateral view</code> 查询多个字段</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select goods_id2, sale_info from explode_lateral_view LATERAL VIEW explode(split(goods_id, &#x27;,&#x27;)) goods as goods_id2;</span><br></pre></td></tr></table></figure><p></p><p>其中 <code>LATERAL VIEW explode(split(goods_id,&#39;,&#39;)) goods</code>相当于一个虚拟表，与原表 <code>explode_lateral_view</code> 笛卡尔积关联</p><p>也可以多重使用</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select goods_id2, sale_info, area2</span><br><span class="line">          from explode_lateral_view </span><br><span class="line">          LATERAL VIEW explode(split(goods_id, &#x27;,&#x27;)) goods as goods_id2 </span><br><span class="line">          LATERAL VIEW explode(split(area, &#x27;,&#x27;)) area as area2;</span><br></pre></td></tr></table></figure><p></p><p>也是三个表笛卡尔积的结果。</p><p>最终，我们可以通过下面的句子，把这个 JSON 格式的一行数据，完全转换成二维表的方式展现</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select get_json_object(concat(&#x27;&#123;&#x27;, sale_info_1 , &#x27;&#125;&#x27;), &#x27;$.source&#x27;) as source,</span><br><span class="line">              get_json_object(concat(&#x27;&#123;&#x27;, sale_info_1, &#x27;&#125;&#x27;), &#x27;$.monthSales&#x27;) as monthSales,</span><br><span class="line">              get_json_object(concat(&#x27;&#123;&#x27;, sale_info_1, &#x27;&#125;&#x27;), &#x27;$.userCount&#x27;) as monthSales,</span><br><span class="line">              get_json_object(concat(&#x27;&#123;&#x27;, sale_info_1, &#x27;&#125;&#x27;), &#x27;$.score&#x27;) as monthSales</span><br><span class="line">          from explode_lateral_view</span><br><span class="line">          LATERAL VIEW explode(split(regexp_replace(regexp_replace(sale_info, &#x27;\\[\\&#123;&#x27;, &#x27;&#x27;), &#x27;&#125;]&#x27;, &#x27;&#x27;), &#x27;&#125;,\\&#123;&#x27;)) sale_info as sale_info_1;</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：</strong></p><p><code>Lateral View</code> 通常和 UDTF 一起出现，为了解决 UDTF 不允许在 <code>select</code> 字段的问题。<code>Multiple Lateral View</code> 可以实现类似笛卡尔乘积。<code>Outer</code> 关键字可以把不输出的 UDTF 的空结果，输出成 NULL，防止丢失数据。</p><h4 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h4><p><strong>相关参数说明:</strong></p><ul><li><p><code>CONCAT(string A/col, string B/col…)</code>：返回输入字符串连接后的结果，支持任意个输入字符串;</p></li><li><p><code>CONCAT_WS(separator, str1, str2,...)</code>：它是一个特殊形式的 <code>CONCAT()</code>。第一个参数是剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;</p></li><li><p><code>COLLECT_SET(col)</code>：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生 Array 类型字段。</p></li></ul><p><strong>数据准备:</strong></p><div class="table-container"><table><thead><tr><th>name</th><th>constellation</th><th>blood_type</th></tr></thead><tbody><tr><td>孙悟空</td><td>白羊座</td><td>A</td></tr><tr><td>老王</td><td>射手座</td><td>A</td></tr><tr><td>宋宋</td><td>白羊座</td><td>B</td></tr><tr><td>猪八戒</td><td>白羊座</td><td>A</td></tr><tr><td>凤姐</td><td>射手座</td><td>A</td></tr></tbody></table></div><p><strong>需求:</strong></p><p>把星座和血型一样的人归类到一起。结果如下：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">射手座,A      老王|凤姐</span><br><span class="line">白羊座,A      孙悟空|猪八戒</span><br><span class="line">白羊座,B      宋宋</span><br></pre></td></tr></table></figure><p></p><p><strong>实现步骤:</strong></p><ol><li><p>创建本地 <code>constellation.txt</code>，导入数据 node03 服务器执行以下命令创建文件，注意数据使用 <code>\t</code> 进行分割</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hivedatas</span><br><span class="line">vim constellation.txt</span><br><span class="line"></span><br><span class="line">数据如下：</span><br><span class="line">孙悟空 白羊座 A</span><br><span class="line">老王 射手座 A</span><br><span class="line">宋宋 白羊座 B</span><br><span class="line">猪八戒 白羊座 A</span><br><span class="line">凤姐 射手座 A</span><br></pre></td></tr></table></figure><p></p></li><li><p>创建 Hive 表并导入数据</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Hive 表并加载数据</span></span><br><span class="line">hive (hive_explode)&gt; create table person_info(</span><br><span class="line">          name string, </span><br><span class="line">          constellation string, </span><br><span class="line">          blood_type string) </span><br><span class="line">          row format delimited fields terminated by &quot;\t&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据</span></span><br><span class="line">hive (hive_explode)&gt; load data local inpath &#x27;/export/servers/hivedatas/constellation.txt&#x27; into table person_info;</span><br></pre></td></tr></table></figure><p></p></li><li><p>按需求查询数据</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select t1.base, concat_ws(&#x27;|&#x27;, collect_set(t1.name)) name</span><br><span class="line">          from (<span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">concat</span>(constellation, <span class="string">&quot;,&quot;</span> , blood_type) base</span><br><span class="line">                  <span class="keyword">from</span> person_info) t1</span><br><span class="line">          <span class="keyword">group</span> <span class="keyword">by</span> t1.base;</span><br></pre></td></tr></table></figure><p></p></li></ol><h4 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h4><p><strong>所需函数:</strong></p><p><code>EXPLODE(col)</code>：将 Hive 一列中复杂的 array 或者 map 结构拆分成多行。</p><p><code>LATERAL VIEW</code>：用于和 split, explode 等 UDTF 一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</p><p><strong>数据准备:</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hivedatas</span><br><span class="line">vim movie.txt</span><br></pre></td></tr></table></figure><p></p><p>文件内容如下: 数据字段之间使用 <code>\t</code> 进行分割</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">《疑犯追踪》 悬疑,动作,科幻,剧情</span><br><span class="line">《Lie to me》 悬疑,警匪,动作,心理,剧情</span><br><span class="line">《战狼2》 战争,动作,灾难</span><br></pre></td></tr></table></figure><p></p><p><strong>需求:</strong></p><p>将电影分类中的数组数据展开。结果如下：</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">《疑犯追踪》 悬疑</span><br><span class="line">《疑犯追踪》 动作</span><br><span class="line">《疑犯追踪》 科幻</span><br><span class="line">《疑犯追踪》 剧情</span><br><span class="line">《Lie to me》 悬疑</span><br><span class="line">《Lie to me》 警匪</span><br><span class="line">《Lie to me》 动作</span><br><span class="line">《Lie to me》 心理</span><br><span class="line">《Lie to me》 剧情</span><br><span class="line">《战狼2》 战争</span><br><span class="line">《战狼2》 动作</span><br><span class="line">《战狼2》 灾难</span><br></pre></td></tr></table></figure><p></p><p><strong>实现步骤:</strong></p><ol><li><p>创建 Hive 表</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> movie_info(</span><br><span class="line">  movie <span class="keyword">string</span>, </span><br><span class="line">  <span class="keyword">category</span> <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;) </span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&quot;\t&quot;</span> </span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&quot;,&quot;</span>;</span><br></pre></td></tr></table></figure><p></p></li><li><p>加载数据</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&quot;/export/servers/hivedatas/movie.txt&quot;</span> <span class="keyword">into</span> <span class="keyword">table</span> movie_info;</span><br></pre></td></tr></table></figure><p></p></li><li><p>按需求查询数据</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> movie, category_name</span><br><span class="line">  <span class="keyword">from</span> movie_info <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(<span class="keyword">category</span>) table_tmp <span class="keyword">as</span> category_name;</span><br></pre></td></tr></table></figure><p></p></li></ol><h4 id="REFLECT-函数"><a href="#REFLECT-函数" class="headerlink" title="REFLECT 函数"></a>REFLECT 函数</h4><p><code>reflect</code> 函数可以支持在 SQL 中调用 <code>Java</code> 中的自带函数，秒杀一切 UDF 函数。</p><p><strong>需求 1: 使用 java.lang.Math 当中的 Max 求两列中最大值</strong></p><p><strong>实现步骤:</strong></p><ol><li><p>创建 Hive 表</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_udf(col1 <span class="built_in">int</span>, col2 <span class="built_in">int</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p></li><li><p>准备数据并加载数据</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hivedatas</span><br><span class="line">vim test_udf </span><br></pre></td></tr></table></figure><p></p><p>文件内容如下:</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1,2</span><br><span class="line">4,3</span><br><span class="line">6,4</span><br><span class="line">7,5</span><br><span class="line">5,6</span><br></pre></td></tr></table></figure><p></p></li><li><p>加载数据</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; load data local inpath &#x27;/export/servers/hivedatas/test_udf&#x27; overwrite into table test_udf;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 <code>java.lang.Math</code> 当中的 <code>Max</code> 求两列当中的最大值</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select reflect(&quot;java.lang.Math&quot;, &quot;max&quot;, col1, col2) from test_udf;</span><br></pre></td></tr></table></figure><p></p></li></ol><p><strong>需求 2: 文件中不同的记录来执行不同的 Java 的内置函数</strong></p><p><strong>实现步骤:</strong></p><ol><li><p>创建 Hive 表</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; create table test_udf2(class_name string, method_name string, col1 int , col2 int) row format delimited fields terminated by &#x27;,&#x27;;</span><br></pre></td></tr></table></figure><p></p></li><li><p>准备数据</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /export/servers/hivedatas</span><br><span class="line">vim test_udf2</span><br></pre></td></tr></table></figure><p></p><p>文件内容如下:</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Math,min,1,2</span><br><span class="line">java.lang.Math,max,2,3</span><br></pre></td></tr></table></figure><p></p></li><li><p>加载数据</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; load data local inpath &#x27;/export/servers/hivedatas/test_udf2&#x27; overwrite into table test_udf2;</span><br></pre></td></tr></table></figure><p></p></li><li><p>执行查询</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)&gt; select reflect(class_name,method_name,col1,col2) from test_udf2;</span><br></pre></td></tr></table></figure><p></p></li></ol><p><strong>需求 3: 判断是否为数字</strong></p><p><strong>实现方式:</strong></p><p>使用 <code>apache.commons</code> 中的函数，commons 下的 jar 已经包含在 hadoop 的 classpath 中，所以可以直接使用。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> reflect(<span class="string">&quot;org.apache.commons.lang.math.NumberUtils&quot;</span>, <span class="string">&quot;isNumber&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br></pre></td></tr></table></figure><p></p><h3 id="窗口函数与分析函数"><a href="#窗口函数与分析函数" class="headerlink" title="窗口函数与分析函数"></a>窗口函数与分析函数</h3><p>在 SQL 中有一类函数叫做聚合函数，例如 <code>sum()</code>、<code>avg()</code>、<code>max()</code> 等等，这类函数可以将多行数据按照规则聚集为一行，一般来讲聚集后的行数是要少于聚集前的行数的。但是有时我们想要既显示聚集前的数据，又要显示聚集后的数据，这时我们便引入了窗口函数。窗口函数又叫 OLAP 函数/分析函数，窗口函数兼具分组和排序功能。</p><p>窗口函数最重要的关键字是 <code>partition by</code> 和 <code>order by</code>。</p><p>具体语法如下：<code>over (partition by xxx order by xxx)</code></p><h4 id="sum、avg、min、max"><a href="#sum、avg、min、max" class="headerlink" title="sum、avg、min、max"></a>sum、avg、min、max</h4><p><strong>准备数据</strong></p><p>建表语句:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_t1(</span><br><span class="line">cookieid <span class="keyword">string</span>,</span><br><span class="line">createtime <span class="keyword">string</span>,  <span class="comment">--day </span></span><br><span class="line">pv <span class="built_in">int</span></span><br><span class="line">) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> </span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p><p>加载数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t1.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookie1,2020-04-10,1</span><br><span class="line">cookie1,2020-04-11,5</span><br><span class="line">cookie1,2020-04-12,7</span><br><span class="line">cookie1,2020-04-13,3</span><br><span class="line">cookie1,2020-04-14,2</span><br><span class="line">cookie1,2020-04-15,4</span><br><span class="line">cookie1,2020-04-16,4</span><br></pre></td></tr></table></figure><p></p><p>开启智能本地模式</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> hive.exec.mode.local.auto=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h5><p><code>SUM</code> 函数和窗口函数的配合使用：结果和 <code>ORDER BY</code> 相关，默认为升序。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> pv1, <span class="comment">--默认为从起点到当前行</span></span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv2, <span class="comment">--从起点到当前行，结果同 pv1</span></span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> pv3, <span class="comment">--分组内所有行</span></span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv4, <span class="comment">--当前行 + 往前 3 行</span></span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="number">1</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv5, <span class="comment">--当前行 + 往前 3 行+往后 1 行</span></span><br><span class="line"><span class="keyword">SUM</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span> <span class="keyword">AND</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv6 <span class="comment">--当前行+往后所有行</span></span><br><span class="line"><span class="keyword">FROM</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------</span></span><br><span class="line">cookie1  2015-04-10      1       1       1       26      1       6       26</span><br><span class="line">cookie1  2015-04-11      5       6       6       26      6       13      25</span><br><span class="line">cookie1  2015-04-12      7       13      13      26      13      16      20</span><br><span class="line">cookie1  2015-04-13      3       16      16      26      16      18      13</span><br><span class="line">cookie1  2015-04-14      2       18      18      26      17      21      10</span><br><span class="line">cookie1  2015-04-15      4       22      22      26      16      20      8</span><br><span class="line">cookie1  2015-04-16      4       26      26      26      13      13      4</span><br><span class="line"></span><br><span class="line">pv1: 分组内从起点到当前行的 pv 累积，如，11号的 pv1 = 10号的 pv + 11号的 pv, 12号 = 10号 + 11号 + 12号</span><br><span class="line">pv2: 同 pv1</span><br><span class="line">pv3: 分组内 (cookie1) 所有的 pv 累加</span><br><span class="line">pv4: 分组内当前行 + 往前 3 行，如，11号 = 10号 + 11号，12号 = 10号 + 11号 + 12号，13号 = 10号 + 11号 + 12号 + 13号，14号 = 11号 + 12号 + 13号 + 14号</span><br><span class="line">pv5: 分组内当前行 + 往前 3 行 + 往后 1 行，如，14号 = 11号 + 12号 + 13号 + 14号 + 15号 = 5 + 7 + 3 + 2 + 4 = 21</span><br><span class="line">pv6: 分组内当前行 + 往后所有行，如，13号 = 13号 + 14号 + 15号 + 16号 = 3 + 2 + 4 + 4 = 13， 14号 = 14号 + 15号 + 16号 = 2 + 4 + 4 = 10</span><br></pre></td></tr></table></figure><p></p><p>如果不指定 <code>rows between</code>，默认为从起点到当前行;</p><p>如果不指定 <code>order by</code>，则将分组内所有值累加;</p><p>关键是理解 <code>rows between</code> 含义，也叫做 <code>window</code> 子句：</p><ul><li><code>preceding</code>：往前</li><li><code>following</code>：往后</li><li><code>current row</code>：当前行</li><li><code>unbounded</code>：起点</li><li><code>unbounded preceding</code>： 表示从前面的起点</li><li><code>unbounded following</code>：表示到后面的终点</li></ul><p>AVG，MIN，MAX 和 SUM 用法一样。</p><h5 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> pv1, <span class="comment">--默认为从起点到当前行</span></span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv2, <span class="comment">--从起点到当前行，结果同 pv1</span></span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> pv3, <span class="comment">--分组内所有行</span></span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv4, <span class="comment">--当前行 + 往前 3 行</span></span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="number">1</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv5, <span class="comment">--当前行 + 往前 3 行 + 往后 1 行</span></span><br><span class="line"><span class="keyword">AVG</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span> <span class="keyword">AND</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv6 <span class="comment">--当前行 + 往后所有行</span></span><br><span class="line"><span class="keyword">FROM</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10      1       1.0     1.0     3.7142857142857144      1.0     3.0     3.7142857142857144</span><br><span class="line">cookie1 2015-04-11      5       3.0     3.0     3.7142857142857144      3.0     4.333333333333333       4.166666666666667</span><br><span class="line">cookie1 2015-04-12      7       4.333333333333333       4.333333333333333       3.7142857142857144      4.333333333333333       4.0     4.0</span><br><span class="line">cookie1 2015-04-13      3       4.0     4.0     3.7142857142857144      4.0     3.6     3.25</span><br><span class="line">cookie1 2015-04-14      2       3.6     3.6     3.7142857142857144      4.25    4.2     3.3333333333333335</span><br><span class="line">cookie1 2015-04-15      4       3.6666666666666665      3.6666666666666665      3.7142857142857144      4.0     4.0     4.0</span><br><span class="line">cookie1 2015-04-16      4       3.7142857142857144      3.7142857142857144      3.7142857142857144      3.25    3.25    4.0</span><br></pre></td></tr></table></figure><p></p><h5 id="MIN"><a href="#MIN" class="headerlink" title="MIN"></a>MIN</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> pv1, <span class="comment">--默认为从起点到当前行</span></span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv2, <span class="comment">--从起点到当前行，结果同 pv1</span></span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> pv3, <span class="comment">--分组内所有行</span></span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv4, <span class="comment">--当前行 + 往前 3 行</span></span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="number">1</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv5, <span class="comment">--当前行 + 往前 3 行 + 往后 1 行</span></span><br><span class="line"><span class="keyword">MIN</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span> <span class="keyword">AND</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv6 <span class="comment">--当前行 + 往后所有行</span></span><br><span class="line"><span class="keyword">FROM</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10      1       1       1       1       1       1       1</span><br><span class="line">cookie1 2015-04-11      5       1       1       1       1       1       2</span><br><span class="line">cookie1 2015-04-12      7       1       1       1       1       1       2</span><br><span class="line">cookie1 2015-04-13      3       1       1       1       1       1       2</span><br><span class="line">cookie1 2015-04-14      2       1       1       1       2       2       2</span><br><span class="line">cookie1 2015-04-15      4       1       1       1       2       2       4</span><br><span class="line">cookie1 2015-04-16      4       1       1       1       2       2       4</span><br></pre></td></tr></table></figure><p></p><h5 id="MAX"><a href="#MAX" class="headerlink" title="MAX"></a>MAX</h5><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> pv1, <span class="comment">--默认为从起点到当前行</span></span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv2, <span class="comment">--从起点到当前行，结果同 pv1</span></span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> pv3, <span class="comment">--分组内所有行</span></span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span>) <span class="keyword">AS</span> pv4, <span class="comment">--当前行 + 往前 3 行</span></span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">PRECEDING</span> <span class="keyword">AND</span> <span class="number">1</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv5, <span class="comment">--当前行 + 往前 3 行 + 往后 1 行</span></span><br><span class="line"><span class="keyword">MAX</span>(pv) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">CURRENT</span> <span class="keyword">ROW</span> <span class="keyword">AND</span> <span class="keyword">UNBOUNDED</span> <span class="keyword">FOLLOWING</span>) <span class="keyword">AS</span> pv6 <span class="comment">--当前行 + 往后所有行</span></span><br><span class="line"><span class="keyword">FROM</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10      1       1       1       7       1       5       7</span><br><span class="line">cookie1 2015-04-11      5       5       5       7       5       7       7</span><br><span class="line">cookie1 2015-04-12      7       7       7       7       7       7       7</span><br><span class="line">cookie1 2015-04-13      3       7       7       7       7       7       4</span><br><span class="line">cookie1 2015-04-14      2       7       7       7       7       7       4</span><br><span class="line">cookie1 2015-04-15      4       7       7       7       7       7       4</span><br><span class="line">cookie1 2015-04-16      4       7       7       7       4       4       4</span><br></pre></td></tr></table></figure><p></p><h4 id="row-number、rank、dense-rank、ntile"><a href="#row-number、rank、dense-rank、ntile" class="headerlink" title="row_number、rank、dense_rank、ntile"></a>row_number、rank、dense_rank、ntile</h4><p><strong>准备数据：</strong></p><p>建表语句:</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_t2 (</span><br><span class="line">  cookieid <span class="keyword">string</span>,</span><br><span class="line">  createtime <span class="keyword">string</span>,  <span class="comment">--day </span></span><br><span class="line">  pv <span class="built_in">INT</span></span><br><span class="line">) <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line"><span class="keyword">stored</span> <span class="keyword">as</span> textfile;</span><br></pre></td></tr></table></figure><p></p><p><strong>加载数据：</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t2.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t2;</span><br><span class="line"></span><br><span class="line">cookie1,2020-04-10,1</span><br><span class="line">cookie1,2020-04-11,5</span><br><span class="line">cookie1,2020-04-12,7</span><br><span class="line">cookie1,2020-04-13,3</span><br><span class="line">cookie1,2020-04-14,2</span><br><span class="line">cookie1,2020-04-15,4</span><br><span class="line">cookie1,2020-04-16,4</span><br><span class="line">cookie2,2020-04-10,2</span><br><span class="line">cookie2,2020-04-11,3</span><br><span class="line">cookie2,2020-04-12,5</span><br><span class="line">cookie2,2020-04-13,6</span><br><span class="line">cookie2,2020-04-14,3</span><br><span class="line">cookie2,2020-04-15,9</span><br><span class="line">cookie2,2020-04-16,7</span><br></pre></td></tr></table></figure><p></p><h5 id="ROW-NUMBER-使用"><a href="#ROW-NUMBER-使用" class="headerlink" title="ROW_NUMBER() 使用"></a>ROW_NUMBER() 使用</h5><p><code>ROW_NUMBER()</code> 从 1 开始，按照顺序，生成分组内记录的序列。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line">ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn </span><br><span class="line"><span class="keyword">FROM</span> test_t2;</span><br><span class="line"></span><br><span class="line">cookieid day           pv       rn</span><br><span class="line"><span class="comment">------------------------------------------- </span></span><br><span class="line">cookie1 2015-04-12      7       1</span><br><span class="line">cookie1 2015-04-11      5       2</span><br><span class="line">cookie1 2015-04-15      4       3</span><br><span class="line">cookie1 2015-04-16      4       4</span><br><span class="line">cookie1 2015-04-13      3       5</span><br><span class="line">cookie1 2015-04-14      2       6</span><br><span class="line">cookie1 2015-04-10      1       7</span><br><span class="line">cookie2 2015-04-15      9       1</span><br><span class="line">cookie2 2015-04-16      7       2</span><br><span class="line">cookie2 2015-04-13      6       3</span><br><span class="line">cookie2 2015-04-12      5       4</span><br><span class="line">cookie2 2015-04-14      3       5</span><br><span class="line">cookie2 2015-04-11      3       6</span><br><span class="line">cookie2 2015-04-10      2       7</span><br></pre></td></tr></table></figure><p></p><h5 id="RANK-和-DENSE-RANK-使用"><a href="#RANK-和-DENSE-RANK-使用" class="headerlink" title="RANK 和 DENSE_RANK 使用"></a>RANK 和 DENSE_RANK 使用</h5><ul><li><code>RANK()</code> 生成数据项在分组中的排名，排名相等会在名次中留下空位。</li><li><code>DENSE_RANK()</code> 生成数据项在分组中的排名，排名相等会在名次中不会留下空位。</li></ul><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line"><span class="keyword">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn1,</span><br><span class="line"><span class="keyword">DENSE_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn2,</span><br><span class="line">ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">DESC</span>) <span class="keyword">AS</span> rn3 </span><br><span class="line"><span class="keyword">FROM</span> test_t2 </span><br><span class="line"><span class="keyword">WHERE</span> cookieid = <span class="string">&#x27;cookie1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">cookieid day           pv       rn1     rn2     rn3 </span><br><span class="line"><span class="comment">-------------------------------------------------- </span></span><br><span class="line">cookie1 2015-04-12      7       1       1       1</span><br><span class="line">cookie1 2015-04-11      5       2       2       2</span><br><span class="line">cookie1 2015-04-15      4       3       3       3</span><br><span class="line">cookie1 2015-04-16      4       3       3       4</span><br><span class="line">cookie1 2015-04-13      3       5       4       5</span><br><span class="line">cookie1 2015-04-14      2       6       5       6</span><br><span class="line">cookie1 2015-04-10      1       7       6       7</span><br><span class="line"></span><br><span class="line">rn1: 15 号和 16 号并列第 3, 13 号排第 5</span><br><span class="line">rn2: 15 号和 16 号并列第 3, 13 号排第 4</span><br><span class="line">rn3: 如果相等，则按记录值排序，生成唯一的次序，如果所有记录值都相等，或许会随机排吧。</span><br></pre></td></tr></table></figure><p></p><h5 id="NTILE"><a href="#NTILE" class="headerlink" title="NTILE"></a>NTILE</h5><p>有时会有这样的需求：如果数据排序后分为三部分，业务人员只关心其中的一部分，如何将这中间的三分之一数据拿出来呢? <code>NTILE</code> 函数即可以满足。</p><p><code>NTILE</code> 可以看成是：把有序的数据集合平均分配到指定的数量（num）个桶中, 将桶号分配给每一行。如果不能平均分配，则优先分配较小编号的桶，并且各个桶中能放的行数最多相差 1。</p><p>然后可以根据桶号，选取前或后 n 分之几的数据。数据会完整展示出来，只是给相应的数据打标签；具体要取几分之几的数据，需要再嵌套一层根据标签取出。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, pv,</span><br><span class="line">NTILE(<span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn1, <span class="comment">--分组内将数据分成 2 片</span></span><br><span class="line">NTILE(<span class="number">3</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn2, <span class="comment">--分组内将数据分成 3 片</span></span><br><span class="line">NTILE(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn3 <span class="comment">--将所有数据分成 4 片</span></span><br><span class="line"><span class="keyword">FROM</span> test_t2 </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cookieid, createtime;</span><br><span class="line"></span><br><span class="line">cookieid day           pv       rn1     rn2     rn3</span><br><span class="line"><span class="comment">-------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10      1       1       1       1</span><br><span class="line">cookie1 2015-04-11      5       1       1       1</span><br><span class="line">cookie1 2015-04-12      7       1       1       2</span><br><span class="line">cookie1 2015-04-13      3       1       2       2</span><br><span class="line">cookie1 2015-04-14      2       2       2       3</span><br><span class="line">cookie1 2015-04-15      4       2       3       3</span><br><span class="line">cookie1 2015-04-16      4       2       3       4</span><br><span class="line">cookie2 2015-04-10      2       1       1       1</span><br><span class="line">cookie2 2015-04-11      3       1       1       1</span><br><span class="line">cookie2 2015-04-12      5       1       1       2</span><br><span class="line">cookie2 2015-04-13      6       1       2       2</span><br><span class="line">cookie2 2015-04-14      3       2       2       3</span><br><span class="line">cookie2 2015-04-15      9       2       3       4</span><br><span class="line">cookie2 2015-04-16      7       2       3       4</span><br><span class="line"></span><br><span class="line">比如，统计一个 cookie，pv 数最多的前 1/3 的天</span><br><span class="line">rn2 = 1 的记录，就是我们想要的结果</span><br></pre></td></tr></table></figure><p></p><h3 id="其他一些窗口函数"><a href="#其他一些窗口函数" class="headerlink" title="其他一些窗口函数"></a>其他一些窗口函数</h3><h4 id="lag-lead-first-value-last-value"><a href="#lag-lead-first-value-last-value" class="headerlink" title="lag, lead, first_value, last_value"></a>lag, lead, first_value, last_value</h4><p><strong>准备数据</strong></p><p>建表语句:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_t3(</span><br><span class="line">cookieid <span class="keyword">string</span>,</span><br><span class="line">createtime <span class="keyword">string</span>,</span><br><span class="line"><span class="keyword">url</span> <span class="keyword">string</span></span><br><span class="line">) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> </span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure><p></p><p>加载数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t3.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookie1,2015-04-10 10:00:02,url2</span><br><span class="line">cookie1,2015-04-10 10:00:00,url1</span><br><span class="line">cookie1,2015-04-10 10:03:04,url3</span><br><span class="line">cookie1,2015-04-10 10:50:05,url6</span><br><span class="line">cookie1,2015-04-10 11:00:00,url7</span><br><span class="line">cookie1,2015-04-10 10:10:00,url4</span><br><span class="line">cookie1,2015-04-10 10:50:01,url5</span><br><span class="line">cookie2,2015-04-10 10:00:02,url22</span><br><span class="line">cookie2,2015-04-10 10:00:00,url11</span><br><span class="line">cookie2,2015-04-10 10:03:04,url33</span><br><span class="line">cookie2,2015-04-10 10:50:05,url66</span><br><span class="line">cookie2,2015-04-10 11:00:00,url77</span><br><span class="line">cookie2,2015-04-10 10:10:00,url44</span><br><span class="line">cookie2,2015-04-10 10:50:01,url55</span><br></pre></td></tr></table></figure><p></p><h5 id="LAG"><a href="#LAG" class="headerlink" title="LAG"></a>LAG</h5><p><code>LAG(col, n, DEFAULT)</code> 用于统计窗口内往上第 n 行值第一个参数为列名，第二个参数为往上第 n 行（可选，默认为 1），第三个参数为默认值（当往上第 n 行为 NULL 时候，取默认值，如不指定，则为 NULL）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line">  LAG(createtime, <span class="number">1</span>, <span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last_1_time,</span><br><span class="line">  LAG(createtime, <span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last_2_time </span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid createtime             url    rn       last_1_time             last_2_time</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    1       1970-01-01 00:00:00     NULL</span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    2       2015-04-10 10:00:00     NULL</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    3       2015-04-10 10:00:02     2015-04-10 10:00:00</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    4       2015-04-10 10:03:04     2015-04-10 10:00:02</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    5       2015-04-10 10:10:00     2015-04-10 10:03:04</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    6       2015-04-10 10:50:01     2015-04-10 10:10:00</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    7       2015-04-10 10:50:05     2015-04-10 10:50:01</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   1       1970-01-01 00:00:00     NULL</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   2       2015-04-10 10:00:00     NULL</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   3       2015-04-10 10:00:02     2015-04-10 10:00:00</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   4       2015-04-10 10:03:04     2015-04-10 10:00:02</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   5       2015-04-10 10:10:00     2015-04-10 10:03:04</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   6       2015-04-10 10:50:01     2015-04-10 10:10:00</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   7       2015-04-10 10:50:05     2015-04-10 10:50:01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">last_1_time:</span><br><span class="line">  指定了往上第 1 行的值，default 为 &#x27;1970-01-01 00:00:00&#x27;</span><br><span class="line">  cookie1 第一行，往上 1 行为 NULL，因此取默认值 1970-01-01 00:00:00</span><br><span class="line">  cookie1 第三行，往上 1 行值为第二行值，2015-04-10 10:00:02</span><br><span class="line">  cookie1 第六行，往上 1 行值为第五行值，2015-04-10 10:50:01</span><br><span class="line"></span><br><span class="line">last_2_time: </span><br><span class="line">  指定了往上第 2 行的值，为指定默认值</span><br><span class="line">  cookie1 第一行，往上 2 行为 NULL</span><br><span class="line">  cookie1 第二行，往上 2 行为 NULL</span><br><span class="line">  cookie1 第四行，往上 2 行为第二行值，2015-04-10 10:00:02</span><br><span class="line">  cookie1 第七行，往上 2 行为第五行值，2015-04-10 10:50:01</span><br></pre></td></tr></table></figure><p></p><h5 id="LEAD"><a href="#LEAD" class="headerlink" title="LEAD"></a>LEAD</h5><p>与 LAG 相反 <code>LEAD(col, n, DEFAULT)</code> 用于统计窗口内往下第 n 行值第一个参数为列名，第二个参数为往下第 n 行（可选，默认为 1），第三个参数为默认值（当往下第 n 行为 NULL 时候，取默认值，如不指定，则为 NULL）</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line">  <span class="keyword">LEAD</span>(createtime, <span class="number">1</span>, <span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> next_1_time,</span><br><span class="line">  <span class="keyword">LEAD</span>(createtime, <span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> next_2_time </span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid createtime             url    rn       next_1_time             next_2_time </span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    1       2015-04-10 10:00:02     2015-04-10 10:03:04</span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    2       2015-04-10 10:03:04     2015-04-10 10:10:00</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    3       2015-04-10 10:10:00     2015-04-10 10:50:01</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    4       2015-04-10 10:50:01     2015-04-10 10:50:05</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    5       2015-04-10 10:50:05     2015-04-10 11:00:00</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    6       2015-04-10 11:00:00     NULL</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    7       1970-01-01 00:00:00     NULL</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   1       2015-04-10 10:00:02     2015-04-10 10:03:04</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   2       2015-04-10 10:03:04     2015-04-10 10:10:00</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   3       2015-04-10 10:10:00     2015-04-10 10:50:01</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   4       2015-04-10 10:50:01     2015-04-10 10:50:05</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   5       2015-04-10 10:50:05     2015-04-10 11:00:00</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   6       2015-04-10 11:00:00     NULL</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   7       1970-01-01 00:00:00     NULL</span><br><span class="line"></span><br><span class="line">逻辑与 LAG 一样，只不过 LAG 是往上，LEAD 是往下。</span><br></pre></td></tr></table></figure><p></p><h5 id="FIRST-VALUE"><a href="#FIRST-VALUE" class="headerlink" title="FIRST_VALUE"></a>FIRST_VALUE</h5><p>取分组内排序后，截止到当前行，第一个值</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line">  <span class="keyword">FIRST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> first1 </span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid  createtime            url     rn      first1</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    1       url1</span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    2       url1</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    3       url1</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    4       url1</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    5       url1</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    6       url1</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    7       url1</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   1       url11</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   2       url11</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   3       url11</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   4       url11</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   5       url11</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   6       url11</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   7       url11</span><br></pre></td></tr></table></figure><p></p><h5 id="LAST-VALUE"><a href="#LAST-VALUE" class="headerlink" title="LAST_VALUE"></a>LAST_VALUE</h5><p>取分组内排序后，截止到当前行，最后一个值</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line">  <span class="keyword">LAST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last1 </span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid  createtime            url    rn       last1</span><br><span class="line"><span class="comment">-----------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    1       url1</span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    2       url2</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    3       url3</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    4       url4</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    5       url5</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    6       url6</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    7       url7</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   1       url11</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   2       url22</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   3       url33</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   4       url44</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   5       url55</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   6       url66</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   7       url77</span><br></pre></td></tr></table></figure><p></p><p>如果想要取分组内排序后最后一个值，则需要变通一下：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line">  <span class="keyword">LAST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last1,</span><br><span class="line">  <span class="keyword">FIRST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">DESC</span>) <span class="keyword">AS</span> last2 </span><br><span class="line"><span class="keyword">FROM</span> test_t3 </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cookieid, createtime;</span><br><span class="line"></span><br><span class="line">cookieid  createtime            url     rn     last1    last2</span><br><span class="line"><span class="comment">-------------------------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    1       url1    url7</span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    2       url2    url7</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    3       url3   url7</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    4       url4    url7</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    5       url5    url7</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    6       url6    url7</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    7       url7    url7</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   1       url11   url77</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   2       url22   url77</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   3       url33   url77</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   4       url44   url77</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   5       url55   url77</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   6       url66   url77</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   7       url77   url77</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong>在使用分析函数的过程中特别注意 <code>ORDER BY</code>， 如果不指定 <code>ORDER BY</code>，则默认按照记录在文件中的偏移量进行排序，会出现错误的结果</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  <span class="keyword">FIRST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> first2</span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid  createtime            url     first2</span><br><span class="line"><span class="comment">----------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    url2</span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    url2</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    url2</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    url2</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    url2</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    url2</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    url2</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   url22</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   url22</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   url22</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   url22</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   url22</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   url22</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   url22</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cookieid, createtime, <span class="keyword">url</span>,</span><br><span class="line">  <span class="keyword">LAST_VALUE</span>(<span class="keyword">url</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> last2</span><br><span class="line"><span class="keyword">FROM</span> test_t3;</span><br><span class="line"></span><br><span class="line">cookieid  createtime            url     last2</span><br><span class="line"><span class="comment">----------------------------------------------</span></span><br><span class="line">cookie1 2015-04-10 10:00:02     url2    url5</span><br><span class="line">cookie1 2015-04-10 10:00:00     url1    url5</span><br><span class="line">cookie1 2015-04-10 10:03:04     url3    url5</span><br><span class="line">cookie1 2015-04-10 10:50:05     url6    url5</span><br><span class="line">cookie1 2015-04-10 11:00:00     url7    url5</span><br><span class="line">cookie1 2015-04-10 10:10:00     url4    url5</span><br><span class="line">cookie1 2015-04-10 10:50:01     url5    url5</span><br><span class="line">cookie2 2015-04-10 10:00:02     url22   url55</span><br><span class="line">cookie2 2015-04-10 10:00:00     url11   url55</span><br><span class="line">cookie2 2015-04-10 10:03:04     url33   url55</span><br><span class="line">cookie2 2015-04-10 10:50:05     url66   url55</span><br><span class="line">cookie2 2015-04-10 11:00:00     url77   url55</span><br><span class="line">cookie2 2015-04-10 10:10:00     url44   url55</span><br><span class="line">cookie2 2015-04-10 10:50:01     url55   url55</span><br></pre></td></tr></table></figure><p></p><h4 id="cume-dist-percent-rank"><a href="#cume-dist-percent-rank" class="headerlink" title="cume_dist, percent_rank"></a>cume_dist, percent_rank</h4><p>这两个序列分析函数不是很常用，<strong>注意：</strong>序列函数不支持 WINDOW 子句</p><p><strong>数据准备</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">d1,user1,1000</span><br><span class="line">d1,user2,2000</span><br><span class="line">d1,user3,3000</span><br><span class="line">d2,user4,4000</span><br><span class="line">d2,user5,5000</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> test_t4 (</span><br><span class="line">  dept <span class="keyword">STRING</span>,</span><br><span class="line">  userid <span class="keyword">string</span>,</span><br><span class="line">  sal <span class="built_in">INT</span></span><br><span class="line">) <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line"><span class="keyword">stored</span> <span class="keyword">as</span> textfile;</span><br></pre></td></tr></table></figure><p></p><p><strong>加载数据：</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t4.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t4;</span><br></pre></td></tr></table></figure><p></p><h5 id="CUME-DIST"><a href="#CUME-DIST" class="headerlink" title="CUME_DIST"></a>CUME_DIST</h5><p><code>CUME_DIST</code> 和 <code>order by</code> 的排序顺序有关系</p><p><code>CUME_DIST</code> 小于等于当前值的行数/分组内总行数 <code>order</code> 默认顺序（正序 升序）比如，统计小于等于当前薪水的人数，所占总人数的比例</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept, userid, sal,</span><br><span class="line">  <span class="keyword">CUME_DIST</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn1,</span><br><span class="line">  <span class="keyword">CUME_DIST</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dept <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn2</span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br><span class="line"></span><br><span class="line">dept    userid   sal   rn1       rn2 </span><br><span class="line"><span class="comment">-------------------------------------------</span></span><br><span class="line">d1      user1   1000    0.2     0.3333333333333333</span><br><span class="line">d1      user2   2000    0.4     0.6666666666666666</span><br><span class="line">d1      user3   3000    0.6     1.0</span><br><span class="line">d2      user4   4000    0.8     0.5</span><br><span class="line">d2      user5   5000    1.0     1.0</span><br><span class="line"> </span><br><span class="line">rn1: 没有 partition，所有数据均为 1 组，总行数为 5，</span><br><span class="line">     第一行：小于等于 1000 的行数为 1，因此，1/5=0.2</span><br><span class="line">     第三行：小于等于 3000 的行数为 3，因此，3/5=0.6</span><br><span class="line">rn2: 按照部门分组，dpet=d1 的行数为 3，</span><br><span class="line">     第二行：小于等于 2000 的行数为 2，因此，2/3=0.6666666666666666</span><br></pre></td></tr></table></figure><p></p><h5 id="PERCENT-RANK"><a href="#PERCENT-RANK" class="headerlink" title="PERCENT_RANK"></a>PERCENT_RANK</h5><p><code>PERCENT_RANK</code> 分组内当前行的 (RANK 值 - 1)/(分组内总行数 - 1)</p><p>经调研，该函数显示现实意义不明朗，有待于继续考证</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept, userid, sal,</span><br><span class="line">  <span class="keyword">PERCENT_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn1,   <span class="comment">--分组内</span></span><br><span class="line">  <span class="keyword">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn11,          <span class="comment">--分组内 RANK 值</span></span><br><span class="line">  <span class="keyword">SUM</span>(<span class="number">1</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="literal">NULL</span>) <span class="keyword">AS</span> rn12,     <span class="comment">--分组内总行数</span></span><br><span class="line">  <span class="keyword">PERCENT_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dept <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn2 </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br><span class="line"></span><br><span class="line">dept    userid   sal    rn1    rn11     rn12    rn2</span><br><span class="line"><span class="comment">---------------------------------------------------</span></span><br><span class="line">d1      user1   1000    0.0     1       5       0.0</span><br><span class="line">d1      user2   2000    0.25    2       5       0.5</span><br><span class="line">d1      user3   3000    0.5     3       5       1.0</span><br><span class="line">d2      user4   4000    0.75    4       5       0.0</span><br><span class="line">d2      user5   5000    1.0     5       5       1.0</span><br><span class="line"></span><br><span class="line">rn1: rn1 = (rn11-1) / (rn12-1) </span><br><span class="line">  第一行，(1-1)/(5-1) = 0/4 = 0</span><br><span class="line">  第二行，(2-1)/(5-1) = 1/4 = 0.25</span><br><span class="line">  第四行，(4-1)/(5-1) = 3/4 = 0.75</span><br><span class="line">rn2: 按照 dept 分组，</span><br><span class="line">  dept=d1 的总行数为 3</span><br><span class="line">  第一行，(1-1)/(3-1) = 0</span><br><span class="line">  第三行，(3-1)/(3-1) = 1</span><br></pre></td></tr></table></figure><p></p><h4 id="grouping-sets-cube-rollup"><a href="#grouping-sets-cube-rollup" class="headerlink" title="grouping sets, cube, rollup"></a>grouping sets, cube, rollup</h4><p>这几个分析函数通常用于 OLAP 中，不能累加，而且需要根据不同维度上钻和下钻的指标统计，比如，分小时、天、月的 UV 数。</p><p><strong>数据准备：</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_t5 (</span><br><span class="line">  <span class="keyword">month</span> <span class="keyword">STRING</span>,</span><br><span class="line">  <span class="keyword">day</span> <span class="keyword">STRING</span>, </span><br><span class="line">  cookieid <span class="keyword">STRING</span> </span><br><span class="line">) <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line"><span class="keyword">stored</span> <span class="keyword">as</span> textfile;</span><br></pre></td></tr></table></figure><p></p><p><strong>加载数据：</strong></p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t5.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t5;</span><br><span class="line"></span><br><span class="line">2020-03,2020-03-10,cookie1</span><br><span class="line">2020-03,2020-03-10,cookie5</span><br><span class="line">2020-03,2020-03-12,cookie7</span><br><span class="line">2020-04,2020-04-12,cookie3</span><br><span class="line">2020-04,2020-04-13,cookie2</span><br><span class="line">2020-04,2020-04-13,cookie4</span><br><span class="line">2020-04,2020-04-16,cookie4</span><br><span class="line">2020-03,2020-03-10,cookie2</span><br><span class="line">2020-03,2020-03-10,cookie3</span><br><span class="line">2020-04,2020-04-12,cookie5</span><br><span class="line">2020-04,2020-04-13,cookie6</span><br><span class="line">2020-04,2020-04-15,cookie3</span><br><span class="line">2020-04,2020-04-15,cookie2</span><br><span class="line">2020-04,2020-04-16,cookie1</span><br></pre></td></tr></table></figure><p></p><h5 id="GROUPING-SETS"><a href="#GROUPING-SETS" class="headerlink" title="GROUPING SETS"></a>GROUPING SETS</h5><p><code>grouping sets</code> 是一种将多个 <code>group by</code> 逻辑写在一个 SQL 语句中的便利写法。</p><p>等价于将不同维度的 <code>GROUP BY</code> 结果集进行 <code>UNION ALL</code>。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, <span class="keyword">day</span> </span><br><span class="line"><span class="keyword">GROUPING</span> <span class="keyword">SETS</span> (<span class="keyword">month</span>, <span class="keyword">day</span>) </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">month      day            uv      GROUPING__ID</span><br><span class="line"><span class="comment">------------------------------------------------</span></span><br><span class="line">2015-03    NULL            5       1</span><br><span class="line">2015-04    NULL            6       1</span><br><span class="line">NULL       2015-03-10      4       2</span><br><span class="line">NULL       2015-03-12      1       2</span><br><span class="line">NULL       2015-04-12      2       2</span><br><span class="line">NULL       2015-04-13      3       2</span><br><span class="line">NULL       2015-04-15      2       2</span><br><span class="line">NULL       2015-04-16      2       2</span><br></pre></td></tr></table></figure><p></p><p><code>grouping_id</code> 表示这一组结果属于哪个分组集合， 根据 <code>grouping sets</code> 中的分组条件 month，day，1 是代表 month，2 是代表 day</p><p>等价于</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="literal">NULL</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="literal">NULL</span> <span class="keyword">as</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span>;</span><br></pre></td></tr></table></figure><p></p><p>再如：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span> </span><br><span class="line"><span class="keyword">GROUPING</span> <span class="keyword">SETS</span> (<span class="keyword">month</span>, <span class="keyword">day</span>, (<span class="keyword">month</span>, <span class="keyword">day</span>)) </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">month         day             uv      GROUPING__ID</span><br><span class="line"><span class="comment">------------------------------------------------</span></span><br><span class="line">2015-03       NULL            5       1</span><br><span class="line">2015-04       NULL            6       1</span><br><span class="line">NULL          2015-03-10      4       2</span><br><span class="line">NULL          2015-03-12      1       2</span><br><span class="line">NULL          2015-04-12      2       2</span><br><span class="line">NULL          2015-04-13      3       2</span><br><span class="line">NULL          2015-04-15      2       2</span><br><span class="line">NULL          2015-04-16      2       2</span><br><span class="line">2015-03       2015-03-10      4       3</span><br><span class="line">2015-03       2015-03-12      1       3</span><br><span class="line">2015-04       2015-04-12      2       3</span><br><span class="line">2015-04       2015-04-13      3       3</span><br><span class="line">2015-04       2015-04-15      2       3</span><br><span class="line">2015-04       2015-04-16      2       3</span><br></pre></td></tr></table></figure><p></p><p>等价于</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="literal">NULL</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="literal">NULL</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">3</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, <span class="keyword">day</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="CUBE"><a href="#CUBE" class="headerlink" title="CUBE"></a>CUBE</h5><p>根据 <code>GROUP BY</code> 的维度的所有组合进行聚合。</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, <span class="keyword">day</span> </span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">CUBE</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">month           day             uv     GROUPING__ID</span><br><span class="line"><span class="comment">--------------------------------------------</span></span><br><span class="line">NULL            NULL            7       0</span><br><span class="line">2015-03         NULL            5       1</span><br><span class="line">2015-04         NULL            6       1</span><br><span class="line">NULL            2015-04-12      2       2</span><br><span class="line">NULL            2015-04-13      3       2</span><br><span class="line">NULL            2015-04-15      2       2</span><br><span class="line">NULL            2015-04-16      2       2</span><br><span class="line">NULL            2015-03-10      4       2</span><br><span class="line">NULL            2015-03-12      1       2</span><br><span class="line">2015-03         2015-03-10      4       3</span><br><span class="line">2015-03         2015-03-12      1       3</span><br><span class="line">2015-04         2015-04-16      2       3</span><br><span class="line">2015-04         2015-04-12      2       3</span><br><span class="line">2015-04         2015-04-13      3       3</span><br><span class="line">2015-04         2015-04-15      2       3</span><br></pre></td></tr></table></figure><p></p><p>等价于</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">0</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="literal">NULL</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="literal">NULL</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, <span class="number">3</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, <span class="keyword">day</span>;</span><br></pre></td></tr></table></figure><p></p><h5 id="ROLLUP"><a href="#ROLLUP" class="headerlink" title="ROLLUP"></a>ROLLUP</h5><p>是 <code>CUBE</code> 的子集，以最左侧的维度为主，从该维度进行层级聚合。</p><p>比如，以 <code>month</code> 维度进行层级聚合：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, <span class="keyword">day</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">month            day             uv     GROUPING__ID</span><br><span class="line"><span class="comment">---------------------------------------------------</span></span><br><span class="line">NULL             NULL            7       0</span><br><span class="line">2015-03          NULL            5       1</span><br><span class="line">2015-04          NULL            6       1</span><br><span class="line">2015-03          2015-03-10      4       3</span><br><span class="line">2015-03          2015-03-12      1       3</span><br><span class="line">2015-04          2015-04-12      2       3</span><br><span class="line">2015-04          2015-04-13      3       3</span><br><span class="line">2015-04          2015-04-15      2       3</span><br><span class="line">2015-04          2015-04-16      2       3</span><br></pre></td></tr></table></figure><p></p><p>把 <code>month</code> 和 <code>day</code> 调换顺序，则以 <code>day</code> 维度进行层级聚合：</p><p></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">day</span>, <span class="keyword">month</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv, GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span>, <span class="keyword">month</span> </span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">day             month              uv     GROUPING__ID</span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line">NULL            NULL               7       0</span><br><span class="line">2015-04-13      NULL               3       1</span><br><span class="line">2015-03-12      NULL               1       1</span><br><span class="line">2015-04-15      NULL               2       1</span><br><span class="line">2015-03-10      NULL               4       1</span><br><span class="line">2015-04-16      NULL               2       1</span><br><span class="line">2015-04-12      NULL               2       1</span><br><span class="line">2015-04-12      2015-04            2       3</span><br><span class="line">2015-03-10      2015-03            4       3</span><br><span class="line">2015-03-12      2015-03            1       3</span><br><span class="line">2015-04-13      2015-04            3       3</span><br><span class="line">2015-04-15      2015-04            2       3</span><br><span class="line">2015-04-16      2015-04            2       3</span><br></pre></td></tr></table></figure><p></p><p>这里，根据天和月进行聚合，和根据天聚合结果一样，因为有父子关系，如果是其他维度组合的话，就会不一样。</p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info">Hive SQL 大全</span></div><div class="post-copyright__url"><span class="post-copyright-info"><a id="post-url" href="https://blog.eurkon.com/post/7891b2e6.html">https://blog.eurkon.com/post/7891b2e6.html</a><a id="post-url-copy" title="复制文章链接" onclick="btf.copyFn(&quot;https://blog.eurkon.com/post/7891b2e6.html&quot;)"><i class="fas fa-paste copy-button"></i></a></span></div><div class="post-copyright__cc"><span class="post-copyright-info">转载前请阅读本站 <a href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a>，文章著作权归 <a href="https://blog.eurkon.com/">Eurkon</a> 所有，转载请注明出处。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><a class="post-meta__tags" href="/tags/Hive/">Hive</a></div><div class="post-share"><div class="social-share" data-image="/images/cover/hive.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/47457d03.html" title="HBase 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" onerror='onerror=null,src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">HBase 面试题解析</div></div><div class="info-2"><div class="info-item-1">HBase 的特点是什么？ 大：一个表可以有数十亿行，上百万列； 无模式：每行都有一个可排序的主键和任意多的列，列可以根据需要动态的增加，同一张表中不同的行可以有截然不同的列； 面向列：面向列（族）的存储和权限控制，列（族）独立检索； 稀疏：空（null）列并不占用存储空间，表可以设计的非常稀疏； 数据多版本：每个单元中的数据可以有多个版本，默认情况下版本号自动分配，是单元格插入时的时间戳； 数据类型单一：HBase 中的数据都是字符串，没有类型。 HBase 和 Hive 的区别？ &nbsp; HBase Hive 类型 列式数据库 数据仓库 内部机制 数据库引擎 MapReduce 增删改查 都支持 只支持导入和查询 Schema 只需要预先定义列族，不需要具体到列，列可以动态修改 需要预先定义表格 应用场景 实时 离线处理 特点 以 K-V 形式存储 类 SQL Hive 和 HBase 是两种基于 Hadoop 的不同技术，Hive 是一种类 SQL 的引擎，并且运行 MapReduce 任务，HBase 是一种在...</div></div></div></a><a class="pagination-related" href="/post/420614eb.html" title="Sqoop 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" onerror='onerror=null,src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Sqoop 面试题解析</div></div><div class="info-2"><div class="info-item-1">Sqoop 参数Sqoop 导入数据到 HDFS 中的参数 123456789101112131415/opt/module/sqoop/bin/sqoop import \--connect jdbc 的 url 字符串\--username 账号\--password 密码\# HDFS 目标的目录--target-dir \# 导入的目标目录如果存在则删除那个目录--delete-target-dir \# 相当于 -m，并行导入时 MapTask 的个数--num-mappers \--fields-terminated-by \# 指定满足 sql 和条件的数据导入# --query：增加检索条件部分数据抽取# $CONDITIONS：数据分割条件的占位符--query &quot;$2&quot; &#x27;and $CONDITIONS;&#x27; Sqoop 导入数据到 Hive 中的参数 123456789# 一步将表结构和数据都导入到 hive 中bin/sqoop import \--connect jdbc 的 url 字符串\--table...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/7e24cf66.html" title="大数据面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-25</div><div class="info-item-2">大数据面试题解析</div></div><div class="info-2"><div class="info-item-1">Hadoop 面试题解析Zookeeper 面试题解析Flume 面试题解析Kafka 面试题解析Hive 面试题解析HBase 面试题解析Sqoop 面试题解析MySQL 面试题解析Spark 面试题解析Elasticsearch 面试题解析</div></div></div></a><a class="pagination-related" href="/post/62c9bbde.html" title="Hive 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-31</div><div class="info-item-2">Hive 面试题解析</div></div><div class="info-2"><div class="info-item-1">Hive 基础请谈一下 Hive 的特点，Hive 和 RDBMS 有什么异同？Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供完整的 SQL 查询功能，可以将 SQL 语句转换为 MapReduce 任务进行运行。其优点是学习成本低，可以通过类 SQL 语句快速实现简单的 MapReduce 统计，不必开发专门的 MapReduce 应用，十分适合数据仓库的统计分析，但是 Hive 不支持实时查询。 Hive 与关系型数据库的区别： 比较项 SQL HiveQL ANSI SQL 支持 不完全支持 更新 UPDATE\INSERT\DELETE INSERT OVERWRITE\INTO TABLE 事务 支持 不支持 模式 写模式 读模式 数据保存 块设备、本地文件系统 HDFS 延时 低 高 多表插入 不支持 支持 子查询 完全支持 只能用在 From...</div></div></div></a><a class="pagination-related" href="/post/d1e7dfd3.html" title="HDFS Shell 命令"><img class="cover" src="/images/cover/hdfs_shell.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-05</div><div class="info-item-2">HDFS Shell 命令</div></div><div class="info-2"><div class="info-item-1">FS Shell 调用文件系统（FS）的 Shell 命令应使用 bin/hadoop fs &lt;args&gt; 的形式。 所有的 FS shell 命令使用 URI 路径作为参数。 URI 格式是 scheme://authority/path。对 HDFS 文件系统，scheme 是 hdfs，对本地文件系统，scheme 是 file。其中 scheme 和 authority 参数都是可选的，如果未加指定，就会使用配置中指定的默认 scheme。 一个 HDFS 文件或目录比如 /parent/child 可以表示成 hdfs://namenode:namenodeport/parent/child，或者更简单的 /parent/child（假设你配置文件中的默认值是 namenode:namenodeport）。 大多数 FS Shell 命令的行为和对应的 Unix Shell 命令类似，不同之处会在下面介绍各命令使用详情时指出。出错信息会输出到 stderr，其他信息输出到 stdout。 cat 使用方法： 1hadoop fs -cat...</div></div></div></a><a class="pagination-related" href="/post/5a2a12a6.html" title="Flume 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-29</div><div class="info-item-2">Flume 面试题解析</div></div><div class="info-2"><div class="info-item-1">Flume 使用场景？线上数据一般主要是落地（存储到磁盘）或者通过 socket 传输给另外一个系统，这种情况下，你很难推动线上应用或服务去修改接口，实现直接向 Kafka 里写数据，这时候你可能就需要 Flume 这样的系统帮你去做传输。 Flume 丢包问题？单机 upd 的 Flume source 的配置，100+M/s 数据量，10w qps Flume 就开始大量丢包，因此很多公司在搭建系统时，抛弃了 Flume，自己研发传输系统，但是往往会参考 Flume 的 Source-Channel-Sink 模式。 一些公司在 Flume 工作过程中，会对业务日志进行监控，例如 Flume agent 中有多少条日志，Flume 到 Kafka 后有多少条日志等等，如果数据丢失保持在 1% 左右是没有问题的，当数据丢失达到 5% 左右时就必须采取相应措施。 Flume 与 Kafka 的选取？采集层主要可以使用 Flume、Kafka 两种技术。 Flume：Flume 是管道流方式，提供了很多的默认实现，让用户通过参数部署，及扩展 API。 Kafka：Kafka...</div></div></div></a><a class="pagination-related" href="/post/420614eb.html" title="Sqoop 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-13</div><div class="info-item-2">Sqoop 面试题解析</div></div><div class="info-2"><div class="info-item-1">Sqoop 参数Sqoop 导入数据到 HDFS 中的参数 123456789101112131415/opt/module/sqoop/bin/sqoop import \--connect jdbc 的 url 字符串\--username 账号\--password 密码\# HDFS 目标的目录--target-dir \# 导入的目标目录如果存在则删除那个目录--delete-target-dir \# 相当于 -m，并行导入时 MapTask 的个数--num-mappers \--fields-terminated-by \# 指定满足 sql 和条件的数据导入# --query：增加检索条件部分数据抽取# $CONDITIONS：数据分割条件的占位符--query &quot;$2&quot; &#x27;and $CONDITIONS;&#x27; Sqoop 导入数据到 Hive 中的参数 123456789# 一步将表结构和数据都导入到 hive 中bin/sqoop import \--connect jdbc 的 url 字符串\--table...</div></div></div></a><a class="pagination-related" href="/post/2f1ea7f2.html" title="Zookeeper 面试题解析"><img class="cover" src="/images/cover/bigdata_interview.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-27</div><div class="info-item-2">Zookeeper 面试题解析</div></div><div class="info-2"><div class="info-item-1">请简述 Zookeeper 的选举机制？假设有五台服务器组成的 Zookeeper 集群，它们的 id 从 1-5，同时它们都是最新启动的，也就是没有历史数据，在存放数据量这一点上，都是一样的。假设这些服务器依序启动，来看看会发生什么。 服务器 1 启动，此时只有它一台服务器启动了，它发出去的报没有任何响应，所以它的选举状态一直是 LOOKING 状态； 服务器 2 启动，它与最开始启动的服务器 1 进行通信，互相交换自己的选举结果，由于两者都没有历史数据，所以 id 值较大的服务器 2 胜出，但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是 3)，所以服务器 1、2 还是继续保持 LOOKING 状态； 服务器 3 启动，根据前面的理论分析，服务器 3 成为服务器 1、2、3 中的 Leader，而与上面不同的是，此时有三台服务器选举了它，所以它成为了这次选举的 Leader； 服务器 4 启动，根据前面的分析，理论上服务器 4 应该是服务器 1、2、3、4 中最大的，但是由于前面已经有半数以上的服务器选举了服务器 3，所以它成为...</div></div></div></a></div></div></div><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div><div id="comment-close" onclick="custom.switchCommentMode()"><i class="fas fa-xmark"></i></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div id="comment-mask"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="card-info-top"><div id="card-info-hello"></div><div class="card-info-img"><img src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/loading.gif"' alt="avatar"></div></div><div class="author-info-name is-center">Eurkon</div><div class="author-info-description">在这里我将记录学习过程中的笔记、分享一些经验与想法。希望能够帮助到您！</div><script defer data-pjax="data-pjax" src="/js/card_info.js"></script><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Eurkon" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:eurkon@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E7%9A%84-DDL-%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">Hive 的 DDL 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">对数据库的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.2.</span> <span class="toc-text">修改数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-number">2.1.3.</span> <span class="toc-text">查看数据库信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.4.</span> <span class="toc-text">删除数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">对数据表的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E7%AE%A1%E7%90%86%E8%A1%A8%EF%BC%88%E5%86%85%E9%83%A8%E8%A1%A8%EF%BC%89%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.1.</span> <span class="toc-text">对管理表（内部表）的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E5%86%85%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">建内部表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hive-%E5%BB%BA%E8%A1%A8%E6%97%B6%E5%80%99%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Hive 建表时候的字段类型:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%B9%B6%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E4%B9%8B%E9%97%B4%E7%9A%84%E5%88%86%E9%9A%94%E7%AC%A6"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">创建表并指定字段之间的分隔符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">根据查询结果创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">根据已经存在的表结构创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">查询表的结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.2.1.7.</span> <span class="toc-text">查询创建表的语句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96%E9%83%A8%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.2.</span> <span class="toc-text">对外部表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">构建外部表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%90%91%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">从本地文件系统向表中加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E-HDFS-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%90%91%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">从 HDFS 文件系统向表中加载数据</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%88%86%E5%8C%BA%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">对分区表的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E5%8C%BA%E8%A1%A8%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">创建分区表的语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8%E5%B8%A6%E5%A4%9A%E4%B8%AA%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">创建一个表带多个分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0%E4%B8%80%E4%B8%AA%E5%88%86%E5%8C%BA%E7%9A%84%E8%A1%A8%E4%B8%AD"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">加载数据到一个分区的表中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0%E4%B8%80%E4%B8%AA%E5%A4%9A%E5%88%86%E5%8C%BA%E7%9A%84%E8%A1%A8%E4%B8%AD%E5%8E%BB"><span class="toc-number">2.2.3.4.</span> <span class="toc-text">加载数据到一个多分区的表中去</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.3.5.</span> <span class="toc-text">查看分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.3.6.</span> <span class="toc-text">添加一个分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.3.7.</span> <span class="toc-text">同时添加多个分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.3.8.</span> <span class="toc-text">删除分区</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%88%86%E6%A1%B6%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.4.</span> <span class="toc-text">对分桶表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-Hive-%E7%9A%84%E6%8D%85%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">开启 Hive 的捅表功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Reduce-%E7%9A%84%E4%B8%AA%E6%95%B0"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">设置 Reduce 的个数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A1%B6%E8%A1%A8"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">创建桶表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-insert-overwrite-%E7%BB%99%E6%A1%B6%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.4.4.</span> <span class="toc-text">通过 insert overwrite 给桶表中加载数据</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%92%8C%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">2.2.5.</span> <span class="toc-text">修改表和删除表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">修改表名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0-%E4%BF%AE%E6%94%B9%E5%88%97%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">增加&#x2F;修改列信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">删除表操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.5.4.</span> <span class="toc-text">清空表操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91-Hive-%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.6.</span> <span class="toc-text">向 Hive 表中加载数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%90%91%E5%88%86%E5%8C%BA%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">直接向分区表中插入数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-load-%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">通过 load 方式加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.6.3.</span> <span class="toc-text">通过查询方式加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%B9%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.6.4.</span> <span class="toc-text">查询语句中创建表并加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%98%AF%E9%80%9A%E8%BF%87-location-%E6%8C%87%E5%AE%9A%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="toc-number">2.2.6.5.</span> <span class="toc-text">在创建表是通过 location 指定加载数据的路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#export-%E5%AF%BC%E5%87%BA%E4%B8%8E-import-%E5%AF%BC%E5%85%A5-Hive-%E8%A1%A8%E6%95%B0%E6%8D%AE%EF%BC%88%E5%86%85%E9%83%A8%E8%A1%A8%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">2.2.6.6.</span> <span class="toc-text">export 导出与 import 导入 Hive 表数据（内部表操作）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hive-%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-number">2.2.7.</span> <span class="toc-text">Hive 表中数据导出</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#insert-%E5%AF%BC%E5%87%BA"><span class="toc-number">2.2.7.1.</span> <span class="toc-text">insert 导出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hadoop-%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="toc-number">2.2.7.2.</span> <span class="toc-text">Hadoop 命令导出到本地</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hive-shell-%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA"><span class="toc-number">2.2.7.3.</span> <span class="toc-text">hive shell 命令导出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#export-%E5%AF%BC%E5%87%BA%E5%88%B0-HDFS-%E4%B8%8A"><span class="toc-number">2.2.7.4.</span> <span class="toc-text">export 导出到 HDFS 上</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E7%9A%84-DQL-%E8%AF%AD%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">Hive 的 DQL 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2%E3%80%81%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.</span> <span class="toc-text">单表查询、关联查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WHERE-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.1.</span> <span class="toc-text">WHERE 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GROUP-BY-%E5%88%86%E7%BB%84"><span class="toc-number">3.1.2.</span> <span class="toc-text">GROUP BY 分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JOIN-%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.3.</span> <span class="toc-text">JOIN 连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORDER-BY-%E6%8E%92%E5%BA%8F"><span class="toc-number">3.1.4.</span> <span class="toc-text">ORDER BY 排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SORT-BY-%E5%B1%80%E9%83%A8%E6%8E%92%E5%BA%8F"><span class="toc-number">3.1.5.</span> <span class="toc-text">SORT BY 局部排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DISTRIBUTE-BY-%E5%88%86%E5%8C%BA%E6%8E%92%E5%BA%8F"><span class="toc-number">3.1.6.</span> <span class="toc-text">DISTRIBUTE BY 分区排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CLUSTER-BY-%E6%8E%92%E5%BA%8F"><span class="toc-number">3.1.7.</span> <span class="toc-text">CLUSTER BY 排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">Hive 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E9%9B%86%E5%90%88%E6%80%BB%E4%BD%93%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">非空集合总体变量函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E9%9B%86%E5%90%88%E6%A0%B7%E6%9C%AC%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">非空集合样本变量函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%A0%87%E5%87%86%E5%81%8F%E7%A6%BB%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">总体标准偏离函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%AD%E4%BD%8D%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">中位数函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="toc-number">3.2.2.</span> <span class="toc-text">关系运算</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LIKE-%E6%AF%94%E8%BE%83"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">LIKE 比较</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RLIKE-%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">RLIKE 操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#REGEXP-%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">REGEXP 操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">3.2.3.</span> <span class="toc-text">数学运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">3.2.4.</span> <span class="toc-text">逻辑运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E8%BF%90%E7%AE%97"><span class="toc-number">3.2.5.</span> <span class="toc-text">数值运算</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%96%E6%95%B4%E5%87%BD%E6%95%B0-round"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">取整函数 round</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%B2%BE%E5%BA%A6%E5%8F%96%E6%95%B4%E5%87%BD%E6%95%B0-round"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">指定精度取整函数 round</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%91%E4%B8%8B%E5%8F%96%E6%95%B4%E5%87%BD%E6%95%B0-floor"><span class="toc-number">3.2.5.3.</span> <span class="toc-text">向下取整函数 floor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%91%E4%B8%8A%E5%8F%96%E6%95%B4%E5%87%BD%E6%95%B0-ceil"><span class="toc-number">3.2.5.4.</span> <span class="toc-text">向上取整函数 ceil</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%96%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%87%BD%E6%95%B0-rand"><span class="toc-number">3.2.5.5.</span> <span class="toc-text">取随机数函数 rand</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E6%8C%87%E6%95%B0%E5%87%BD%E6%95%B0-exp"><span class="toc-number">3.2.5.6.</span> <span class="toc-text">自然指数函数 exp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A5-10-%E4%B8%BA%E5%BA%95%E5%AF%B9%E6%95%B0%E5%87%BD%E6%95%B0-log10"><span class="toc-number">3.2.5.7.</span> <span class="toc-text">以 10 为底对数函数 log10</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%82%E8%BF%90%E7%AE%97%E5%87%BD%E6%95%B0-pow"><span class="toc-number">3.2.5.8.</span> <span class="toc-text">幂运算函数 pow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%B9%B3%E6%96%B9%E5%87%BD%E6%95%B0-sqrt"><span class="toc-number">3.2.5.9.</span> <span class="toc-text">开平方函数 sqrt</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%87%BD%E6%95%B0-bin"><span class="toc-number">3.2.5.10.</span> <span class="toc-text">二进制函数 bin</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.6.</span> <span class="toc-text">条件函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IF-%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.6.1.</span> <span class="toc-text">IF 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E6%9F%A5%E6%89%BE%E5%87%BD%E6%95%B0-coalesce"><span class="toc-number">3.2.6.2.</span> <span class="toc-text">非空查找函数 coalesce</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%87%BD%E6%95%B0-case-when"><span class="toc-number">3.2.6.3.</span> <span class="toc-text">条件判断函数 case when</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.7.</span> <span class="toc-text">日期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D-UNIX-%E6%97%B6%E9%97%B4%E6%88%B3%E5%87%BD%E6%95%B0-unix-timestamp"><span class="toc-number">3.2.7.1.</span> <span class="toc-text">获取当前 UNIX 时间戳函数 unix_timestamp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UNIX-%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0-from-unixtime"><span class="toc-number">3.2.7.2.</span> <span class="toc-text">UNIX 时间戳转日期函数 from_unixtime</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC-UNIX-%E6%97%B6%E9%97%B4%E6%88%B3%E5%87%BD%E6%95%B0-unix-timestamp"><span class="toc-number">3.2.7.3.</span> <span class="toc-text">日期转 UNIX 时间戳函数 unix_timestamp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%A0%BC%E5%BC%8F%E6%97%A5%E6%9C%9F%E8%BD%AC-UNIX-%E6%97%B6%E9%97%B4%E6%88%B3%E5%87%BD%E6%95%B0-unix-timestamp"><span class="toc-number">3.2.7.4.</span> <span class="toc-text">指定格式日期转 UNIX 时间戳函数 unix_timestamp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E8%BD%AC%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0-to-date"><span class="toc-number">3.2.7.5.</span> <span class="toc-text">日期时间转日期函数 to_date</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E5%B9%B4%E5%87%BD%E6%95%B0-year"><span class="toc-number">3.2.7.6.</span> <span class="toc-text">日期转年函数 year</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E6%9C%88%E5%87%BD%E6%95%B0-month"><span class="toc-number">3.2.7.7.</span> <span class="toc-text">日期转月函数 month</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E5%A4%A9%E5%87%BD%E6%95%B0-day"><span class="toc-number">3.2.7.8.</span> <span class="toc-text">日期转天函数 day</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E5%B0%8F%E6%97%B6%E5%87%BD%E6%95%B0-hour"><span class="toc-number">3.2.7.9.</span> <span class="toc-text">日期转小时函数 hour</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E5%88%86%E9%92%9F%E5%87%BD%E6%95%B0-minute"><span class="toc-number">3.2.7.10.</span> <span class="toc-text">日期转分钟函数 minute</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E7%A7%92%E5%87%BD%E6%95%B0-second"><span class="toc-number">3.2.7.11.</span> <span class="toc-text">日期转秒函数 second</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E5%91%A8%E5%87%BD%E6%95%B0-weekofyear"><span class="toc-number">3.2.7.12.</span> <span class="toc-text">日期转周函数 weekofyear</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%AF%94%E8%BE%83%E5%87%BD%E6%95%B0-datediff"><span class="toc-number">3.2.7.13.</span> <span class="toc-text">日期比较函数 datediff</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%A2%9E%E5%8A%A0%E5%87%BD%E6%95%B0-date-add"><span class="toc-number">3.2.7.14.</span> <span class="toc-text">日期增加函数 date_add</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%8F%E5%B0%91%E5%87%BD%E6%95%B0-date-sub"><span class="toc-number">3.2.7.15.</span> <span class="toc-text">日期减少函数 date_sub</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.8.</span> <span class="toc-text">字符串函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6%E5%87%BD%E6%95%B0-length"><span class="toc-number">3.2.8.1.</span> <span class="toc-text">字符串长度函数 length</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%8D%E8%BD%AC%E5%87%BD%E6%95%B0-reverse"><span class="toc-number">3.2.8.2.</span> <span class="toc-text">字符串反转函数 reverse</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0-concat"><span class="toc-number">3.2.8.3.</span> <span class="toc-text">字符串连接函数 concat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%A6%E5%88%86%E9%9A%94%E7%AC%A6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0-concat-ws"><span class="toc-number">3.2.8.4.</span> <span class="toc-text">带分隔符字符串连接函数 concat_ws</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96%E5%87%BD%E6%95%B0-substr-substring"><span class="toc-number">3.2.8.5.</span> <span class="toc-text">字符串截取函数 substr, substring</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E5%A4%A7%E5%86%99%E5%87%BD%E6%95%B0-upper-ucase"><span class="toc-number">3.2.8.6.</span> <span class="toc-text">字符串转大写函数 upper, ucase</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E5%B0%8F%E5%86%99%E5%87%BD%E6%95%B0-lower-lcase"><span class="toc-number">3.2.8.7.</span> <span class="toc-text">字符串转小写函数 lower, lcase</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%BB%E7%A9%BA%E6%A0%BC%E5%87%BD%E6%95%B0-trim"><span class="toc-number">3.2.8.8.</span> <span class="toc-text">去空格函数 trim</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E8%BE%B9%E5%8E%BB%E7%A9%BA%E6%A0%BC%E5%87%BD%E6%95%B0-ltrim"><span class="toc-number">3.2.8.9.</span> <span class="toc-text">左边去空格函数 ltrim</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E8%BE%B9%E5%8E%BB%E7%A9%BA%E6%A0%BC%E5%87%BD%E6%95%B0-rtrim"><span class="toc-number">3.2.8.10.</span> <span class="toc-text">右边去空格函数 rtrim</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0-regexp-replace"><span class="toc-number">3.2.8.11.</span> <span class="toc-text">正则表达式替换函数 regexp_replace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%A7%A3%E6%9E%90%E5%87%BD%E6%95%B0-regexp-extract"><span class="toc-number">3.2.8.12.</span> <span class="toc-text">正则表达式解析函数 regexp_extract</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#URL-%E8%A7%A3%E6%9E%90%E5%87%BD%E6%95%B0-parse-url"><span class="toc-number">3.2.8.13.</span> <span class="toc-text">URL 解析函数 parse_url</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-%E8%A7%A3%E6%9E%90%E5%87%BD%E6%95%B0-get-json-object"><span class="toc-number">3.2.8.14.</span> <span class="toc-text">JSON 解析函数 get_json_object</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0-space"><span class="toc-number">3.2.8.15.</span> <span class="toc-text">空格字符串函数 space</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0-repeat"><span class="toc-number">3.2.8.16.</span> <span class="toc-text">重复字符串函数 repeat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A6%96%E5%AD%97%E7%AC%A6-ascii-%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.8.17.</span> <span class="toc-text">首字符 ascii 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E8%A1%A5%E8%B6%B3%E5%87%BD%E6%95%B0-lpad"><span class="toc-number">3.2.8.18.</span> <span class="toc-text">左补足函数 lpad</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E8%A1%A5%E8%B6%B3%E5%87%BD%E6%95%B0-rpad"><span class="toc-number">3.2.8.19.</span> <span class="toc-text">右补足函数 rpad</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0-split"><span class="toc-number">3.2.8.20.</span> <span class="toc-text">分割字符串函数 split</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%9F%A5%E6%89%BE%E5%87%BD%E6%95%B0-find-in-set"><span class="toc-number">3.2.8.21.</span> <span class="toc-text">集合查找函数 find_in_set</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.9.</span> <span class="toc-text">复合类型构建操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Map-%E7%B1%BB%E5%9E%8B%E6%9E%84%E5%BB%BA"><span class="toc-number">3.2.9.1.</span> <span class="toc-text">Map 类型构建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Struct-%E7%B1%BB%E5%9E%8B%E6%9E%84%E5%BB%BA"><span class="toc-number">3.2.9.2.</span> <span class="toc-text">Struct 类型构建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Array-%E7%B1%BB%E5%9E%8B%E6%9E%84%E5%BB%BA"><span class="toc-number">3.2.9.3.</span> <span class="toc-text">Array 类型构建</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E8%AE%BF%E9%97%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.10.</span> <span class="toc-text">复杂类型访问操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Array-%E7%B1%BB%E5%9E%8B%E8%AE%BF%E9%97%AE-A-n"><span class="toc-number">3.2.10.1.</span> <span class="toc-text">Array 类型访问: A[n]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Map-%E7%B1%BB%E5%9E%8B%E8%AE%BF%E9%97%AE-M-key"><span class="toc-number">3.2.10.2.</span> <span class="toc-text">Map 类型访问: M[key]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Struct-%E7%B1%BB%E5%9E%8B%E8%AE%BF%E9%97%AE-S-x"><span class="toc-number">3.2.10.3.</span> <span class="toc-text">Struct 类型访问 S.x</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E9%95%BF%E5%BA%A6%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.11.</span> <span class="toc-text">复杂类型长度统计函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Map-%E7%B1%BB%E5%9E%8B%E9%95%BF%E5%BA%A6%E5%87%BD%E6%95%B0-size-Map"><span class="toc-number">3.2.11.1.</span> <span class="toc-text">Map 类型长度函数 size(Map)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Array-%E7%B1%BB%E5%9E%8B%E9%95%BF%E5%BA%A6%E5%87%BD%E6%95%B0-size-Array"><span class="toc-number">3.2.11.2.</span> <span class="toc-text">Array 类型长度函数 size(Array)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0%EF%BC%9Acast"><span class="toc-number">3.2.11.3.</span> <span class="toc-text">类型转换函数：cast</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97%E5%8F%8A%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">3.3.</span> <span class="toc-text">行转列及列转行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-explode-%E5%87%BD%E6%95%B0%E5%B0%86-Hive-%E8%A1%A8%E4%B8%AD%E7%9A%84-Map-%E5%92%8C-Array-%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%8B%86%E5%88%86"><span class="toc-number">3.3.1.</span> <span class="toc-text">使用 explode 函数将 Hive 表中的 Map 和 Array 字段数据进行拆分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-explode-%E6%8B%86%E5%88%86-json-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.3.2.</span> <span class="toc-text">使用 explode 拆分 json 字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E5%90%88-LATERAL-VIEW-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.3.</span> <span class="toc-text">配合 LATERAL VIEW 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="toc-number">3.3.4.</span> <span class="toc-text">行转列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">3.3.5.</span> <span class="toc-text">列转行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REFLECT-%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.6.</span> <span class="toc-text">REFLECT 函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E4%B8%8E%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">窗口函数与分析函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sum%E3%80%81avg%E3%80%81min%E3%80%81max"><span class="toc-number">3.4.1.</span> <span class="toc-text">sum、avg、min、max</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SUM"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">SUM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AVG"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">AVG</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MIN"><span class="toc-number">3.4.1.3.</span> <span class="toc-text">MIN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MAX"><span class="toc-number">3.4.1.4.</span> <span class="toc-text">MAX</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#row-number%E3%80%81rank%E3%80%81dense-rank%E3%80%81ntile"><span class="toc-number">3.4.2.</span> <span class="toc-text">row_number、rank、dense_rank、ntile</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ROW-NUMBER-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">ROW_NUMBER() 使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RANK-%E5%92%8C-DENSE-RANK-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">RANK 和 DENSE_RANK 使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NTILE"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">NTILE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.</span> <span class="toc-text">其他一些窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lag-lead-first-value-last-value"><span class="toc-number">3.5.1.</span> <span class="toc-text">lag, lead, first_value, last_value</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LAG"><span class="toc-number">3.5.1.1.</span> <span class="toc-text">LAG</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LEAD"><span class="toc-number">3.5.1.2.</span> <span class="toc-text">LEAD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FIRST-VALUE"><span class="toc-number">3.5.1.3.</span> <span class="toc-text">FIRST_VALUE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LAST-VALUE"><span class="toc-number">3.5.1.4.</span> <span class="toc-text">LAST_VALUE</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cume-dist-percent-rank"><span class="toc-number">3.5.2.</span> <span class="toc-text">cume_dist, percent_rank</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CUME-DIST"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">CUME_DIST</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PERCENT-RANK"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">PERCENT_RANK</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grouping-sets-cube-rollup"><span class="toc-number">3.5.3.</span> <span class="toc-text">grouping sets, cube, rollup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#GROUPING-SETS"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">GROUPING SETS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CUBE"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">CUBE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ROLLUP"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">ROLLUP</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/b0188c87.html" title="ECharts 帕累托图"><img src="/images/cover/echarts_pareto.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="ECharts 帕累托图"></a><div class="content"><a class="title" href="/post/b0188c87.html" title="ECharts 帕累托图">ECharts 帕累托图</a><time datetime="2023-05-30T01:00:00.000Z" title="发表于 2023-05-30 09:00:00">2023-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/620d6870.html" title="ECharts 子弹图"><img src="/images/cover/echarts_bullet.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="ECharts 子弹图"></a><div class="content"><a class="title" href="/post/620d6870.html" title="ECharts 子弹图">ECharts 子弹图</a><time datetime="2023-04-27T01:00:00.000Z" title="发表于 2023-04-27 09:00:00">2023-04-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/22774ddc.html" title="ECharts 径向条形图"><img src="/images/cover/echarts_radial_bar.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="ECharts 径向条形图"></a><div class="content"><a class="title" href="/post/22774ddc.html" title="ECharts 径向条形图">ECharts 径向条形图</a><time datetime="2023-04-26T01:00:00.000Z" title="发表于 2023-04-26 09:00:00">2023-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/68739172.html" title="ECharts 渐变折线图"><img src="/images/cover/echarts_line_gradient.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="ECharts 渐变折线图"></a><div class="content"><a class="title" href="/post/68739172.html" title="ECharts 渐变折线图">ECharts 渐变折线图</a><time datetime="2023-03-12T01:00:00.000Z" title="发表于 2023-03-12 09:00:00">2023-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/1c85bfc3.html" title="数仓设计与 ETL 规范"><img src="/images/cover/etl_norm.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="数仓设计与 ETL 规范"></a><div class="content"><a class="title" href="/post/1c85bfc3.html" title="数仓设计与 ETL 规范">数仓设计与 ETL 规范</a><time datetime="2022-12-31T02:00:00.000Z" title="发表于 2022-12-31 10:00:00">2022-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/553238e8.html" title="ECharts 生涯彩虹图"><img src="/images/cover/echarts_career.png" onerror='this.onerror=null,this.src="https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/404.jpg"' alt="ECharts 生涯彩虹图"></a><div class="content"><a class="title" href="/post/553238e8.html" title="ECharts 生涯彩虹图">ECharts 生涯彩虹图</a><time datetime="2022-11-06T01:00:00.000Z" title="发表于 2022-11-06 09:00:00">2022-11-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-group-container"><div class="footer-group"><span class="footer-group-title">统计</span><a class="footer-group-item" href="/charts/">文章统计</a><a class="footer-group-item" href="/census/">博客统计</a></div><div class="footer-group"><span class="footer-group-title">导航</span><a class="footer-group-item" href="/link/#我的友链-amp-友链格式">申请友链</a><a class="footer-group-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Eurkon/hexo-theme-butterfly-eurkon">魔改源码</a><a class="footer-group-item" href="/stars/">网站收藏</a><a class="footer-group-item" href="javascript:toRandomPost();" rel="external nofollow noreferrer">随机文章</a></div><div class="footer-group"><span class="footer-group-title">分类</span><a class="footer-group-item" href="/categories/学习笔记/">学习笔记</a><a class="footer-group-item" href="/categories/魔改教程/">魔改教程</a><a class="footer-group-item" href="/categories/分享转载/">分享转载</a><a class="footer-group-item" href="/categories/作品案例/">作品案例</a></div><div class="footer-group"><span class="footer-group-title">关于</span><a class="footer-group-item" href="/notice/">网站公告</a><a class="footer-group-item" href="/update/">博客更新</a><a class="footer-group-item" href="/message/">给我留言</a><a class="footer-group-item" href="mailto:eurkon@foxmail.com" rel="external nofollow noreferrer">联系博主</a></div><div class="footer-group"><span class="footer-group-title">服务</span><a class="footer-group-item" href="/fcircle/">友链订阅</a><a class="footer-group-item" href="/rss.xml">RSS 订阅</a><a class="footer-group-item" href="/atom.xml">Atom 订阅</a><a class="footer-group-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://bf.zzxworld.com/s/686">BlogFinder</a></div><div class="footer-group" id="footer-group-flink"><span class="footer-group-title">友链<i class="fas fa-sync" title="随机友链" onclick="eurkon.footerRandomFlink(flinks,3)"></i></span><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="" target="_blank" rel="noopener external nofollow noreferrer">加载中...</a><a class="footer-group-item" href="/link/">更多友链</a></div><div class="footer-group"><span class="footer-group-title">协议</span><a class="footer-group-item" href="/protocol/comment/" title="用户发言前，请认真阅读本条例。一经发言，即视为同意接受本条例；如不同意，请勿发言。">评论协议</a><a class="footer-group-item" href="/protocol/copyright/" title="本站所有原创文章采用知识共享(Creative Commons)署名—非商业性使用—相同方式共享4.0国际公共许可协议">版权协议</a></div></div><div id="footer-banner"><div id="footer-banner-container"><div class="footer-banner"><div class="copyright">Copyright &copy; 2021 - 2024 Eurkon.com All Rights Reserved.</div></div><div class="footer-banner"><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><div class="footer-banner"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn">粤ICP备2022108639号</a><a href="/protocol/copyright/" title="版权协议"><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i><i class="fab fa-creative-commons-nc"></i><i class="fab fa-creative-commons-sa"></i></a></div></div></div></div></footer></div><div class="hidden" id="rightside-mask" onclick="eurkon.switchRightSide()"></div><div class="hidden" id="rightside"><div id="rightside-header"><div id="rightside-back"><i class="fas fa-chevron-left" onclick="eurkon.backRightSide()"></i></div><div id="rightside-title">设置</div><div id="rightside-close" onclick="eurkon.switchRightSide()"><i class="fas fa-xmark"></i></div></div><div id="rightside-content"><div id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>最新评论</span></div><div class="aside-list"><span>加载中...</span></div></div><div id="card-post-content"><div class="card-widget card-categories"><div class="item-headline"><i class="fas fa-folder-open"></i> <span>分类</span></div><ul class="card-category-list" id="aside-cat-list"><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E4%BD%9C%E5%93%81%E6%A1%88%E4%BE%8B/"><span class="card-category-list-name">🖥️作品案例</span><span class="card-category-list-count">23</span></a></li><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E5%88%86%E4%BA%AB%E8%BD%AC%E8%BD%BD/"><span class="card-category-list-name">🌐分享转载</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="card-category-list-name">📚学习笔记</span><span class="card-category-list-count">24</span></a></li><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/"><span class="card-category-list-name">💬生活随笔</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E7%B3%BB%E5%88%97/"><span class="card-category-list-name">📝面试系列</span><span class="card-category-list-count">21</span></a></li><li class="card-category-list-item"><a class="card-category-list-link" href="/categories/%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B/"><span class="card-category-list-name">🎨魔改教程</span><span class="card-category-list-count">16</span></a></li></ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Spark/" style="font-size:1.18em;color:#999ca1">Spark</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:1.1em;color:#999">算法</a> <a href="/tags/Hadoop/" style="font-size:1.18em;color:#999ca1">Hadoop</a> <a href="/tags/Sqoop/" style="font-size:1.14em;color:#999b9d">Sqoop</a> <a href="/tags/Java/" style="font-size:1.38em;color:#99a4b4">Java</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" style="font-size:1.3em;color:#99a1ac">数据分析</a> <a href="/tags/Zookeeper/" style="font-size:1.14em;color:#999b9d">Zookeeper</a> <a href="/tags/ECharts/" style="font-size:1.5em;color:#99a9bf">ECharts</a> <a href="/tags/Flume/" style="font-size:1.14em;color:#999b9d">Flume</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size:1.46em;color:#99a7bb">大数据</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/" style="font-size:1.1em;color:#999">生活随笔</a> <a href="/tags/HBase/" style="font-size:1.14em;color:#999b9d">HBase</a> <a href="/tags/Kafka/" style="font-size:1.14em;color:#999b9d">Kafka</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size:1.1em;color:#999">数据仓库</a> <a href="/tags/JavaScript/" style="font-size:1.1em;color:#999">JavaScript</a> <a href="/tags/Python/" style="font-size:1.1em;color:#999">Python</a> <a href="/tags/Butterfly/" style="font-size:1.34em;color:#99a3b0">Butterfly</a> <a href="/tags/Hive/" style="font-size:1.18em;color:#999ca1">Hive</a> <a href="/tags/R/" style="font-size:1.22em;color:#999ea4">R</a> <a href="/tags/MySQL/" style="font-size:1.26em;color:#999fa8">MySQL</a> <a href="/tags/Linux/" style="font-size:1.1em;color:#999">Linux</a> <a href="/tags/Markdown/" style="font-size:1.1em;color:#999">Markdown</a> <a href="/tags/HTML/" style="font-size:1.1em;color:#999">HTML</a> <a href="/tags/Elasticsearch/" style="font-size:1.1em;color:#999">Elasticsearch</a> <a href="/tags/%E6%96%87%E6%A1%A3/" style="font-size:1.26em;color:#999fa8">文档</a> <a href="/tags/Hexo/" style="font-size:1.42em;color:#99a6b7">Hexo</a> <a href="/tags/PostgreSQL/" style="font-size:1.3em;color:#99a1ac">PostgreSQL</a> <a href="/tags/Git/" style="font-size:1.1em;color:#999">Git</a></div></div></div></div><div id="rightside-config-hide"><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-sun"></i><i class="fas fa-moon"></i></button><button id="barrage-btn" type="button" title="热评开关" onclick="eurkon.switchCommentBarrage()"><i class="fas fa-message"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightmenu"><div class="rightmenu-group rightmenu-small"><div class="rightmenu-item" id="menu-backward" onclick="window.history.back()"><i class="fas fa-arrow-left"></i></div><div class="rightmenu-item" id="menu-forward" onclick="window.history.forward()"><i class="fas fa-arrow-right"></i></div><div class="rightmenu-item" id="menu-refresh" onclick="location.reload()"><i class="fas fa-arrow-rotate-right"></i></div><div class="rightmenu-item" id="menu-top" onclick="btf.scrollToDest(0,500)"><i class="fas fa-arrow-up"></i></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-text"><div class="rightmenu-item" id="menu-copy"><i class="fas fa-copy"></i><span>复制内容</span></div><div class="rightmenu-item" id="menu-comment"><i class="fas fa-comment"></i><span>引用评论</span></div><div class="rightmenu-item" id="menu-paste"><i class="fas fa-paste"></i><span>粘贴文本</span></div><div class="rightmenu-item" id="menu-search"><i class="fas fa-search"></i><span>在本站搜索</span></div><div class="rightmenu-item" id="menu-baidu"><i class="fas fa-search-plus"></i><span>去百度搜索</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-href"><div class="rightmenu-item" id="menu-copy-image"><i class="fas fa-copy"></i><span>复制图片</span></div><div class="rightmenu-item" id="menu-download-image"><i class="fas fa-download"></i><span>下载图片</span></div><div class="rightmenu-item" id="menu-link"><i class="fas fa-share"></i><span>分享链接</span></div><div class="rightmenu-item" id="menu-window"><i class="fas fa-window-restore"></i><span>新窗口打开</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-post"><a class="rightmenu-item" id="menu-random" href="/random/"><i class="fas fa-random"></i><span>随机文章</span></a><a class="rightmenu-item" id="menu-categories" href="/categories/"><i class="fas fa-shapes"></i><span>全部分类</span></a><a class="rightmenu-item" id="menu-tags" href="/tags/"><i class="fas fa-tags"></i><span>所有标签</span></a><div class="rightmenu-item" id="menu-share"><i class="fas fa-share-square"></i><span>分享本页</span></div></div><div class="rightmenu-group rightmenu-line" id="rightmenu-site"><a class="rightmenu-item" id="menu-message" href="/message/"><i class="fas fa-envelope"></i><span>留言信箱</span></a><a class="rightmenu-item" id="menu-about" href="/about/"><i class="fas fa-address-card"></i><span>关于本站</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js?v=5.1.0"></script><script src="/js/main.js?v=5.1.0"></script><script src="/js/eurkon/color-thief.min.js"></script><script defer src="/js/eurkon/eurkon.js"></script><script defer data-pjax src="/js/eurkon/refresh.js"></script><script src="/js/tw_cn.js?v=5.1.0"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.3.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.eurkon.com/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.eurkon.com/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
        setTimeout(function(){
          let tk_comment = document.querySelectorAll('.tk-comments-container .tk-comment')
          if (tk_comment.length > 0) {
            let html = `<div class="swiper-wrapper">`
            for (let i = 0; i < tk_comment.length; i++) {
              let tk_id = tk_comment[i].getAttribute('id') || ''
              let tk_nick = tk_comment[i].querySelector('.tk-nick')?.innerText || ''
              let tk_href = tk_comment[i].querySelector('.tk-nick')?.href || ''
              let tk_avatar = tk_comment[i].querySelector('.tk-avatar-img')?.src || ''
              let tk_time = tk_comment[i].querySelector('.tk-time')?.innerText || ''
              let tk_city = tk_comment[i].querySelector('.tk-extras .tk-extra:first-child span:last-child')?.innerText || ''
              let tk_content = tk_comment[i].querySelector('.tk-content>span:last-child')?.innerHTML || ''
              tk_content = tk_content.replace(/\n/g, '') // replace \n
              tk_content = tk_content.replace(/<blockquote>.*?<\/blockquote>/gi, '') // replace blockquote
              //- tk_content = tk_content.replace(/<a[^>]+?data-caption="image".*?<img.*?src="(.*?)"?[^\>]+><\/a>/ig, '[图片]') // replace image link
              //- tk_content = tk_content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
              //- tk_content = tk_content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
              tk_content = tk_content.replace(/<pre.*?<\/pre>/gi, '[代码]') // replace code
              //- tk_content = tk_content.replace(/<[^>]+>/g, "") // remove html tag
              html += `
                <div class="swiper-slide">
                  <div class="comment-barrage-item">
                    <div class="barrage-info">
                      <a class="barrage-title" title="跳转至评论区" href="#post-comment">热评</a>
                      <a href="${tk_href ? tk_href + '" target="_blank" rel="noopener noreferrer" title="访问 '+ tk_nick +'"' : 'javascript:void(0);"'}>
                        <img class="barrage-avatar" src="${tk_avatar}">
                      </a>
                      <span class="barrage-nick">${tk_nick}</span>
                      <span class="barrage-city">${tk_city}</span>
                      <span class="barrage-time">${tk_time}</span>
                      <a class="barrage-close" onclick="eurkon.switchCommentBarrage()" title="隐藏热评"><i class="fa-solid fa-xmark"></i></a>
                    </div>
                    <div class="barrage-content">
                      <a title="跳转至该评论" href="#${tk_id}">${tk_content}</a>
                    </div>
                  </div>
                </div>`
            }
            html += '</div>'
            let barrageContainer = document.getElementById('comment-barrage') || document.createElement('div')
            barrageContainer.id = 'comment-barrage'
            barrageContainer.innerHTML = html
            barrageContainer.style.bottom = window.localStorage.getItem('commentBarrageDisplay') === 'false' ? '-1000px' : '1rem'
            if( document.getElementById('barrage-btn') ) document.getElementById('barrage-btn').classList.add(window.localStorage.getItem('commentBarrageDisplay') === 'false' ? 'off' : 'on')
            document.getElementById('post-comment').appendChild(barrageContainer)
            var barrageSwiper = new Swiper('#comment-barrage', {
              direction: 'vertical',
              loop: true,
              mousewheel: true,
              autoplay: {
                delay: 3000,
                disableOnInteraction: true,
              }
            })
            barrageContainer.onmouseenter = function () {
              barrageSwiper.autoplay.stop()
            };
            barrageContainer.onmouseleave = function () {
              barrageSwiper.autoplay.start()
            };
          }
        }, 1000)
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[代码]') // replace code      
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'data-lazy-src'
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}"></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '暂无评论'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'twikoo-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const getComment = ele => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.eurkon.com/',
        region: '',
        pageSize: 8,
        includeReply: true
      }).then(res => {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        btf.saveToLocal.set(keyName, JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray, ele)
      }).catch(err => {
        console.error(err)
        ele.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  run(keyName, getComment)
})</script><script defer async src="//at.alicdn.com/t/font_2358265_expoyqe85d4.js"></script><script defer src="/js/custom.js"></script><script defer data-pjax src="/js/refresh.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.1.0"></script></div></div></body></html><script>var posts=[{title:"ECharts 同X轴多Y轴图表",path:"/post/acc26f11.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_multi_chart.png",date:"2021-08-30T01:00:00.000Z",updated:"2021-08-30T01:00:00.000Z"},{title:"ECharts 地图上显示柱状图",path:"/post/5a6784e7.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_map_bar.png",date:"2021-11-10T01:00:00.000Z",updated:"2021-11-10T01:00:00.000Z"},{title:"ECharts 地图上显示饼图",path:"/post/d8b77f28.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_map_pie.png",date:"2021-11-01T01:00:00.000Z",updated:"2021-11-01T01:00:00.000Z"},{title:"ECharts 子弹图",path:"/post/620d6870.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_bullet.png",date:"2023-04-27T01:00:00.000Z",updated:"2023-04-27T01:00:00.000Z"},{title:"ECharts 对比漏斗图",path:"/post/ee94ffd8.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_funnel.png",date:"2022-06-10T01:00:00.000Z",updated:"2022-06-10T01:00:00.000Z"},{title:"ECharts 帕累托图",path:"/post/b0188c87.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_pareto.png",date:"2023-05-30T01:00:00.000Z",updated:"2023-05-30T01:00:00.000Z"},{title:"ECharts 弹窗悬浮图表",path:"/post/8050767e.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_tooltip_chart.png",date:"2021-08-15T01:00:00.000Z",updated:"2021-08-15T01:00:00.000Z"},{title:"ECharts 径向条形图",path:"/post/22774ddc.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_radial_bar.png",date:"2023-04-26T01:00:00.000Z",updated:"2023-04-26T01:00:00.000Z"},{title:"ECharts 散点地图",path:"/post/e3dd705b.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_scatter_map.png",date:"2021-09-01T01:00:00.000Z",updated:"2021-09-01T01:00:00.000Z"},{title:"ECharts 日期旭日图",path:"/post/9bcf49c7.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_date_sunburst.png",date:"2022-06-21T01:00:00.000Z",updated:"2022-06-21T01:00:00.000Z"},{title:"ECharts 时序图",path:"/post/b9e0457b.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_timeline.png",date:"2021-08-01T01:00:00.000Z",updated:"2021-08-01T01:00:00.000Z"},{title:"ECharts 时间极坐标",path:"/post/97890f7.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_time_polar.png",date:"2022-07-05T01:00:00.000Z",updated:"2022-07-05T01:00:00.000Z"},{title:"ECharts 标签地图",path:"/post/19a77adb.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_label_map.png",date:"2021-10-01T01:00:00.000Z",updated:"2021-10-01T01:00:00.000Z"},{title:"ECharts 水球图",path:"/post/51a3160b.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_liquidfill.png",date:"2022-05-16T01:00:00.000Z",updated:"2022-05-16T01:00:00.000Z"},{title:"ECharts 流程图",path:"/post/b7fd4932.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_flowchart.png",date:"2022-05-05T01:00:00.000Z",updated:"2022-05-05T01:00:00.000Z"},{title:"ECharts 渐变折线图",path:"/post/68739172.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_line_gradient.png",date:"2023-03-12T01:00:00.000Z",updated:"2023-03-12T01:00:00.000Z"},{title:"ECharts 热力地图",path:"/post/85c31989.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_heat_map.png",date:"2021-09-15T01:00:00.000Z",updated:"2021-09-15T01:00:00.000Z"},{title:"ECharts 词云图",path:"/post/f6f4d480.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_word_cloud.png",date:"2022-05-13T01:00:00.000Z",updated:"2022-05-13T01:00:00.000Z"},{title:"ECharts 迁徙地图",path:"/post/165ef0d3.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_migration_map.png",date:"2021-10-15T01:00:00.000Z",updated:"2021-10-15T01:00:00.000Z"},{title:"Python 自建 API 合集",path:"/post/ee499a0b.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"Python",path:"/tags/Python/"}],cover:"/images/cover/python_api.jpg",date:"2021-06-07T01:00:00.000Z",updated:"2021-03-08T01:00:00.000Z"},{title:"AARRR 用户运营分析",path:"/post/fa6d499a.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/aarrr_analysis.png",date:"2022-03-15T02:00:00.000Z",updated:"2022-03-15T02:00:00.000Z"},{title:"ABC 分类法",path:"/post/3e7451d9.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/abc.png",date:"2022-01-15T02:00:00.000Z",updated:"2022-01-15T02:00:00.000Z"},{title:"HDFS Shell 命令",path:"/post/d1e7dfd3.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Hadoop",path:"/tags/Hadoop/"}],cover:"/images/cover/hdfs_shell.jpg",date:"2021-03-05T02:31:14.000Z",updated:"2021-03-05T02:31:14.000Z"},{title:"JavaScript 实用技巧",path:"/post/ea69450.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"JavaScript",path:"/tags/JavaScript/"}],cover:"/images/cover/js_skill.png",date:"2021-12-25T02:00:00.000Z",updated:"2021-12-25T02:00:00.000Z"},{title:"RFM 客户分析模型",path:"/post/97f6661d.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/rfm.png",date:"2022-01-01T02:00:00.000Z",updated:"2022-01-01T02:00:00.000Z"},{title:"库存周转分析",path:"/post/e305ad56.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/inventory_turnover_analysis.png",date:"2022-04-01T02:00:00.000Z",updated:"2022-04-01T02:00:00.000Z"},{title:"波士顿矩阵",path:"/post/dd96e05f.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/bcg_matrix.png",date:"2022-02-01T02:00:00.000Z",updated:"2022-02-01T02:00:00.000Z"},{title:"电商转化漏斗模型",path:"/post/72736a6d.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/e-commerce_conversion.png",date:"2022-02-15T02:00:00.000Z",updated:"2022-02-15T02:00:00.000Z"},{title:"购物篮分析",path:"/post/931f21f9.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"数据分析",path:"/tags/数据分析/"},{name:"PostgreSQL",path:"/tags/PostgreSQL/"}],cover:"/images/cover/basket_analysis.png",date:"2022-03-01T02:00:00.000Z",updated:"2022-03-01T02:00:00.000Z"},{title:"26 个字母 26 句话",path:"/post/32c40e7c.html",categories:[{name:"生活随笔",path:"/categories/生活随笔/"}],tags:[{name:"生活随笔",path:"/tags/生活随笔/"}],cover:"/images/cover/letter_proverb.png",date:"2021-02-12T00:00:00.000Z",updated:"2021-02-12T00:00:00.000Z"},{title:"HTML 特殊符号编码对照表",path:"/post/65795b97.html",categories:[{name:"分享转载",path:"/categories/分享转载/"}],tags:[{name:"HTML",path:"/tags/HTML/"},{name:"文档",path:"/tags/文档/"}],cover:"/images/cover/html_symbols.jpg",date:"2021-03-12T07:54:12.000Z",updated:"2021-03-12T07:54:12.000Z"},{title:"特殊符号",path:"/post/73bb9016.html",categories:[{name:"分享转载",path:"/categories/分享转载/"}],tags:[{name:"文档",path:"/tags/文档/"}],cover:"/images/cover/special_symbols.jpg",date:"2021-03-10T02:23:12.000Z",updated:"2021-03-10T02:23:12.000Z"},{title:"Flume 面试题解析",path:"/post/5a2a12a6.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Flume",path:"/tags/Flume/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-29T01:00:00.000Z",updated:"2021-03-29T01:00:00.000Z"},{title:"Java 面试题解析",path:"/post/d2aef718.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-15T01:00:00.000Z",updated:"2021-03-15T01:00:00.000Z"},{title:"Java 面试题解析（IO流）",path:"/post/af128a42.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-19T01:00:00.000Z",updated:"2021-03-19T01:00:00.000Z"},{title:"Java 面试题解析（反射）",path:"/post/9fbf7373.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-21T01:00:00.000Z",updated:"2021-03-21T01:00:00.000Z"},{title:"Java 面试题解析（容器）",path:"/post/d07acd09.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-17T01:00:00.000Z",updated:"2021-03-17T01:00:00.000Z"},{title:"Sqoop 面试题解析",path:"/post/420614eb.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Sqoop",path:"/tags/Sqoop/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-04-13T01:00:00.000Z",updated:"2021-04-13T01:00:00.000Z"},{title:"Zookeeper 面试题解析",path:"/post/2f1ea7f2.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Zookeeper",path:"/tags/Zookeeper/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-27T01:00:00.000Z",updated:"2021-03-27T01:00:00.000Z"},{title:"大数据面试题解析",path:"/post/7e24cf66.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Hadoop",path:"/tags/Hadoop/"},{name:"Flume",path:"/tags/Flume/"},{name:"Sqoop",path:"/tags/Sqoop/"},{name:"Zookeeper",path:"/tags/Zookeeper/"},{name:"Kafka",path:"/tags/Kafka/"},{name:"Hive",path:"/tags/Hive/"},{name:"HBase",path:"/tags/HBase/"},{name:"MySQL",path:"/tags/MySQL/"},{name:"Spark",path:"/tags/Spark/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-25T01:00:00.000Z",updated:"2021-03-25T01:00:00.000Z"},{title:"Butterffly 分类页和标签页隐藏侧栏",path:"/post/d498d8b1.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_hide_side.png",date:"2022-07-20T01:00:00.000Z",updated:"2022-08-04T01:00:00.000Z"},{title:"Butterfly Twikoo 评论热评",path:"/post/364efc10.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/twikoo_comment_barrage.png",date:"2022-09-13T01:00:00.000Z",updated:"2022-09-13T01:00:00.000Z"},{title:"Butterfly 分类标签导航栏",path:"/post/65b72006.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/post/butterfly/butterfly_categories_list.png",date:"2022-05-23T02:00:00.000Z",updated:"2023-03-21T02:00:00.000Z"},{title:"Butterfly 分类标签归档页增加文章索引",path:"/post/27df86b.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_post_index_eurkon.png",date:"2022-07-28T01:00:00.000Z",updated:"2022-07-28T01:00:00.000Z"},{title:"Butterfly 微博热搜侧边栏",path:"/post/38b005e1.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_weibo.jpg",date:"2021-06-03T01:00:00.000Z",updated:"2023-03-20T01:00:00.000Z"},{title:"Butterfly 推荐文章增加文章描述",path:"/post/3d2664bb.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_related_post.png",date:"2022-08-16T02:00:00.000Z",updated:"2022-08-16T02:00:00.000Z"},{title:"Butterfly 文章增加段落序号",path:"/post/70e521c2.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_toc_number.png",date:"2022-10-31T01:00:00.000Z",updated:"2022-10-31T01:00:00.000Z"},{title:"Butterfly 标签云增加文章数上下标",path:"/post/6687849c.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/butterfly_tags_cloud.png",date:"2021-07-15T01:00:00.000Z",updated:"2021-07-15T01:00:00.000Z"},{title:"Front-matter",path:"/post/31e4c77c.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"},{name:"Butterfly",path:"/tags/Butterfly/"}],cover:"/images/cover/hexo.png",date:"2021-01-02T13:59:56.000Z",updated:"2021-01-02T13:59:56.000Z"},{title:"Hello Hexo",path:"/post/a1751c09.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo.png",date:"2021-01-01T00:00:00.000Z",updated:"2021-01-01T00:00:00.000Z"},{title:"在 Hexo 中插入 Chart 动态图表",path:"/post/a6e75a2b.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo_chartjs.svg",date:"2021-01-04T01:38:32.000Z",updated:"2021-01-04T01:38:32.000Z"},{title:"ECharts 地图上显示折线图",path:"/post/e83030eb.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_map_line.png",date:"2021-11-20T01:00:00.000Z",updated:"2021-11-20T01:00:00.000Z"},{title:"ECharts 生涯彩虹图",path:"/post/553238e8.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_career.png",date:"2022-11-06T01:00:00.000Z",updated:"2022-11-06T01:00:00.000Z"},{title:"Git 使用教程",path:"/post/c3cf24c7.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"Git",path:"/tags/Git/"}],cover:"/images/cover/git.png",date:"2021-02-21T05:16:02.000Z",updated:"2021-02-21T05:16:02.000Z"},{title:"Linux 常用命令",path:"/post/817c7d82.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"Linux",path:"/tags/Linux/"}],cover:"/images/cover/linux_command.png",date:"2021-04-19T01:00:00.000Z",updated:"2021-04-19T01:00:00.000Z"},{title:"Markdown 基本语法",path:"/post/c894e39a.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"Markdown",path:"/tags/Markdown/"}],cover:"/images/cover/markdown_grammar.jpg",date:"2021-01-03T06:14:53.000Z",updated:"2021-01-03T06:14:53.000Z"},{title:"MySQL 优化",path:"/post/d7961cf0.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"MySQL",path:"/tags/MySQL/"}],cover:"/images/cover/mysql_optimization.jpg",date:"2021-01-14T05:32:11.000Z",updated:"2021-01-14T05:32:11.000Z"},{title:"MySQL 常用命令行",path:"/post/4bd4f98e.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"MySQL",path:"/tags/MySQL/"}],cover:"/images/cover/mysql_command.png",date:"2021-01-13T01:24:44.000Z",updated:"2021-01-13T01:24:44.000Z"},{title:"R 语言图表",path:"/post/b35ac98a.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"R",path:"/tags/R/"}],cover:"/images/cover/r_chart.jpg",date:"2021-01-20T08:04:45.000Z",updated:"2021-01-20T08:04:45.000Z"},{title:"排序算法",path:"/post/735e5788.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"算法",path:"/tags/算法/"}],cover:"/images/cover/sort_algorithm.jpg",date:"2021-03-13T05:16:02.000Z",updated:"2021-03-13T05:16:02.000Z"},{title:"数仓设计与 ETL 规范",path:"/post/1c85bfc3.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"文档",path:"/tags/文档/"},{name:"数据仓库",path:"/tags/数据仓库/"}],cover:"/images/cover/etl_norm.png",date:"2022-12-31T02:00:00.000Z",updated:"2022-12-31T02:00:00.000Z"},{title:"Elasticsearch 面试题解析",path:"/post/fae3ec89.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Elasticsearch",path:"/tags/Elasticsearch/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-06-25T01:00:00.000Z",updated:"2021-06-25T01:00:00.000Z"},{title:"HBase 面试题解析",path:"/post/47457d03.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"HBase",path:"/tags/HBase/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-04-02T01:00:00.000Z",updated:"2021-04-02T01:00:00.000Z"},{title:"Hive 面试题解析",path:"/post/62c9bbde.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Hive",path:"/tags/Hive/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-31T01:00:00.000Z",updated:"2021-03-31T01:00:00.000Z"},{title:"Java 面试题解析（并发）",path:"/post/32cf50db.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-18T01:00:00.000Z",updated:"2021-03-18T01:00:00.000Z"},{title:"Java 面试题解析（数据库）",path:"/post/73adfcb0.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-20T01:00:00.000Z",updated:"2021-03-20T01:00:00.000Z"},{title:"Java 面试题解析（设计模式）",path:"/post/1cfbd3b3.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-21T04:00:00.000Z",updated:"2021-03-21T04:00:00.000Z"},{title:"Kafka 面试题解析",path:"/post/89cabcb1.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Kafka",path:"/tags/Kafka/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-30T01:00:00.000Z",updated:"2021-03-30T01:00:00.000Z"},{title:"Hexo 博客实时访问统计图",path:"/post/61763977.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"},{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo.png",date:"2021-05-17T01:00:00.000Z",updated:"2022-03-29T01:00:00.000Z"},{title:"Hexo 博客访问日历图",path:"/post/1a169b5a.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo.png",date:"2021-05-17T04:00:00.000Z",updated:"2022-03-29T04:00:00.000Z"},{title:"Hexo 博客访问统计图（弃用）",path:"/post/ef1da941.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"},{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo.png",date:"2021-04-01T04:00:00.000Z",updated:"2022-03-29T01:00:00.000Z"},{title:"在 Hexo 中插入 ECharts 动态图表",path:"/post/6f565d8c.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"},{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo_echarts.png",date:"2021-01-05T03:51:01.000Z",updated:"2021-01-05T03:51:01.000Z"},{title:"ECharts 流域图",path:"/post/364f4c67.html",categories:[{name:"作品案例",path:"/categories/作品案例/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"}],cover:"/images/cover/echarts_river.png",date:"2022-05-10T01:00:00.000Z",updated:"2022-05-10T01:00:00.000Z"},{title:"R 语言数据接口",path:"/post/996a1090.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"R",path:"/tags/R/"}],cover:"/images/cover/r_data_interface.png",date:"2021-01-21T05:52:32.000Z",updated:"2021-01-21T05:52:32.000Z"},{title:"R 语言统计分析",path:"/post/741c153c.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"R",path:"/tags/R/"}],cover:"/images/cover/r_statistics.jpg",date:"2021-01-22T02:10:41.000Z",updated:"2021-01-22T02:10:41.000Z"},{title:"Emoji 表情大全",path:"/post/f349e1f0.html",categories:[{name:"分享转载",path:"/categories/分享转载/"}],tags:[{name:"文档",path:"/tags/文档/"}],cover:"/images/cover/emoji.png",date:"2021-06-22T01:00:00.000Z",updated:"2021-06-22T01:00:00.000Z"},{title:"Hadoop 面试题解析",path:"/post/2b822834.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Hadoop",path:"/tags/Hadoop/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-03-26T01:00:00.000Z",updated:"2021-03-26T01:00:00.000Z"},{title:"MySQL 面试题解析",path:"/post/54dbb40b.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"MySQL",path:"/tags/MySQL/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-04-14T01:00:00.000Z",updated:"2021-04-14T01:00:00.000Z"},{title:"Hexo 博客文章统计图",path:"/post/1213ef82.html",categories:[{name:"魔改教程",path:"/categories/魔改教程/"}],tags:[{name:"ECharts",path:"/tags/ECharts/"},{name:"Hexo",path:"/tags/Hexo/"}],cover:"/images/cover/hexo.png",date:"2021-04-01T01:00:00.000Z",updated:"2022-08-15T01:00:00.000Z"},{title:"Spark RDD 常用算子",path:"/post/c55e5115.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Spark",path:"/tags/Spark/"}],cover:"/images/cover/spark_rdd.jpg",date:"2021-05-07T01:00:00.000Z",updated:"2021-05-07T01:00:00.000Z"},{title:"Java 面试题解析（Java Web）",path:"/post/d24a315e.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-22T01:00:00.000Z",updated:"2021-03-22T01:00:00.000Z"},{title:"Java 面试题解析（基础）",path:"/post/11ea51ea.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-16T01:00:00.000Z",updated:"2021-03-16T01:00:00.000Z"},{title:"Spark 面试题解析",path:"/post/cccf27af.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Spark",path:"/tags/Spark/"}],cover:"/images/cover/bigdata_interview.png",date:"2021-05-26T01:00:00.000Z",updated:"2021-05-26T01:00:00.000Z"},{title:"R 语言教程",path:"/post/de0e67e.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"R",path:"/tags/R/"}],cover:"/images/cover/r_course.png",date:"2021-01-18T08:20:11.000Z",updated:"2021-01-18T08:20:11.000Z"},{title:"Hive SQL 大全",path:"/post/7891b2e6.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"Hive",path:"/tags/Hive/"}],cover:"/images/cover/hive.jpg",date:"2021-04-07T01:00:00.000Z",updated:"2021-04-07T01:00:00.000Z"},{title:"大数据精选清单",path:"/post/fc3d946f.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"文档",path:"/tags/文档/"}],cover:"/images/cover/bigdata_list.jpg",date:"2021-01-07T02:35:46.000Z",updated:"2021-01-07T02:35:46.000Z"},{title:"Java 面试题解析（Java EE）",path:"/post/dc04fa32.html",categories:[{name:"面试系列",path:"/categories/面试系列/"}],tags:[{name:"Java",path:"/tags/Java/"}],cover:"/images/cover/java_interview.jpg",date:"2021-03-23T01:00:00.000Z",updated:"2021-03-23T01:00:00.000Z"},{title:"MySQL 教程",path:"/post/7f59cefa.html",categories:[{name:"学习笔记",path:"/categories/学习笔记/"}],tags:[{name:"大数据",path:"/tags/大数据/"},{name:"MySQL",path:"/tags/MySQL/"}],cover:"/images/cover/mysql_course.jpg",date:"2021-01-09T02:35:46.000Z",updated:"2021-01-09T02:35:46.000Z"}];function toRandomPost(){window.pjax?pjax.loadUrl(posts[Math.floor(Math.random()*posts.length)].path):window.open(posts[Math.floor(Math.random()*posts.length)].path,"_self")}</script><script>var flinks=[{name:"Eurkon",link:"https://blog.eurkon.com",avatar:"https://blog.eurkon.com/images/user/avatar.jpg",descr:"及时当勉励，岁月不待人。"},{name:"MYW",link:"https://crazywong.com/",avatar:"https://crazywong.com/img/avatar.png",descr:"今日事,今日毕"},{name:"Akilar",link:"https://akilar.top/",avatar:"https://npm.elemecdn.com/akilar-friends@latest/avatar/akilar.top.jpg",descr:"期待您的光临！",siteshot:null},{name:"小冰博客",link:"https://zfe.space",avatar:"https://zfe.space/images/headimage.png",descr:"做个有梦想的人！"},{name:"Heo",link:"https://blog.zhheo.com/",avatar:"https://blog.zhheo.com/img/avatar.png",descr:"爱折腾的设计师"},{name:"Leonus",link:"https://blog.leonus.cn/",avatar:"https://q1.qlogo.cn/g?b=qq&nk=553344777&s=5",descr:"进一寸有进一寸的欢喜。"},{name:"Maxbit",link:"https://cakepanit.com/",avatar:"https://cakepanit.com/img/avatar.jpg",descr:"寻找属于自己的彩虹海",siteshot:"https://fastly.jsdelivr.net/gh/zhangyazhuang/cdn/img/bei.jpg"},{name:"FF",link:"https://foolishfox.cn/",avatar:"https://asset.foolishfox.cn/static/avatar.jpg",descr:"foolish fox"},{name:"Harris",link:"https://blog.harriswong.top/",avatar:"https://cdn.jsdelivr.net/npm/hassan-assets/img/avatar_blog.jpg",descr:"时不我待，只争朝夕"},{name:"Tianli",link:"https://tianli-blog.club",avatar:"https://q2.qlogo.cn/headimg_dl?dst_uin=507249007&spec=640",descr:"惟其不可能，所以才相信。"},{name:"慕木",link:"https://iori-yimaga.top",avatar:"https://avatars.githubusercontent.com/u/33000237?v=4",descr:"当程序运行的那一刻，我知道是编译器对我的温柔",siteshot:"https://fastly.jsdelivr.net/gh/Iori-yimaga/ScreenShot@gh-pages/iori-yimaga.top.jpg"},{name:"沐印小站",link:"https://c.undf.top/",avatar:"https://c.undf.top/icon/android-chrome-144x144.png",descr:"时间不在于你拥有多少，而在于你如何使用!"},{name:"MJ",link:"https://blog.justlovesmile.top",avatar:"https://blog.justlovesmile.top/img/avatar.jpg",descr:"醒亦念卿，梦亦念卿"},{name:"Gahotx",link:"https://gahotx.cn/",avatar:"https://pub.gahotx.cn/photo/cat.jpg",descr:"Don’t repeat yourself"},{name:"小孙同学",link:"https://blog.sunguoqi.com/",avatar:"https://blog.sunguoqi.com/images/avatar.jpg",descr:"热爱可抵漫长岁月！"},{name:"星空下的YZY",link:"https://226yzy.com",avatar:"https://226yzy.com/medias/avatar.jpg",descr:"记录一枚菜鸟的征程"},{name:"DoraKika",link:"https://blog.dorakika.cn",avatar:"https://thirdqq.qlogo.cn/g?b=sdk&nk=1633198089&s=140",descr:"热爱漫无边际，生活自有分寸！"},{name:"ImCaO",link:"https://www.imcao.cn",avatar:"https://www.imcao.cn/avatar.png",descr:"花有重开日，人无再少年。"},{name:"btwoa",link:"https://blog.btwoa.com",avatar:"https://ovo.btwoa.com/img/gif/btwoa.gif",descr:"我仍相信人间滚烫"},{name:"小曹同学",link:"https://cgq.suduhulian.top/",avatar:"http://q1.qlogo.cn/g?b=qq&nk=3514332263&s=640",descr:"一个学Py的人"},{name:"欢乐小王",link:"https://happyking.top/",avatar:"https://happyking.top/img/avatar.gif",descr:"聚散无常,别来无恙."},{name:"EmoryHuang",link:"https://emoryhuang.cn/",avatar:"https://static.emoryhuang.cn/img/emoryhuang-avatar.png",descr:"Learning everything"},{name:"LanYun",link:"https://lanyundev.com/",avatar:"https://lanyundev.com/img/logo.jpg.webp",descr:"Share Technology."},{name:"Bore",link:"https://bore.vip",avatar:"https://bore.vip/img/avatar.jpg",descr:"博观而约取，厚积而薄发。"},{name:"JayHrn",link:"https://blog.lvhrn.cn/",avatar:"https://npm.onmicrosoft.cn/hrn-img@1.0.0/img/avatar.jpg",descr:"念念不忘，必有回响"},{name:"枫叶",link:"https://blog.aqcoder.cn",avatar:"https://blog.aqcoder.cn/img/avatar.png",descr:"分享知识，认识世界"},{name:"liferecords",link:"https://nav.liferecords.top/",avatar:"https://cdn.liferecords.top/person/logo.jpg",descr:"从私域转到公域的助益者"},{name:"Fomalhaut🥝",link:"https://www.fomal.cc/",avatar:"https://www.fomal.cc/assets/avatar.webp",descr:"Future is now 🍭🍭🍭",siteshot:"https://source.fomal.cc/siteshot/www.fomal.cc.webp"},{name:"Mycpen",link:"https://blog.cpen.top/",avatar:"https://image.cpen.top/image/avatar.jpg",descr:"这是一个有趣的博客"},{name:"小城故事",link:"https://www.webxc.ml/",avatar:"https://npm.elemecdn.com/webxc/logo/logo.jpg",descr:"欢迎光临小城故事!"},{name:"Xlenco",link:"https://xlenco.eu.org",avatar:"https://ik.imagekit.io/nicexl/head.jpg",descr:"最好的地方是没去过的地方，最好的时光，是回不来的时光。"},{name:"ichika",link:"https://ichika.cc",avatar:"https://ichika.cc/img/Page/HeadIcon.jpg",descr:"Hello,gamer!",siteshot:"https://cos.ichika.cc/link/ichikashot.png"},{name:"九九九感冒绫",link:"https://miku-39.love/",avatar:"https://s2.loli.net/2022/10/18/soq82lvxakjeHB1.jpg",descr:"这是我的梦想,我会慢慢的完成它",siteshot:"https://s2.loli.net/2022/10/18/9KaSTU7OrWHkyEq.png"},{name:"丘卡饮品店",link:"https://blog.zerolacqua.top",avatar:"https://unpkg.com/zerolacqua-assets/images/avatar.png",descr:"要来点喝的吗？"},{name:"张时贰",link:"https://zhsher.cn",avatar:"https://q1.qlogo.cn/g?b=qq&nk=1310446718&s=5",descr:"环转码，爱敲代码的小张！"},{name:"Heyiki",link:"https://www.heyiki.top",avatar:"https://npm.elemecdn.com/heyiki-cdn/img/1.jpg",descr:"梦在旅途，永不止步。"},{name:"小华同学927",link:"https://blog.xiaohua927.top/",avatar:"https://i.imgtg.com/2022/12/01/DM501.jpg",descr:"行而不辍，未来可期！"},{name:"竹山一叶",link:"https://zsyyblog.com",avatar:"https://img.zsyyblog.com/favicon.jpg",descr:"来了就不想走的小家"},{name:"云野生SRE",link:"https://www.xadocker.cn",avatar:"https://www.xadocker.cn/wp-content/uploads/2022/04/2082e818343d236c1e5268eae30480bb-96x96.jpeg",descr:"云野生SRE"},{name:"SLOVER",link:"https://678777.xyz",avatar:"https://s1.vika.cn/space/2022/11/06/9e4c4d54cff74c70b1a4abe37d4bd6e8",descr:"诱导已亮，前方净空，祝君武运昌隆",siteshot:"https://s1.vika.cn/space/2023/01/03/ed2f8872abc64ea18af2fbbd6a1120c7"},{name:"ReCclay🖥️",link:"https://www.recclay.cc/",siteshot:"https://www.recclay.cc/img/2023-01-02.png",avatar:"https://www.recclay.cc/img/recclay.png",descr:"芯片硅农，别忘无恙🧐"},{name:"Shine",link:"https://blog.shineyu.cn/",avatar:"https://s3.bmp.ovh/imgs/2022/11/23/129c19d56d22c637.png",descr:"Let’s go! Target: The Vast Stars!",siteshot:"https://s3.bmp.ovh/imgs/2022/12/28/fe2452f7c4ff48ee.png"},{name:"小码博客",link:"https://blog.hikki.site",avatar:"https://bu.dusays.com/2022/11/04/636511250b21b.jpg",descr:"喜欢的东西就努力去追求，万一成功了呢!"},{name:"南方嘉木",link:"https://gavin-chen.top/",avatar:"https://i.imgtg.com/2023/01/06/GZRKN.jpg",descr:"不畏将来, 不念过往。"},{name:"Prong",link:"https://prong.ltd",avatar:"https://prong-1316442664.cos.ap-nanjing.myqcloud.com/picgo/202301242359645.webp",descr:"尖头叉子在霍格沃茨的休息室~",siteshot:"https://prong-1316442664.cos.ap-nanjing.myqcloud.com/picgo/202301252110840.webp"},{name:"满心记",link:"https://blog.lovelu.top",avatar:"https://cdn.lovelu.top/img/logo.png",descr:"追求让人充实，分享让人快乐"},{name:"怕冷爱上雪",link:"https://blog.4t.pw/",avatar:"https://blog.4t.pw/img/favicon.webp",descr:"千里之行，始于足下。"},{name:"雷雷屋头",link:"https://ll.sc.cn",avatar:"https://ll.sc.cn/img/avatar.png",descr:"爱生活，爱工作，爱折腾。",siteshot:"https://ll.sc.cn/img/siteshot.webp"},{name:"小吉崽汁の窝",link:"https://wuxingzzz.top",avatar:"https://www.wuxingzzz.top/hexo/IMG_3969.JPG",siteshot:"https://www.wuxingzzz.top/article/1592180893591904258.jpg",descr:"A programmer of vegetable chicken"},{name:"龙儿之家",link:"https://blog.huangge1199.cn",avatar:"https://blog.huangge1199.cn/upload/favicon.png",descr:"一个热衷于做小码农的程序媛！！！"},{name:"小朋同学",link:"https://blog.vip88.email",avatar:"https://blog.vip88.email/img/default_avatar.webp",descr:"朝着诗和远方慢慢走去",siteshot:"https://img.vip88.email/img/999.png"},{name:"王同学",link:"https://demo.wxz666.icu/",avatar:"http://www.wxz666.icu/img/favicon.ico.jpg",descr:"须知少时凌云志，曾许人间第一流"},{name:"李程ic",link:"https://www.licic.net/",avatar:"https://admin.licic.net/favicon.png",descr:"坚持很难；但是很酷！",siteshot:"https://admin.licic.net/screenshot.png"},{name:"回忆航线",link:"https://moony.la/",avatar:"https://moony.la/upload/logo.png",descr:"喜欢捣鼓的博主"},{name:"爱吃肉的猫",link:"https://meuicat.com/",avatar:"https://s1.ax1x.com/2023/05/26/p9qChjI.jpg",descr:"有肉有猫有生活."},{name:"虎了吧唧",link:"https://hulebaji.me",avatar:"https://cravatar.cn/avatar/c126bb295caa6f29cbbd32083708cda4?d=identicon",descr:"研墨成浆，提笔思量"},{name:"毕少侠",link:"https://hexo.geekswg.top/",avatar:"https://hexo.geekswg.top/imgs/avatar.webp",descr:"毕少侠也在江湖",siteshot:"https://hexo.geekswg.top/imgs/default-cover.webp"},{name:"猫四叔",link:"https://blog.hieroglyphs.top/",avatar:"https://npm.elemecdn.com/hieroglyphs.files/images/others/logo.png",descr:"一生俯首拜阳明"},{name:"铭心石刻",link:"https://blog.kouseki.cn/",avatar:"https://blog.kouseki.cn/imgs/avatar.webp",descr:"愿岁并谢，与友长兮"},{name:"xhang",link:"https://xhablog.online/",avatar:"https://i.postimg.cc/VNTPknVj/avatar.webp",descr:"一切都值得期待"},{name:"海拥",link:"https://haiyong.site",avatar:"https://haiyong.site/img/favicon.png",descr:"一枚乐于分享技术与快乐的博主"},{name:"虹色轨迹🌠",link:"https://ovoz.cn",avatar:"https://ovoz.cn/assets/avatar.webp",descr:"做一颗星星，有棱有角，黑暗中闪闪发光🍭🍭🍭",siteshot:"https://ovoz.cn/assets/ovoz.cn.jpg"},{name:"SuYi-宿仪",link:"https://www.thotz.top/",avatar:"https://pic.imgdb.cn/item/6497c3401ddac507ccd9334c.jpg",descr:"随心写作，随缘阅读"},{name:"神经蛙",link:"https://hexo.sjava.cn/",avatar:"https://hexo.sjava.cn/img/pic.png",descr:"种一棵树最好的时间是十年前，其次是现在。",siteshot:"https://hexo.sjava.cn/img/sjw.png"},{name:"小嗷犬的技术小站",link:"https://blog.marquis.eu.org/",avatar:"https://blog.marquis.eu.org/img/avatar/2.png",descr:"为天地立心，为生民立命，为往圣继绝学，为万世开太平"},{name:"Cisyam",link:"https://manamn.space/",avatar:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/202307151545455.jpg",descr:"分享思想，留下痕迹",siteshot:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/202307151545874.png"},{name:"杀死一只知更鸟",link:"https://www.shangjidong.com",avatar:"https://www.shangjidong.com/usr/uploads/2023/07/1002399499.gif",descr:"前端技术分享、前端学习记录"},{name:"棋の小站",link:"https://blog.qi1.zone/",avatar:"https://blog.qi1.zone/avatar.png",descr:"记录生活与心得。"},{name:"qxdn",link:"https://qianxu.run",avatar:"https://qianxu.run/images/avatar.jpg",descr:"蓬生麻中，不扶自直"},{name:"阳小楊",link:"https://blog.yxyang.top",avatar:"https://pic.imgdb.cn/item/65708f75c458853aefa8c951.jpg",descr:"无人了解你的灵魂．",siteshot:"https://pic.imgdb.cn/item/65709596c458853aefc6469c.png"},{name:"云深不知处",link:"https://www.lanzlz.cn",avatar:"https://oss.lanzlz.cn/private/hIwTot.png",descr:"不食人间烟火 且饮半杯风霜"},{name:"虹色轨迹🌠",link:"https://dil.illlli.com",avatar:"https://dil.illlli.com/assets/avatar.webp",descr:"做一颗星星，有棱有角，黑暗中闪闪发光🍭🍭🍭",siteshot:"https://dil.illlli.com/assets/dil.webp"},{name:"小鹿",link:"https://siena.zone",avatar:"https://siena.zone/favicon_compressed.png",descr:"跳吧，在无比宏大的星系！"},{name:"Calyee",link:"https://blog.calyee.top/",avatar:"https://blog.calyee.top/img/avatar.jpg",descr:"追求充实，分享快乐",siteshot:"https://blog.calyee.top/img/siteshot.png"},{name:"琅環书生",link:"https://www.zlog.us.kg",avatar:"https://images.zlog.us.kg/hexo/琅環书生头像.webp",descr:"无远弗届，皆有可能",siteshot:"https://images.zlog.us.kg/hexo/琅環书生站点.webp"},{name:"SeaEpoch",link:"https://www.seayj.cn",avatar:"https://www.seayj.cn/img/avatar.png",descr:"她站在那里，就像一个小小的永恒！",siteshot:"https://www.seayj.cn/img/siteshoot.jpg"},{name:"彬红茶栈",link:"https://resource.redcha.cn",avatar:"https://cn-sy1.rains3.com/binhongtea/studio2.png",descr:"彬红茶栈"}];function toRandomFlink(){window.open(flinks[Math.floor(Math.random()*flinks.length)].link)}</script>